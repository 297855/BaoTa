#!/usr/bin/python
import json #line:12
from projectModel .base import projectBase #line:14
import os ,re ,time #line:15
import public #line:16
from BTPanel import cache #line:17
class main (projectBase ):#line:19
    __O0O00000O0O0000OO =public .Md5 ('vulnerability_scanning'+time .strftime ('%Y-%m-%d'))#line:20
    __O0000OOOO0O00OO00 ='/www/server/panel/config/vulnerability_scanning.json'#line:21
    __O000OO00000OO0O0O =public .to_string ([27492 ,21151 ,33021 ,20026 ,20225 ,19994 ,29256 ,19987 ,20139 ,21151 ,33021 ,65292 ,35831 ,20808 ,36141 ,20080 ,20225 ,19994 ,29256 ])#line:24
    def __O0O000OOO00O0O00O (O00OOOO0O0O00OOO0 ):#line:26
        from pluginAuth import Plugin #line:27
        O0O0OOOO0OOOO00O0 =Plugin (False )#line:28
        O0000O0OO0000000O =O0O0OOOO0OOOO00O0 .get_plugin_list ()#line:29
        return int (O0000O0OO0000000O ['ltd'])>time .time ()#line:30
    def write_config (OO0000000O0O00O0O ,config =False ):#line:33
        ""#line:39
        if config :#line:40
            public .WriteFile (OO0000000O0O00O0O .__O0000OOOO0O00OO00 ,json .dumps (config ))#line:41
        else :#line:42
            public .WriteFile (OO0000000O0O00O0O .__O0000OOOO0O00OO00 ,json .dumps (OO0000000O0O00O0O .getDefaultCms ()))#line:43
    def get_config (O00O0O0OOOOOOO00O ):#line:45
        ""#line:50
        if not os .path .exists (O00O0O0OOOOOOO00O .__O0000OOOO0O00OO00 ):#line:51
            O00O0O0OOOOOOO00O .write_config ()#line:52
            return O00O0O0OOOOOOO00O .getDefaultCms ()#line:53
        else :#line:54
            try :#line:55
                O00000O0O000O0000 =json .loads (public .ReadFile (O00O0O0OOOOOOO00O .__O0000OOOO0O00OO00 ))#line:56
            except :#line:57
                O00O0O0OOOOOOO00O .write_config ()#line:58
                return O00O0O0OOOOOOO00O .getDefaultCms ()#line:59
        if not cache .get (O00O0O0OOOOOOO00O .__O0O00000O0O0000OO ):#line:60
            try :#line:61
                import requests #line:62
                O00000O0O000O0000 =requests .get ("https://www.bt.cn/api/bt_waf/scanRules").json ()#line:63
                cache .set (O00O0O0OOOOOOO00O .__O0O00000O0O0000OO ,'1',3600 )#line:64
                O00O0O0OOOOOOO00O .write_config (O00000O0O000O0000 )#line:65
            except :#line:66
                return O00O0O0OOOOOOO00O .getDefaultCms ()#line:67
            return O00000O0O000O0000 #line:68
        else :#line:69
            return O00000O0O000O0000 #line:70
    def getDefaultCms (O0OOOOOOO000000O0 ):#line:72
        ""#line:76
        O00OOO0000OOOOO00 =[{"cms_list":[],"dangerous":"2","cms_name":"迅睿CMS","ps":"迅睿CMS 版本过低","name":"迅睿CMS 版本过低","determine":["dayrui/My/Config/Version.php"],"version":{"type":"file","file":"dayrui/My/Config/Version.php","regular":"version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"3.2.0~4.5.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"dayrui/My/Config/Version.php","regular":''' if (preg_match('/(php|jsp|asp|exe|sh|cmd|vb|vbs|phtml)/i', $value)) {'''}]},"repair":"修复建议 : https://www.xunruicms.com/bug/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 3.0.0~3.0.4 存在多个高危漏洞CNVD-2020-48981,CNVD-2020-48677,CNVD-2020-48469,CNVD-2020-57593,CNVD-2020-56006,CNVD-2021-00794,CNVD-2021-30081,CNVD-2021-30113,CNVD-2021-32163","name":"pbootcms 2.0.0~2.0.8 存在多个高危漏洞CNVD-2020-48981,CNVD-2020-48677,CNVD-2020-48469,CNVD-2020-57593,CNVD-2020-56006,CNVD-2021-00794,CNVD-2021-30081,CNVD-2021-30113,CNVD-2021-32163","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"3.0.0~3.0.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"apps/admin/controller/system/ConfigController.php","regular":''' if (preg_match('/(php|jsp|asp|exe|sh|cmd|vb|vbs|phtml)/i', $value)) {'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 2.0.0~2.0.8 存在多个高危漏洞CNVD-2020-04104,CNVD-2020-13536,CNVD-2020-24744,CNVD-2020-32198,CNVD-2020-32180,CNVD-2020-32177,CNVD-2020-31495,CNVD-2019-43060","name":"pbootcms 2.0.0~2.0.8 存在多个高危漏洞CNVD-2020-04104,CNVD-2020-13536,CNVD-2020-24744,CNVD-2020-32198,CNVD-2020-32180,CNVD-2020-32177,CNVD-2020-31495,CNVD-2019-43060","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"2.0.0~2.0.8","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"apps/home/controller/ParserController.php","regular":''' if (preg_match('/(\$_GET\[)|(\$_POST\[)|(\$_REQUEST\[)|(\$_COOKIE\[)|(\$_SESSION\[)|(file_put_contents)|(file_get_contents)|(fwrite)|(phpinfo)|(base64)|(`)|(shell_exec)|(eval)|(assert)|(system)|(exec)|(passthru)|(print_r)|(urldecode)|(chr)|(include)|(request)|(__FILE__)|(__DIR__)|(copy)/i', $matches[1][$i]))'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 1.3.0~1.3.8 存在多个高危漏洞CNVD-2018-26355,CNVD-2018-24253,CNVD-2018-26938,CNVD-2019-14855,CNVD-2019-27743,CNVD-2020-23841","name":"pbootcms 1.3.0~1.3.8 存在多个高危漏洞CNVD-2018-26355,CNVD-2018-24253,CNVD-2018-26938,CNVD-2019-14855,CNVD-2019-27743,CNVD-2020-23841","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"1.3.0~1.3.8","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"apps/admin/controller/system/ConfigController.php","regular":'''$config = preg_replace('/(\'' . $key . '\'([\s]+)?=>([\s]+)?)[\w\'\"\s,]+,/', '${1}\'' . $value . '\',', $config);'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 1.2.0~1.2.2 存在多个高危漏洞CNVD-2018-21503,CNVD-2018-19945,CNVD-2018-22854,CNVD-2018-22142,CNVD-2018-26780,CNVD-2018-24845","name":"pbootcms 1.0.1~1.2.2 存在多个高危漏洞CNVD-2018-21503,CNVD-2018-19945,CNVD-2018-22854,CNVD-2018-22142,CNVD-2018-26780,CNVD-2018-24845","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["1.2.0","1.2.1","1.2.2"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"apps/admin/controller/system/DatabaseController.php","regular":'''if ($value && ! preg_match('/(^|[\s]+)(drop|truncate|set)[\s]+/i', $value)) {'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 1.1.9 存在SQL注入漏洞CNVD-2018-18069","name":"pbootcms 1.1.9 存在SQL注入漏洞CNVD-2018-18069","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["1.1.9"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"core/function/handle.php","regular":'''if (Config::get('url_type') == 2 && strrpos($indexfile, 'index.php') !== false)'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"pbootcms","ps":"pbootcms 1.1.6~1.1.8 存在前台代码执行漏洞、存在多个SQL注入漏洞 CNVD-2018-17412,CNVD-2018-17741,CNVD-2018-17747,CNVD-2018-17750,CNVD-2018-17751,CNVD-2018-17752,CNVD-2018-17753,CNVD-2018-17754","name":"pbootcms 1.1.6~1.1.8  存在前台代码执行漏洞、存在多个SQL注入漏洞 CNVD-2018-17412,CNVD-2018-17741,CNVD-2018-17747,CNVD-2018-17750,CNVD-2018-17751,CNVD-2018-17752,CNVD-2018-17753,CNVD-2018-17754","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["1.1.6","1.1.7","1.1.8"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"core/function/handle.php","regular":'''if (is_array($string)) { // 数组处理
        foreach ($string as $key => $value) {
            $string[$key] = decode_slashes($value);
        }'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"pbootcms","ps":"pbootcms 1.1.4 存在SQL注入漏洞CNVD-2018-13335,CNVD-2018-13336","name":"pbootcms 1.1.4 存在SQL注入漏洞CNVD-2018-13335,CNVD-2018-13336","determine":["apps/common/version.php","core/basic/Config.php","apps/admin/view/default/js/mylayui.js","apps/api/controller/ContentController.php"],"version":{"type":"file","file":"apps/common/version.php","regular":"app_version.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["1.1.4"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"core/extend/ueditor/php/controller.php","regular":'''if (! ini_get('session.auto_start') && ! isset($_SESSION)'''}]},"repair":"修复建议 : https://www.pbootcms.com/changelog/ \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"maccms10","ps":"maccms10 <=2022.1000.3025 存在ssrf漏洞、存在XSS漏洞","name":"maccms10 <=2022.1000.3025 存在ssrf漏洞、存在XSS漏洞","determine":["application/extra/version.php","application/api/controller/Wechat.php","thinkphp/library/think/Route.php","application/admin/controller/Upload.php"],"version":{"type":"file","file":"application/extra/version.php","regular":"code.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["2022.1000.3025","2022.1000.3005","2022.1000.3024","2022.1000.3020","2022.1000.3023","2022.1000.3002","2022.1000.1099","2021.1000.1081"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"application/common/model/Actor.php","regular":'''$data[$filter_field] = mac_filter_xss($data[$filter_field]);'''}]},"repair":"修复建议 : https://github.com/magicblack/maccms10/releases \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"maccms10","ps":"maccms10 <=2022.1000.3024 存在前台任意用户登陆、后台会话验证绕过、后台任意文件写入、任意文件删除漏洞","name":"maccms10 <=2022.1000.3024 存在前台任意用户登陆、后台会话验证绕过、后台任意文件写入、任意文件删除漏洞","determine":["application/extra/version.php","application/api/controller/Wechat.php","thinkphp/library/think/Route.php","application/admin/controller/Upload.php"],"version":{"type":"file","file":"application/extra/version.php","regular":"code.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["2022.1000.3005","2022.1000.3024","2022.1000.3020","2022.1000.3023","2022.1000.3002","2022.1000.1099","2021.1000.1081"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"application/common/model/Annex.php","regular":'''if (stripos($v['annex_file'], '../') !== false)'''}]},"repair":"修复建议 : https://github.com/magicblack/maccms10/releases \n升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"eyoucms","ps":"eyoucms 1.5.5~1.5.7 存在多个安全漏洞","name":"eyoucms 1.5.1~1.5.4 存在多个安全漏洞","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.5.5~1.5.7","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''$login_errnum_key = 'adminlogin_'.md5('login_errnum_'.$admin_info['user_name']);'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"eyoucms","ps":"eyoucms 1.5.1~1.5.4 存在多个高危安全漏洞,CNVD-2021-82431,CNVD-2021-82429,CNVD-2021-72772,CNVD-2021-51838,CNVD-2021-51836,CNVD-2021-41520,CNVD-2021-24745,,CNVD-2021-26007,CNVD-2021-26099,CNVD-2021-41520","name":"eyoucms 1.5.1~1.5.4 存在多个高危安全漏洞,CNVD-2021-82431,CNVD-2021-82429,CNVD-2021-72772,CNVD-2021-51838,CNVD-2021-51836,CNVD-2021-41520,CNVD-2021-24745,,CNVD-2021-26007,CNVD-2021-26099,CNVD-2021-41520","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.5.1~1.5.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''$citysite_db->where(['domain'=>$s_arr[0]])->cache(true, EYOUCMS_CACHE_TIME, 'citysite')->count()'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"eyoucms","ps":"eyoucms 1.4.7 存在多个高危安全漏洞,CNVD-2020-46317,CNVD-2020-49065,CNVD-2020-44394,CNVD-2020-44392,CNVD-2020-44391,CNVD-2020-47671,CNVD-2020-50721","name":"eyoucms 1.4.7 存在多个高危安全漏洞,CNVD-2020-46317,CNVD-2020-49065,CNVD-2020-44394,CNVD-2020-44392,CNVD-2020-44391,CNVD-2020-47671,CNVD-2020-50721","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.4.7~1.4.7","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''function GetTagIndexRanking($limit = 5, $field = 'id, tag')'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"eyoucms","ps":"eyoucms 1.4.6 存在多个高危安全漏洞,CNVD-2020-44116,CNVD-2020-32622,CNVD-2020-28132,CNVD-2020-28083,CNVD-2020-28064,CNVD-2020-33104","name":"eyoucms 1.4.6 存在多个高危安全漏洞,CNVD-2020-44116,CNVD-2020-32622,CNVD-2020-28132,CNVD-2020-28083,CNVD-2020-28064,CNVD-2020-33104","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.4.6~1.4.6","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''preg_replace('#^(/[/\w]+)?(/uploads/|/public/static/)#i'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"eyoucms","ps":"eyoucms 1.3.9~1.4.4 存在多个安全漏洞CNVD-2020-02271,CNVD-2020-02824,CNVD-2020-18735,CNVD-2020-18677,CNVD-2020-23229,CNVD-2020-23805,CNVD-2020-23820","name":"eyoucms 1.3.9~1.4.4 存在多个安全漏洞CNVD-2020-02271,CNVD-2020-02824,CNVD-2020-18735,CNVD-2020-18677,CNVD-2020-23229,CNVD-2020-23805,CNVD-2020-23820","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.3.9~1.4.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''$TimingTaskRow = model('Weapp')->getWeappList('TimingTask');'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"4","cms_name":"eyoucms","ps":"eyoucms 1.4.1 存在命令执行漏洞","name":"eyoucms 1.4.1 存在命令执行漏洞","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.4.1~1.4.1","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/route.php","regular":'''$weapp_route_file = 'plugins/route.php';'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"eyoucms","ps":"eyoucms<=1.3.8 存在SQL注入、存在插件上传漏洞","name":"eyoucms<=1.3.8 存在SQL注入、存在插件上传漏洞","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.0.0~1.3.8","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"core/library/think/template/taglib/Eyou.php","regular":'''$notypeid  = !empty($tag['notypeid']) ? $tag['notypeid'] : '';'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"eyoucms","ps":"eyoucms<=1.3.4 存在后台文件上传漏洞","name":"eyoucms<=1.3.4 存在后台文件上传漏洞","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.0.0~1.3.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/common.php","regular":'''include_once EXTEND_PATH."function.php";'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"eyoucms","ps":"eyoucms 1.0 存在任意文件上传漏洞","name":"eyoucms 1.0 存在任意文件上传漏洞","determine":["data/conf/version.txt","application/api/controller/Uploadify.php","application/extra/extra_cache_key.php","application/admin/controller/Uploadify.php"],"version":{"type":"file","file":"data/conf/version.txt","regular":"(\d+.\d+.\d+)","regular_len":0 ,"vul_version":"1.0.0~1.1.0","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/api/controller/Uploadify.php","regular":'''目前没用到这个api接口'''}]},"repair":"修复建议 : https://www.eyoucms.com/rizhi/ \n升级eyoucms到最新版"},{"cms_list":[],"dangerous":"2","cms_name":"海洋CMS","ps":"海洋CMS 版本过低","name":"海洋CMS 版本过低","determine":["data/admin/ver.txt","include/common.php","include/main.class.php","detail/index.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+.\d+?|\d+)","regular_len":0 ,"vul_version":["6.28","6.54","7.2","8.4","8.5","8.6","8.7","8.8","8.9","9","9.1","9.2","9.3","9.4","9.5","9.6","9.7","9.8","9.9","9.91","9.92","9.93","9.94","9.96","9.97","9.98","9.99","10","10.1","10.2","10.3","10.4","10.5","10.6","10.7","10.8","10.9","11","11.1","11.2","11.3","11.4","11.5"],"ver_type":"list"},"repair_file":{"type":"version","file":[]},"repair":"修复建议:" "升级到海洋CMS 最新版 https://www.seacms.net/p-549"},{"cms_list":[],"dangerous":"3","cms_name":"海洋CMS","ps":"海洋CMS <=9.95存在前台RCE","name":"海洋CMS <=9.95存在前台RCE","determine":["data/admin/ver.txt","include/common.php","include/main.class.php","detail/index.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+.\d+?|\d+)","regular_len":0 ,"vul_version":["6.28","6.54","7.2","8.4","8.5","8.6","8.7","8.8","8.9","9","9.1","9.2","9.3","9.4","9.5","9.6","9.7","9.8","9.9","9.91","9.92","9.93","9.94"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"include/common.php","regular":''''$jpurl='//'.$_SERVER['SERVER_NAME']'''}]},"repair":"修复建议:" "升级到海洋CMS 最新版 https://www.seacms.net/p-549"},{"cms_list":[],"dangerous":"3","cms_name":"ThinkCMF","ps":"ThinkCMF CVE-2019-6713漏洞","name":"ThinkCMF CVE-2019-6713","determine":["public/index.php","app/admin/hooks.php","app/admin/controller/NavMenuController.php","simplewind/cmf/hooks.php"],"version":{"type":"file","file":"public/index.php","regular":"THINKCMF_VERSION.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":["5.0.190111","5.0.181231","5.0.181212","5.0.180901","5.0.180626","5.0.180525","5.0.180508"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"app/admin/validate/RouteValidate.php","regular":'''protected function checkUrl($value, $rule, $data)'''}]},"repair":"修复建议:" "1.修改代码 https://github.com/thinkcmf/thinkcmf/commit/217b6f8ad77a2917634bb9dd9c1f4ccf2c4c2930\n" "2.升级到最新版 https://github.com/thinkcmf/thinkcmf/releases/tag/5.0.190419" "3.升级到6.0 https://github.com/thinkcmf/thinkcmf/releases"},{"cms_list":[],"dangerous":"3","cms_name":"ThinkCMF","ps":"ThinkCMF templateFile远程代码执行漏洞","name":"ThinkCMF templateFile远程代码执行漏洞","determine":["simplewind/Core/ThinkPHP.php","index.php","data/conf/db.php","application/Admin/Controller/NavcatController.class.php","application/Comment/Controller/WidgetController.class.php"],"version":{"type":"file","file":"index.php","regular":"THINKCMF_VERSION.+(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"1.6.0~2.2.2","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/Comment/Controller/WidgetController.class.php","regular":'''protected function display('''}]},"repair":"修复建议:" "1.修改代码 https://gitee.com/thinkcmf/ThinkCMFX/commit/559b868283bc491cf858d2f85bcd5b6cfa425d63\n" "2.升级到最新版 https://gitee.com/thinkcmf/ThinkCMFX/releases/X2.2.4" "3.升级到ThinkCMF5.X 或者ThinkCMF6.X"},{"cms_list":[],"dangerous":"3","cms_name":"zfaka","ps":"zfaka存在SQL注入漏洞","name":"zfaka存在SQL注入漏洞","determine":["application/init.php","application/function/F_Network.php","application/controllers/Error.php","application/modules/Admin/controllers/Profiles.php"],"version":{"type":"file","file":"application/init.php","regular":"VERSION.+'(\d+.\d+.\d+)'","regular_len":0 ,"vul_version":"1.0.0~1.4.4","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"application/function/F_Network.php","regular":'''if(filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4'''}]},"repair":"修复建议:\nhttps://github.com/zlkbdotnet/zfaka/commit/f0f504528347a758fc34fb4b8dbc69377b099b8e?branch=f0f504528347a758fc34fb4b8dbc69377b099b8e&diff=split\n 或者升级到1.4.5"},{"cms_list":[],"dangerous":"3","cms_name":"dedecms","ps":"dedecms 20210719安全更新","name":"dedecms 20210719安全更新","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"include/dedemodule.class.php","regular":'''if(preg_match("#[^a-z]+(eval|assert)[\s]*[(]#i"'''}]},"repair":"修复建议:https://www.dedecms.com/package.html?t=1626652800\n 也可以在后台进行更新"},{"cms_list":[],"dangerous":"3","cms_name":"dedecms","ps":"dedecms 20220125安全更新","name":"dedecms 20220125安全更新","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109","20220325","20210201","20210806"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"include/downmix.inc.php","regular":'''上海卓卓网络科技有限公司'''}]},"repair":"修复建议:https://www.dedecms.com/package.html?t=1643068800\n 也可以在后台进行更新"},{"cms_list":[],"dangerous":"3","cms_name":"dedecms","ps":"dedecms 20220218安全更新","name":"dedecms 20220218安全更新","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109","20220325","20210201","20210806"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"dede/file_manage_control.php","regular":'''phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen'''}]},"repair":"修复建议:https://www.dedecms.com/package.html?t=1645142400\n 也可以在后台进行更新"},{"cms_list":[],"dangerous":"3","cms_name":"dedecms","ps":"dedecms 20220310安全更新","name":"dedecms 20220310安全更新","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109","20220325","20210201","20210806"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"dede/file_manage_control.php","regular":'''phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen'''}]},"repair":"修复建议:https://www.dedecms.com/package.html?t=1646870400\n 也可以在后台进行更新"},{"cms_list":[],"dangerous":"3","cms_name":"dedecms","ps":"dedecms 20220325安全更新","name":"dedecms 20220325安全更新","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109","20220325","20210201","20210806"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"plus/mytag_js.php","regular":'''phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen'''}]},"repair":"修复建议:https://www.dedecms.com/package.html?t=1648166400\n 也可以在后台进行更新"},{"cms_list":[],"dangerous":"2","cms_name":"dedecms","ps":"dedecms 已开启会员注册功能","name":"dedecms 已开启会员注册功能","determine":["data/admin/ver.txt","data/common.inc.php","dede/shops_operations_userinfo.php","member/edit_space_info.php"],"version":{"type":"file","file":"data/admin/ver.txt","regular":"(\d+)","regular_len":0 ,"vul_version":["20180109","20220325","20210201","20210806"],"ver_type":"list"},"repair_file":{"type":"phpshell","file":[{"file":"member/get_user_cfg_mb_open.php","phptext":'''<?php require_once(dirname(__FILE__).'/../include/common.inc.php');echo 'start'.$cfg_mb_open.'end';?>''',"regular":'''start(\w)end''',"reulst_type":"str","result":"startYend"}]},"repair":"修复建议:建议在后台关闭会员注册功能"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 7.5.0存在SQL注入漏洞","name":"MetInfo7.5.0存在SQL注入漏洞","determine":["cache/config/config_metinfo.php","app/system/entrance.php","app/system/databack/admin/index.class.php","cache/config/app_config_metinfo.php"],"version":{"type":"file","file":"cache/config/config_metinfo.php","regular":"value.+'(\d+.\d+.\d+)'","vul_version":"7.5.0~7.5.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 7.3.0存在SQL注入漏洞、XSS漏洞","name":"MetInfo 7.3.0存在SQL注入漏洞、XSS漏洞","determine":["app/system/entrance.php","app/system/admin/admin/index.class.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"7.3.0~7.3.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 7.2.0存在SQL注入漏洞、XSS漏洞","name":"MetInfo 7.2.0存在SQL注入漏洞、XSS漏洞","determine":["app/system/entrance.php","app/system/admin/admin/index.class.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"7.2.0~7.2.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 7.1.0存在文件上传漏洞、SQL注入漏洞、XSS漏洞","name":"MetInfo 7.1.0存在文件上传漏洞、SQL注入漏洞、XSS漏洞","determine":["app/system/entrance.php","app/system/admin/admin/index.class.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"7.1.0~7.1.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 7.0.0 存在SQL注入漏洞","name":"MetInfo7.0.0存在SQL注入漏洞","determine":["app/system/entrance.php","app/system/admin/admin/index.class.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"7.0.0~7.0.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 6.1.2存在SQL注入漏洞","name":"MetInfo 6.1.2存在SQL注入漏洞","determine":["app/system/entrance.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"6.1.2~6.1.2","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"3","cms_name":"MetInfo","ps":"MetInfo 6.1.1 存在已知后台权限可以获取webshell漏洞","name":"MetInfo 6.1.1 存在已知后台权限可以获取webshell漏洞","determine":["app/system/entrance.php","app/system/admin/admin/templates/admin_add.php"],"version":{"type":"file","file":"app/system/entrance.php","regular":"SYS_VER.+'(\d+.\d+.\d+)'","vul_version":"6.1.1~6.1.1","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.metinfo.cn/log/ 建议升级到最新版"},{"cms_list":[],"dangerous":"2","cms_name":"emlog","ps":"emlog版本太低建议升级到Pro版本","name":"emlog版本太低建议升级到Pro版本","determine":["include/lib/option.php","admin/views/template_install.php","include/lib/checkcode.php","include/controller/author_controller.php"],"version":{"type":"file","file":"include/lib/option.php","regular":"EMLOG_VERSION.+'(\d+.\d+.\d+)'","vul_version":"5.3.1~6.0.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://www.emlog.net/docs/#/531toPro"},{"cms_list":[],"dangerous":"1","cms_name":"帝国CMS","ps":"EmpireCMs7.0后台XSS漏洞","name":"EmpireCMs7.0后台XSS漏洞","determine":["e/class/EmpireCMS_version.php","e/search/index.php","e/member/EditInfo/index.php","e/ViewImg/index.html"],"version":{"type":"file","file":"e/class/EmpireCMS_version.php","regular":"EmpireCMS_VERSION.+'(\d+.\d+)'","vul_version":"7.0~7.0","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:/e/admin/openpage/AdminPage.php?ehash_f9Tj7=ZMhwowHjtSwqyRuiOylK&mainfile=javascript:alert(1)"},{"cms_list":[],"dangerous":"2","cms_name":"帝国CMS","ps":"EmpireCMs6.0~7.5 后台代码执行","name":"EmpireCMs6.0~7.5 后台代码执行","determine":["e/class/EmpireCMS_version.php","e/search/index.php","e/member/EditInfo/index.php","e/ViewImg/index.html"],"version":{"type":"file","file":"e/class/EmpireCMS_version.php","regular":"EmpireCMS_VERSION.+'(\d+.\d+)'","vul_version":"6.0~7.5","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://blog.csdn.net/ws13129/article/details/90071260 官方暂未有修复方案"},{"cms_list":[],"dangerous":"2","cms_name":"帝国CMS","ps":"EmpireCMs6.0~7.5 后台导入模型代码执行","name":"EmpireCMs6.0~7.5 后台导入模型代码执行","determine":["e/class/EmpireCMS_version.php","e/search/index.php","e/member/EditInfo/index.php","e/ViewImg/index.html"],"version":{"type":"file","file":"e/class/EmpireCMS_version.php","regular":"EmpireCMS_VERSION.+'(\d+.\d+)'","vul_version":"6.0~7.5","ver_type":"range"},"repair_file":{"type":"version","file":[]},"repair":"漏洞参考:https://blog.csdn.net/ws13129/article/details/90071260 官方暂未有修复方案"},{"cms_list":[],"dangerous":"2","cms_name":"discuz","ps":"Discuz utility组件对外访问","name":"Discuz utility组件对外访问","determine":["uc_client/client.php","uc_server/lib/uccode.class.php","uc_server/model/version.php","source/discuz_version.php"],"version":{"type":"single_file","file":"utility/convert/index.php","regular":"DISCUZ_RELEASE.+'(\d+)'","regular_len":0 ,"vul_version":["1"],"ver_type":"list"},"repair_file":{"type":"single_file","file":[{"file":"utility/convert/index.php","regular":'''$source = getgpc('source') ? getgpc('source') : getgpc('s');'''}]},"repair":"修复漏洞参考删除utility目录"},{"cms_list":[],"dangerous":"2","cms_name":"discuz","ps":"Discuz邮件认证入口CSRF以及时间限制可绕过漏洞","name":"Discuz邮件认证入口CSRF以及时间限制可绕过漏洞","determine":["uc_client/client.php","uc_server/lib/uccode.class.php","uc_server/model/version.php","source/discuz_version.php"],"version":{"type":"file","file":"source/discuz_version.php","regular":"DISCUZ_RELEASE.+'(\d+)'","regular_len":0 ,"vul_version":["20210816","20210630","20210520","20210320","20210119","20200818","20191201","20190917"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"source/admincp/admincp_setting.php","regular":'''showsetting('setting_permissions_mailinterval', 'settingnew[mailinterval]', $setting['mailinterval'], 'text');'''}]},"repair":"修复漏洞参考https://gitee.com/Discuz/DiscuzX/pulls/1276/commits"},{"cms_list":[],"dangerous":"3","cms_name":"discuz","ps":"Discuz 报错注入SQL","name":"Discuz 报错注入SQL","determine":["uc_client/client.php","uc_server/lib/uccode.class.php","uc_server/model/version.php","source/discuz_version.php"],"version":{"type":"file","file":"source/discuz_version.php","regular":"DISCUZ_RELEASE.+'(\d+)'","regular_len":0 ,"vul_version":["20211124","20211022","20210926","20210917","20210816","20210630","20210520","20210320","20210119","20200818","20191201","20190917"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"api/uc.php","regular":'''if($len > 22 || $len < 3 || preg_match("/\s+|^c:\\con\\con|[%,\*\"\s\<\>\&\(\)']/is", $get['newusername']))'''}]},"repair":"修复漏洞参考https://gitee.com/Discuz/DiscuzX/pulls/1349"},{"cms_list":[],"dangerous":"3","cms_name":"discuz","ps":"Discuz备份恢复功能执行任意SQL漏洞","name":"Discuz备份恢复功能执行任意SQL漏洞","determine":["uc_client/client.php","uc_server/lib/uccode.class.php","uc_server/model/version.php","source/discuz_version.php"],"version":{"type":"file","file":"source/discuz_version.php","regular":"DISCUZ_RELEASE.+'(\d+)'","regular_len":0 ,"vul_version":["20211231","20211124","20211022","20210926","20210917","20210816","20210630","20210520","20210320","20210119","20200818","20191201","20190917"],"ver_type":"list"},"repair_file":{"type":"file","file":[{"file":"api/db/dbbak.php","regular":'''if(!preg_match('/^backup_(\d+)_\w+$/', $get['sqlpath']) || !preg_match('/^\d+_\w+\-(\d+).sql$/', $get['dumpfile']))'''}]},"repair":"修复漏洞参考https://gitee.com/Discuz/DiscuzX/releases/v3.4-20220131"},{"cms_list":["maccms10"],"dangerous":"4","cms_name":"Thinkphp","ps":"thinkphp5.0.X漏洞","name":"Thinkphp5.X代码执行","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.0~5.0.24","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/App.php","regular":'''(!preg_match('/^[A-Za-z](\w|\.)*$/'''},{"file":"thinkphp/library/think/Request.php","regular":'''if (in_array($method, ['GET', 'POST', 'DELETE', 'PUT', 'PATCH']))'''}]},"repair":"修复漏洞参考https://www.thinkphp.cn/topic/60693.html\n修复漏洞参考https://www.thinkphp.cn/topic/60693.html"},{"cms_list":["maccms10"],"dangerous":"3","cms_name":"Thinkphp","ps":"Thinkphp5.0.15 SQL注入漏洞","name":"Thinkphp5.0.15 SQL注入漏洞","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.13~5.0.15","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/db/Builder.php","regular":'''if ($key == $val[1]) {
                        $result[$item] = $this->parseKey($val[1]) . '+' . floatval($val[2]);
                    }'''}]},"repair":"修复漏洞https://github.com/top-think/framework/commit/363fd4d90312f2cfa427535b7ea01a097ca8db1b"},{"cms_list":["maccms10"],"dangerous":"3","cms_name":"Thinkphp","ps":"Thinkphp5.0.10 SQL注入漏洞","name":"Thinkphp5.0.10 SQL注入漏洞","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.10~5.0.10","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/Request.php","regular":'''preg_match('/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT LIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i'''}]},"repair":"修复漏洞https://github.com/top-think/framework/commit/495020b7b0c16de40f20b08f2ab3be0a2b816b96"},{"cms_list":["maccms10"],"dangerous":"3","cms_name":"Thinkphp","ps":"Thinkphp5.0.0 到 Thinkphp5.0.21 SQL注入漏洞","name":"Thinkphp5.0.21 SQL注入漏洞","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.0~5.0.21","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/db/builder/Mysql.php","regular":'''if ($strict && !preg_match('/^[\w\.\*]+$/', $key))'''}]},"repair":"修复漏洞https://github.com/top-think/framework/commit/8652c83ea10661483217c4088b582b9f05b90c20#diff-680218f330b44eb8db590f77c9307503cd312225c5ada4dbff65b9af382498bb"},{"cms_list":["maccms10"],"dangerous":"3","cms_name":"Thinkphp","ps":"Thinkphp5.0.18文件包含漏洞","name":"Thinkphp5.0.18文件包含漏洞","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.0~5.0.18","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/template/driver/File.php","regular":'''$this->cacheFile = $cacheFile;'''}]},"repair":"修复漏洞https://github.com/top-think/framework/commit/e255100c7f162c48a22f1c2bf0890469f54f061b#diff-89dd11f3d7c96572fd8218c6566241bb206b77d17220fa569a35d45cda7b5f59"},{"cms_list":["maccms10"],"dangerous":"4","cms_name":"Thinkphp","ps":"Thinkphp5.0.10远程代码执行","name":"Thinkphp5.0.10远程代码执行","determine":["thinkphp/base.php","thinkphp/library/think/App.php","thinkphp/library/think/Request.php"],"version":{"type":"file","file":"thinkphp/base.php","regular":"THINK_VERSION.+(\d+.\d+.\d+)","vul_version":"5.0.0~5.0.10","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"thinkphp/library/think/App.php","regular":'''$data   = "<?php\n//" . sprintf('%012d', $expire) . "\n exit();?>;'''}]},"repair":"修复漏洞参考https://github.com/top-think/framework/commit/a217d88e38a0ec2dd33ba9d5fd53ac509f93c91a#diff-c945c42842520443a3b7bdd49df3a6ca5df44a07e9a957d85ca1475ea74f8564"},{"cms_list":[],"dangerous":"3","cms_name":"Wordpress","ps":"CVE-2022–21661 Wordpress SQL注入","name":"CVE-2022–21661 Wordpress SQL注入","determine":["wp-includes/version.php","wp-settings.php","wp-comments-post.php","wp-includes/class-wp-hook.php"],"version":{"type":"file","file":"wp-includes/version.php","regular":"wp_version.+(\d+.\d+.\d+)","vul_version":"4.1.0~5.8.2","ver_type":"range"},"repair_file":{"type":"file","file":[{"file":"wp-includes/class-wp-tax-query.php","regular":'''if ( 'slug' === $query['field'] || 'name' === $query['field'] )'''}]},"repair":"修复漏洞参考https://wordpress.org/news/2022/01/wordpress-5-8-3-security-release"}]#line:656
        return O00OOO0000OOOOO00 #line:657
    def getCmsType (O0OOOOO00OOOO0000 ,OO000O0O0O0OO0O00 ,OO0OOO0O0OO00O00O ):#line:659
        ""#line:665
        for OOO0OO0O00OOOOOOO in OO0OOO0O0OO00O00O ['determine']:#line:667
            O00OO0O000O0OOO00 =OO000O0O0O0OO0O00 ['path']+'/'+OOO0OO0O00OOOOOOO #line:668
            if not os .path .exists (O00OO0O000O0OOO00 ):#line:669
                return False #line:670
        if 'cms_name'in OO000O0O0O0OO0O00 :#line:673
            if OO000O0O0O0OO0O00 ['cms_name']!=OO0OOO0O0OO00O00O ['cms_name']:#line:674
                if not OO0OOO0O0OO00O00O ['cms_name']in OO0OOO0O0OO00O00O ['cms_list']:return False #line:675
        O0000OOO0000000OO =O0OOOOO00OOOO0000 .getCmsVersion (OO000O0O0O0OO0O00 ,OO0OOO0O0OO00O00O )#line:677
        if not O0000OOO0000000OO :return False #line:678
        OO000O0O0O0OO0O00 ['version_info']=O0000OOO0000000OO #line:679
        if not O0OOOOO00OOOO0000 .getVersionInfo (O0000OOO0000000OO ,OO0OOO0O0OO00O00O ['version']):return False #line:681
        OO000O0O0O0OO0O00 ['cms_name']=OO0OOO0O0OO00O00O ['cms_name']#line:682
        O0OO00OOO0OOO00OO =O0OOOOO00OOOO0000 .getCmsVersionVulFix (OO000O0O0O0OO0O00 ,OO0OOO0O0OO00O00O )#line:684
        if not O0OO00OOO0OOO00OO :return False #line:685
        OO000O0O0O0OO0O00 ['is_vufix']=True #line:686
        return True #line:687
    def getVersionInfo (OO0000O0O0O000O0O ,O0O000OOO0000OO00 ,O0000OO0OO0O0O000 ):#line:690
        ""#line:696
        if O0000OO0OO0O0O000 ['ver_type']=='range':#line:697
            try :#line:698
                O0000OO0OO0O0O000 =O0000OO0OO0O0O000 ['vul_version']#line:699
                OOO000OO0OOO0O0O0 ,OO0O0O0OO00OOOO00 =O0000OO0OO0O0O000 .split ('~')#line:700
                if O0O000OOO0000OO00 .split ('.')[0 ]>=OOO000OO0OOO0O0O0 .split ('.')[0 ]and O0O000OOO0000OO00 .split ('.')[0 ]<=OO0O0O0OO00OOOO00 .split ('.')[0 ]:#line:701
                    OOO000OO0OOO0O0O0 =''.join (OOO000OO0OOO0O0O0 .split ('.'))#line:702
                    OO0O0O0OO00OOOO00 =''.join (OO0O0O0OO00OOOO00 .split ('.'))#line:703
                    O0O000OOO0000OO00 =''.join (O0O000OOO0000OO00 .split ('.'))#line:704
                    if O0O000OOO0000OO00 >=OOO000OO0OOO0O0O0 and O0O000OOO0000OO00 <=OO0O0O0OO00OOOO00 :#line:705
                        return True #line:706
                return False #line:707
            except :#line:708
                return False #line:709
        elif O0000OO0OO0O0O000 ['ver_type']=='list':#line:710
            if O0O000OOO0000OO00 in O0000OO0OO0O0O000 ['vul_version']:#line:711
                return True #line:712
            return False #line:713
    def getCmsVersion (O000OO0O0O0OOO00O ,OOO000OO0OOOO0O0O ,O0000O0000OOOO000 ):#line:716
        ""#line:721
        OO0OO000O0O000OO0 =O0000O0000OOOO000 ["version"]#line:723
        if 'regular_len'in OO0OO000O0O000OO0 :#line:724
            O0000O0OO00O000O0 =OO0OO000O0O000OO0 ['regular_len']#line:725
        else :#line:726
            O0000O0OO00O000O0 =0 #line:727
        if OO0OO000O0O000OO0 ['type']=='file':#line:728
            O00O0O0OO0O00000O =OOO000OO0OOOO0O0O ['path']+'/'+OO0OO000O0O000OO0 ['file']#line:729
            if os .path .exists (O00O0O0OO0O00000O ):#line:731
                OO00O00000O00OOO0 =public .ReadFile (O00O0O0OO0O00000O )#line:732
                if OO00O00000O00OOO0 and re .search (OO0OO000O0O000OO0 ['regular'],OO00O00000O00OOO0 ):#line:733
                    if not 'cms_name'in OOO000OO0OOOO0O0O :#line:734
                        OOO000OO0OOOO0O0O ['cms_name']=O0000O0000OOOO000 ['cms_name']#line:735
                    return re .findall (OO0OO000O0O000OO0 ['regular'],OO00O00000O00OOO0 )[O0000O0OO00O000O0 ]#line:736
        elif OO0OO000O0O000OO0 ['type']=='single_file':#line:737
            return "1"#line:738
        elif OO0OO000O0O000OO0 ["type"]=='is_file':#line:739
            O00O0O0OO0O00000O =OOO000OO0OOOO0O0O ['path']+'/'+OO0OO000O0O000OO0 ['file']#line:740
            if os .path .exists (O00O0O0OO0O00000O ):#line:741
                return "1"#line:742
        return False #line:743
    def getCmsVersionVulFix (O0000O00OO0O0OO0O ,OO00O0000O0OO00OO ,O00O00OO0OO000OO0 ):#line:745
        ""#line:750
        O0O00O0OO00O00OO0 =O00O00OO0OO000OO0 ['repair_file']#line:751
        if O0O00O0OO00O00OO0 ['type']=='file':#line:752
            for OOO000O0OOOO000O0 in O0O00O0OO00O00OO0 ['file']:#line:753
                O0OOOO0OOOOO0OOOO =OO00O0000O0OO00OO ['path']+'/'+OOO000O0OOOO000O0 ['file']#line:754
                if os .path .exists (O0OOOO0OOOOO0OOOO ):#line:755
                    OO000OO00O0OO00O0 =public .ReadFile (O0OOOO0OOOOO0OOOO )#line:756
                    if not OOO000O0OOOO000O0 ['regular']in OO000OO00O0OO00O0 :#line:757
                        return True #line:758
        elif O0O00O0OO00O00OO0 ['type']=='single_file':#line:759
            for OOO000O0OOOO000O0 in O0O00O0OO00O00OO0 ['file']:#line:760
                O0OOOO0OOOOO0OOOO =OO00O0000O0OO00OO ['path']+'/'+OOO000O0OOOO000O0 ['file']#line:761
                if os .path .exists (O0OOOO0OOOOO0OOOO ):#line:762
                    OO000OO00O0OO00O0 =public .ReadFile (O0OOOO0OOOOO0OOOO )#line:763
                    if OOO000O0OOOO000O0 ['regular']in OO000OO00O0OO00O0 :#line:764
                        return True #line:765
        elif O0O00O0OO00O00OO0 ['type']=='version':#line:766
            return True #line:767
        elif O0O00O0OO00O00OO0 ['type']=='is_file':#line:768
            for OOO000O0OOOO000O0 in O0O00O0OO00O00OO0 ['file']:#line:769
                O0OOOO0OOOOO0OOOO =OO00O0000O0OO00OO ['path']+'/'+OOO000O0OOOO000O0 ['file']#line:770
                if os .path .exists (O0OOOO0OOOOO0OOOO ):#line:771
                    return True #line:772
        elif O0O00O0OO00O00OO0 ['type']=='phpshell':#line:773
            for OOO000O0OOOO000O0 in O0O00O0OO00O00OO0 ['file']:#line:774
                try :#line:775
                    O0OOOO0OOOOO0OOOO =OO00O0000O0OO00OO ['path']+'/'+OOO000O0OOOO000O0 ['file']#line:776
                    public .WriteFile (O0OOOO0OOOOO0OOOO ,OOO000O0OOOO000O0 ['phptext'])#line:777
                    O00OO00O00000OO00 =os .path .dirname (O0OOOO0OOOOO0OOOO )#line:778
                    O0O0OO0OOO0O0000O =os .path .basename (O0OOOO0OOOOO0OOOO )#line:779
                    O0OO0O00O0OO0O0OO =public .ExecShell ("cd %s && php %s"%(O00OO00O00000OO00 ,O0O0OO0OOO0O0000O ))#line:780
                    if len (O0OO0O00O0OO0O0OO )<=0 :return False #line:781
                    if OOO000O0OOOO000O0 ['result']in O0OO0O00O0OO0O0OO [0 ]:#line:782
                        os .remove (O0OOOO0OOOOO0OOOO )#line:783
                        return True #line:784
                    else :#line:785
                        os .remove (O0OOOO0OOOOO0OOOO )#line:786
                except :continue #line:787
        return False #line:788
    def getWebInfo (OO0OOO00000000OOO ,OOOOOOOOO0O0O00OO ):#line:791
        ""#line:796
        return public .M ('sites').where ('project_type=?',('PHP')).select ()#line:797
    def startScan (OO0OOO0O0OO000OOO ,O00OOO0OOO0OOOOOO ):#line:800
        ""#line:805
        O00OOO0O0O0OO0OOO =OO0OOO0O0OO000OOO .__O0O000OOO00O0O00O ()#line:806
        OOOOOOO0OOOO0OOOO =int (time .time ())#line:807
        OOO000O0OOO0OOOO0 =OO0OOO0O0OO000OOO .getWebInfo (None )#line:808
        OOO0OOOOO00O0O0OO =OO0OOO0O0OO000OOO .get_config ()#line:809
        O000O00OOOOO0000O =[]#line:810
        for O0OOO0OO0O0OO0O00 in OOO000O0OOO0OOOO0 :#line:811
            for O00000O0OO0OOO0OO in OOO0OOOOO00O0O0OO :#line:812
                OO00O000OOOOOO000 =O00000O0OO0OOO0OO #line:813
                if 'cms_name'in O0OOO0OO0O0OO0O00 :#line:814
                    if O0OOO0OO0O0OO0O00 ['cms_name']!=O00000O0OO0OOO0OO ['cms_name']:#line:815
                        if not O0OOO0OO0O0OO0O00 ['cms_name']in O00000O0OO0OOO0OO ['cms_list']:continue #line:816
                if OO0OOO0O0OO000OOO .getCmsType (O0OOO0OO0O0OO0O00 ,OO00O000OOOOOO000 ):#line:817
                    if not 'cms'in O0OOO0OO0O0OO0O00 :#line:818
                        O0OOO0OO0O0OO0O00 ['cms']=[]#line:819
                        O0OOO0OO0O0OO0O00 ['cms'].append (O00000O0OO0OOO0OO )#line:820
                    else :#line:821
                        O0OOO0OO0O0OO0O00 ['cms'].append (O00000O0OO0OOO0OO )#line:822
                else :#line:823
                    if not 'cms'in O0OOO0OO0O0OO0O00 :#line:824
                        O0OOO0OO0O0OO0O00 ['cms']=[]#line:825
            if not 'is_vufix'in O0OOO0OO0O0OO0O00 :#line:826
                O0OOO0OO0O0OO0O00 ['is_vufix']=False #line:827
        for OOOOO0OO0OO000O00 in OOO000O0OOO0OOOO0 :#line:828
            if OOOOO0OO0OO000O00 ['is_vufix']:#line:829
                O000O00OOOOO0000O .append (OOOOO0OO0OO000O00 )#line:830
        cache .set ("scaing_info",O000O00OOOOO0000O ,1600 )#line:831
        cache .set ("scaing_info_time",OOOOOOO0OOOO0OOOO ,1600 )#line:832
        O0000O0000O00O0OO ={"info":O000O00OOOOO0000O ,"time":OOOOOOO0OOOO0OOOO ,"is_pay":O00OOO0O0O0OO0OOO }#line:833
        return O0000O0000O00O0OO #line:834
    def list (OO0O00OO0OOOO00OO ,OO0OOO00OO0OO000O ):#line:836
        ""#line:840
        O0000O00O00OO0OO0 =OO0O00OO0OOOO00OO .__O0O000OOO00O0O00O ()#line:841
        if not cache .get ("scaing_info")or not cache .get ("scaing_info_time"):#line:842
            return OO0O00OO0OOOO00OO .startScan (None )#line:843
        OOO00000O0OO000O0 ={"info":cache .get ("scaing_info"),"time":cache .get ("scaing_info_time"),"is_pay":O0000O00O00OO0OO0 }#line:844
        return OOO00000O0OO000O0 #line:845
    def startAweb (O000OO0OOO0O00O0O ,OOO0O0O00OOOOOOOO ):#line:847
        ""#line:850
        OO0O000000000O000 =public .M ('sites').where ('project_type=? and name=?',('PHP',OOO0O0O00OOOOOOOO .name )).count ()#line:851
        if not OO0O000000000O000 :return public .returnMsg (False ,"当前网站不存在")#line:852
        return O000OO0OOO0O00O0O .startScan (None )#line:853
    def startScanWeb (O00OOO0000OO0OO00 ,OO00O00O0O00O0O00 ):#line:856
        ""#line:861
        O0OO0OOOO0OOOO0OO =public .M ('sites').where ('project_type=? and name=?',('PHP',OO00O00O0O00O0O00 .name )).count ()#line:862
        if not O0OO0OOOO0OOOO0OO :return public .returnMsg (False ,"当前网站不存在")#line:863
        O0OO0OOOO0OOOO0OO =public .M ('sites').where ('project_type=? and name=?',('PHP',OO00O00O0O00O0O00 .name )).select ()#line:864
        OO00O00O00O0O000O =O00OOO0000OO0OO00 .get_config ()#line:865
        for OOO0OO0OO0OO0OO0O in O0OO0OOOO0OOOO0OO :#line:866
            for OOO000000OOOO00O0 in OO00O00O00O0O000O :#line:867
                O000OOO0O0O0O0O0O =OOO000000OOOO00O0 #line:868
                if O00OOO0000OO0OO00 .getCmsType (OOO0OO0OO0OO0OO0O ,O000OOO0O0O0O0O0O ):#line:869
                    if not 'cms'in OOO0OO0OO0OO0OO0O :#line:870
                        OOO0OO0OO0OO0OO0O ['cms']=[]#line:871
                        OOO0OO0OO0OO0OO0O ['cms'].append (OOO000000OOOO00O0 )#line:872
                    else :#line:873
                        OOO0OO0OO0OO0OO0O ['cms'].append (OOO000000OOOO00O0 )#line:874
                    break #line:875
                else :#line:876
                    if not 'cms'in OOO0OO0OO0OO0OO0O :#line:877
                        OOO0OO0OO0OO0OO0O ['cms']=[]#line:878
            if not 'is_vufix'in OOO0OO0OO0OO0OO0O :#line:879
                OOO0OO0OO0OO0OO0O ['is_vufix']=False #line:880
        return public .returnMsg (True ,O0OO0OOOO0OOOO0OO )#line:881
    def startPath (O0O0OO0O00O0O000O ,O00O0OOOOO0OO0OOO ):#line:884
        ""#line:889
        O00O000OOOO0O00O0 =O00O0OOOOO0OO0OOO .path .strip ()#line:890
        if not os .path .exists (O00O000OOOO0O00O0 ):return public .returnMsg (False ,"目录不存在")#line:891
        OOOOOO0OOO0O000OO =O0O0OO0O00O0O000O .get_config ()#line:892
        OO000OOOOO00OO0O0 =[{"path":O00O000OOOO0O00O0 ,"name":O00O000OOOO0O00O0 }]#line:893
        for OOO0O0O0OO00000OO in OO000OOOOO00OO0O0 :#line:894
            for O000O0OO0O00O0000 in OOOOOO0OOO0O000OO :#line:895
                OO0O0OO0000OO0000 =O000O0OO0O00O0000 #line:896
                if O0O0OO0O00O0O000O .getCmsType (OOO0O0O0OO00000OO ,OO0O0OO0000OO0000 ):#line:897
                    if not 'cms'in OOO0O0O0OO00000OO :#line:898
                        OOO0O0O0OO00000OO ['cms']=[]#line:899
                        OOO0O0O0OO00000OO ['cms'].append (O000O0OO0O00O0000 )#line:900
                    else :#line:901
                        OOO0O0O0OO00000OO ['cms'].append (O000O0OO0O00O0000 )#line:902
                    break #line:903
                else :#line:904
                    if not 'cms'in OOO0O0O0OO00000OO :#line:905
                        OOO0O0O0OO00000OO ['cms']=[]#line:906
            if not 'is_vufix'in OOO0O0O0OO00000OO :#line:907
                OOO0O0O0OO00000OO ['is_vufix']=False #line:908
        return public .returnMsg (True ,OO000OOOOO00OO0O0 )#line:909
