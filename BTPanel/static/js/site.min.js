var site_table=bt_tools.table({el:"#bt_site_table",url:"/data?action=getData",cookiePrefix:"site_table",param:{table:"sites"},minWidth:"1000px",autoHeight:!0,default:"站点列表为空",beforeRequest:function(t){return t.type=bt.get_cookie("site_type")||-1,t},column:[{type:"checkbox",class:"",width:20},{fid:"name",title:"网站名",sort:!0,sortValue:"asc",type:"link",event:function(t,e,s){site.web_edit(t,!0)}},{fid:"status",title:"状态",sort:!0,width:80,config:{icon:!0,list:[["1","运行中","bt_success","glyphicon-play"],["0","已停止","bt_danger","glyphicon-pause"]]},type:"status",event:function(t,e,s,i,a){bt.site[parseInt(t.status)?"stop":"start"](t.id,t.name,function(e){e.status&&a.$modify_row_data({status:parseInt(t.status)?"0":"1"})})}},{fid:"backup_count",title:"备份",width:80,type:"link",template:function(t,e){var s=lan.site.backup_no,i="bt_warning";return t.backup_count>0&&(s=lan.site.backup_yes,i="bt_success"),'<a href="javascript:;" class="btlink  '+i+'">'+s+(t.backup_count>0?"("+t.backup_count+")":"")+"</a>"},event:function(t,e){site.site_detail(t.id,t.name)}},{fid:"path",title:"根目录",tips:"打开目录",type:"link",event:function(t,e,s){openPath(t.path)}},{fid:"edate",title:"到期时间",width:85,class:"set_site_edate",sort:!0,type:"link",template:function(t,e){var s="";return t.edate&&(s=t.edate),t.endtime&&(s=t.endtime),s="0000-00-00"===s?lan.site.web_end_time:s,s}},{fid:"ps",title:"备注",type:"input",blur:function(t,e,s){bt.pub.set_data_ps({id:t.id,table:"sites",ps:s.target.value},function(t){t.status||layer.msg(t.msg,{status:2})})},keyup:function(t,e,s){13===s.keyCode&&$(this).blur()}},{fid:"php_version",title:"PHP",tips:"选择php版本",width:50,type:"link",template:function(t,e){return t.php_version.indexOf("静态"),t.php_version},event:function(t,e){site.web_edit(t),setTimeout(function(){$(".site-menu p:eq(9)").click()},500)}},{fid:"ssl",title:"SSL证书",tips:"部署证书",width:100,type:"text",template:function(t,e){for(var s=t.ssl,i="",a=[["issuer","证书品牌"],["notAfter","到期日期"],["notBefore","申请日期"],["dns","可用域名"]],n=0;n<a.length;n++){var l=s[a[n][0]];i+=a[n][1]+":"+l+(a.length-1!=n?"\n":"")}return-1===t.ssl?'<a class="btlink" href="javascript:;" style="color:orange;">未部署</a>':'<a class="btlink" href="javascript:;" title="'+i+'">剩余'+t.ssl.endtime+"天</a>"},event:function(t,e,s,i,a){site.web_edit(t),setTimeout(function(){$(".site-menu p:eq(8)").click()},500)}},{title:"操作",type:"group",width:150,align:"right",group:[{title:"防火墙",event:function(t,e,s,i,a){site.site_waf(t.name)}},{title:"设置",event:function(t,e,s,i,a){site.web_edit(t,!0)}},{title:"删除",event:function(t,e,s,i,a){site.del_site(t.id,t.name,function(){a.$refresh_table_list(!0)})}}]}],sortParam:function(t){return{order:t.name+" "+t.sort}},success:function(t){$(".event-edate-"+t.random).each(function(){var e=$(this);laydate.render({elem:e[0],min:bt.get_date(1),max:"2099-12-31",vlue:bt.get_date(365),type:"date",format:"yyyy-MM-dd",trigger:"click",btns:["perpetual","confirm"],theme:"#20a53a",ready:function(){e.click()},done:function(e){var s=t.event_rows_model.rows;bt.site.set_endtime(s.id,e,function(t){if(t.status)return layer.msg(t.msg),!1;bt.msg(t)})}})})},tootls:[{type:"btnGroup",positon:["left","top"],list:[{title:"添加站点",active:!0,event:function(t){site.add_site(function(){site_table.$refresh_table_list(!0)}),bt.set_cookie("site_type","-1")}},{title:"修改默认页",event:function(t){site.set_default_page()}},{title:"默认站点",event:function(t){site.set_default_site()}},{title:"PHP命令行版本",event:function(t){site.get_cli_version()}},{title:"分类管理",group:!0,init:function(t){bt.site.get_type(function(e){var s="";$.each(e,function(t,e){s+='<li><a href="javascript:;" data-id="'+e.id+'">'+e.name+"</a></li>"}),s+='<li role="separator" class="divider"></li><li><a href="javascript:;" data-id="type_sets">分类设置</a></li>',$("."+t).next().html(s),$("."+t).next("ul").on("click","li a",function(){var t=$(this).data("id");"type_sets"==t?site.set_class_type():(bt.set_cookie("site_type",t),site_table.$refresh_table_list(!0))})})}}]},{type:"search",positon:["right","top"],placeholder:"请输入域名或备注",searchParam:"search",value:""},{type:"batch",positon:["left","bottom"],placeholder:"请选择批量操作",buttonValue:"批量操作",disabledSelectValue:"请选择需要批量操作的站点!",selectList:[{group:[{title:"开启站点",param:{status:1}},{title:"停止站点",param:{status:0}}],url:"/site?action=set_site_status_multiple",confirmVerify:!1,paramName:"sites_id",paramId:"id",theadName:"站点名称"},{title:"备份站点",url:"/site?action=ToBackup",paramId:"id",load:!0,theadName:"站点名称",callback:function(t){t.start_batch({},function(t){for(var e="",s=0;s<t.length;s++){var i=t[s];e+="<tr><td>"+i.name+'</td><td><div style="float:right;"><span style="color:'+(i.request.status?"#20a53a":"red")+'">'+i.request.msg+"</span></div></td></tr>"}site_table.$batch_success_table({title:"批量备份",th:"站点名称",html:e}),site_table.$refresh_table_list(!0)})}},{title:"设置到期时间",url:"/site?action=set_site_etime_multiple",paramName:"sites_id",paramId:"id",theadName:"站点名称",confirm:{title:"批量设置到期时间",content:'<div class="line"><span class="tname">到期时间</span><div class="info-r "><input name="edate" id="site_edate" class="bt-input-text mr5" placeholder="yyyy-MM-dd" type="text"></div></div>',success:function(){laydate.render({elem:"#site_edate",min:bt.format_data((new Date).getTime(),"yyyy-MM-dd"),max:"2099-12-31",vlue:bt.get_date(365),type:"date",format:"yyyy-MM-dd",trigger:"click",btns:["perpetual","confirm"],theme:"#20a53a"})},yes:function(t,e,s){var i=$("#site_edate"),a=i.val();if(""==a)return layer.tips("请输入到期时间","#site_edate",{tips:["1","red"]}),$("#site_edate").css("border-color","red"),$("#site_edate").click(),setTimeout(function(){$("#site_edate").removeAttr("style")},3e3),!1;s({edate:"永久"===a?"0000-00-00":a})}}},{title:"设置PHP版本",url:"/site?action=set_site_php_version_multiple",paramName:"sites_id",paramId:"id",theadName:"站点名称",confirm:{title:"批量设置PHP版本",area:"420px",content:'<div class="line"><span class="tname">PHP版本</span><div class="info-r"><select class="bt-input-text mr5 versions" name="versions" style="width:150px"></select></span></div><ul class="help-info-text c7" style="font-size:11px"><li>请根据您的程序需求选择版本</li><li>若非必要,请尽量不要使用PHP5.2,这会降低您的服务器安全性；</li><li>PHP7不支持mysql扩展，默认安装mysqli以及mysql-pdo。</li></ul></div>',success:function(){bt.site.get_all_phpversion(function(t){var e="";$.each(t,function(t,s){e+='<option value="'+s.version+'">'+s.name+"</option>"}),$('[name="versions"]').html(e)})},yes:function(t,e,s){s({version:$('[name="versions"]').val()})}}},{title:"设置分类",url:"/site?action=set_site_type",paramName:"site_ids",paramId:"id",beforeRequest:function(t){return JSON.stringify(t)},confirm:{title:"批量设置分类",content:'<div class="line"><span class="tname">站点分类</span><div class="info-r"><select class="bt-input-text mr5 site_types" name="site_types" style="width:150px"></select></span></div></div>',success:function(){bt.site.get_type(function(t){var e="";$.each(t,function(t,s){e+='<option value="'+s.id+'">'+s.name+"</option>"}),$('[name="site_types"]').html(e)})},yes:function(t,e,s){s({id:$('[name="site_types"]').val()})}},tips:!1,success:function(t,e,s){var i="";$.each(e,function(e,s){i+="<tr><td>"+s.name+'</td><td><div style="float:right;"><span style="color:'+(t.status?"#20a53a":"red")+'">'+t.msg+"</span></div></td></tr>"}),s.$batch_success_table({title:"批量设置分类",th:"站点名称",html:i})}},{title:"删除站点",url:"/site?action=delete_website_multiple",paramName:"sites_id",paramId:"id",theadName:"站点名称",confirm:function(t,e){bt.show_confirm("批量删除站点","是否同时删除选中站点同名的FTP、数据库、根目录",function(){var t={};$(".bacth_options input[type=checkbox]").each(function(){var e=$(this).is(":checked");e&&(t[$(this).attr("name")]=e?1:0)}),e&&e(t)},"<div class='options bacth_options'><span class='item'><label><input type='checkbox' name='ftp'><span>FTP</span></label></span><span class='item'><label><input type='checkbox' name='data'><span>"+lan.site.database+"</span></label></span><span class='item'><label><input type='checkbox' name='path'><span>"+lan.site.root_dir+"</span></label></span></div>")}}]},{type:"page",positon:["right","bottom"],pageParam:"p",page:1,numberParam:"limit",number:20,numberList:[10,20,50,100,200],numberStatus:!0,jump:!0}]}),site={get_list:function(t,e,s){null==t&&(t=1),"-1"!=s&&null!=s||(s=bt.get_cookie("site_type")),e||(e=$("#SearchValue").val()),bt.site.get_list(t,e,s,function(t){$(".dataTables_paginate").html(t.page);var e=t.data,s=(bt.render({table:"#webBody",columns:[{field:"id",type:"checkbox",width:30},{field:"name",title:"网站名",templet:function(t){return'<a class="btlink webtips" onclick="site.web_edit(this)" href="javascript:;">'+t.name+"</a>"},sort:function(){site.get_list()}},{field:"status",title:"状态",width:80,templet:function(t){var e='<a href="javascript:;" ';return"1"==t.status||"正常"==t.status||"正在运行"==t.status?(e+=' onclick="bt.site.stop('+t.id+",'"+t.name+"') \" >",e+='<span style="color:#5CB85C">运行中 </span><span style="color:#5CB85C" class="glyphicon glyphicon-play"></span>'):(e+=' onclick="bt.site.start('+t.id+",'"+t.name+"')\"",e+='<span style="color:red">已停止  </span><span style="color:red" class="glyphicon glyphicon-pause"></span>'),e},sort:function(){site.get_list()}},{field:"backup",title:"备份",width:58,templet:function(t){var e=lan.site.backup_no;return t.backup_count>0&&(e=lan.site.backup_yes),'<a href="javascript:;" class="btlink" onclick="site.site_detail('+t.id+",'"+t.name+"')\">"+e+"</a>"}},{field:"path",title:"根目录",templet:function(t){var e=bt.format_path(t.path);return'<a class="btlink" title="打开目录" href="javascript:openPath(\''+e+"');\">"+e+"</a>"}},{field:"edate",title:"到期时间",width:86,templet:function(t){var e="";return t.edate&&(e=t.edate),t.endtime&&(e=t.endtime),e="0000-00-00"==e?lan.site.web_end_time:e,'<a class="btlink setTimes" id="site_endtime_'+t.id+'" >'+e+"</a>"},sort:function(){site.get_list()}},{field:"ps",title:"备注",templet:function(t){return"<span class='c9 input-edit'  onclick=\"bt.pub.set_data_by_key('sites','ps',this)\">"+t.ps+"</span>"}},{field:"php_version",width:60,title:"PHP",templet:function(t){return'<a class="phpversion_tips btlink">'+t.php_version+"</a>"}},{field:"ssl",title:"SSL证书",width:80,templet:function(t){var e="";if(-1==t.ssl)e='<a class="ssl_tips btlink" style="color:orange;">未部署</a>';else{var s="证书品牌: "+t.ssl.issuer+"<br>到期日期: "+t.ssl.notAfter+"<br>申请日期: "+t.ssl.notBefore+"<br>可用域名: "+t.ssl.dns.join("/");e=t.ssl.endtime<0?'<a class="ssl_tips btlink" style="color:red;" data-tips="'+s+'">已过期</a>':t.ssl.endtime<20?'<a class="ssl_tips btlink" style="color:red;" data-tips="'+s+'">剩余'+t.ssl.endtime+"天</a>":'<a class="ssl_tips btlink" style="color:green;" data-tips="'+s+'">剩余'+t.ssl.endtime+"天</a>"}return e}},{field:"opt",width:150,title:"操作",align:"right",templet:function(t){var e="",s=" onclick=\"site.site_waf('"+t.name+"')\"";return"Linux"==bt.os&&(e+='<a href="javascript:;" '+s+' class="btlink ">防火墙</a> | '),e+='<a href="javascript:;" class="btlink" onclick="site.web_edit(this)">设置 </a> | ',e+='<a href="javascript:;" class="btlink" onclick="site.del_site('+t.id+",'"+t.name+'\')" title="删除站点">删除</a>',e}}],data:e}),"");$(".ssl_tips").hover(function(){var t=this,e=$(t).attr("data-tips");if(!e)return!1;s=setTimeout(function(){layer.tips(e,$(t),{tips:[2,"#20a53a"],time:0})},500)},function(){""!=s&&clearTimeout(s),layer.closeAll("tips")}),$(".ssl_tips").click(function(){site.web_edit(this);var t=setInterval(function(){var e=$("#webedit-con").html();""!=e&&($(".site-menu p:eq(8)").click(),clearInterval(t))},100)}),$(".phpversion_tips").click(function(){site.web_edit(this);var t=setInterval(function(){var e=$("#webedit-con").html();""!=e&&($(".site-menu p:eq(9)").click(),clearInterval(t))},100)}),$("a.setTimes").each(function(){var t=$(this),e=t.parents("tr"),s=t.attr("id");laydate.render({elem:"#"+s,min:bt.get_date(1),max:"2099-12-31",vlue:bt.get_date(365),type:"date",format:"yyyy-MM-dd",trigger:"click",btns:["perpetual","confirm"],theme:"#20a53a",done:function(t){var s=e.data("item");bt.site.set_endtime(s.id,t,function(){})}})})})},site_waf:function(t){try{site_waf_config(t)}catch(t){site.no_firewall()}},html_encode:function(t){var e=document.createElement("div");null!=e.textContent?e.textContent=t:e.innerText=t;var s=e.innerHTML;return e=null,s},get_types:function(t){bt.site.get_type(function(e){for(var s="",i=bt.get_cookie("site_type"),a=0;a<e.length;a++)s+='<button class="btn btn-'+(i==e[a].id?"success":"default")+' btn-sm" value="'+e[a].id+'">'+e[a].name+"</button>";$(".dataTables_paginate").next().hasClass("site_type")&&$(".site_type").remove(),$(".dataTables_paginate").after('<div class="site_type"><button class="btn btn-'+("-1"==i?"success":"default")+' btn-sm" value="-1">全部分类</button>'+s+"</div>"),$(".site_type button").click(function(){var t=$(this).attr("value");bt.set_cookie("site_type",t),site.get_list(0,"",t),$(".site_type button").removeClass("btn-success").addClass("btn-default"),$(this).addClass("btn-success")}),t&&t(e)})},no_firewall:function(t){var e=bt.get_cookie("serverType");layer.confirm(e+'防火墙暂未开通，<br>请到&quot;<a href="/soft" class="btlink">软件管理>付费插件>'+e+"防火墙</a>&quot;<br>开通安装使用。",{title:e+"防火墙未开通",icon:7,closeBtn:2,cancel:function(){t&&$(t).prop("checked",!1)}},function(){window.location.href="/soft"},function(){t&&$(t).prop("checked",!1)})},site_detail:function(t,e,s){null==s&&(s="1");var i=bt.load(lan.public.the_get);bt.pub.get_data("table=backup&search="+t+"&limit=5&type=0&tojs=site.site_detail&p="+s,function(s){i.close();s.page=s.page.replace(/'/g,'"').replace(/site.site_detail\(/g,"site.site_detail("+t+",'"+e+"',"),$("#SiteBackupList").length<=0&&bt.open({type:1,skin:"demo-class",area:"700px",title:lan.site.backup_title,closeBtn:2,shift:5,shadeClose:!1,content:"<div class='divtable pd15 style='padding-bottom: 0'><button id='btn_data_backup' class='btn btn-success btn-sm' type='button' style='margin-bottom:10px'>"+lan.database.backup+"</button><table width='100%' id='SiteBackupList' class='table table-hover'></table><div class='page sitebackup_page'></div></div>"}),setTimeout(function(){$(".sitebackup_page").html(s.page);bt.render({table:"#SiteBackupList",columns:[{field:"name",title:"文件名称"},{field:"size",title:"文件大小",templet:function(t){return bt.format_size(t.size)}},{field:"addtime",title:"备份时间"},{field:"opt",title:"操作",align:"right",templet:function(s){var i='<a class="btlink" href="/download?filename='+s.filename+"&amp;name="+s.name+'" target="_blank">下载</a> | ';return i+='<a class="btlink" herf="javascrpit:;" onclick="bt.site.del_backup(\''+s.id+"','"+t+"','"+e+"')\">删除</a>",i}}],data:s.data});$("#btn_data_backup").unbind("click").click(function(){bt.site.backup_data(t,function(s){s.status&&site.site_detail(t,e)})})},100)})},add_site:function(t){var e=bt_tools.form({data:{},class:"",form:[{label:"域名",group:{type:"textarea",name:"webname",style:{width:"440px",height:"100px","line-height":"22px"},tips:{text:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口<br>泛解析添加方法 *.domain.com<br>如另加端口格式为 www.domain.com:88",style:{top:"15px",left:"15px"}},keyup:function(t,e,s,i,a){var n=t.webname.split("\n"),l=n[0].split(":")[0],c=bt.strim(l.replace(new RegExp(/([-.])/g),"_")),r=$("#defaultPath").text(),o=l.length>0;s.$set_find_value(o?{ftp_username:"ftp_"+c,ftp_password:bt.get_random(16),datauser:o?"sql_"+c.substr(0,16):"",datapassword:bt.get_random(16),ps:c,path:bt.rtrim(r,"/")+"/"+l}:{ftp_username:"",ftp_password:"",datauser:"",datapassword:"",ps:"",path:bt.rtrim(r,"/")})}}},{label:"备注",group:{type:"text",name:"ps",width:"400px",placeholder:"网站备注，可为空"}},{label:"根目录",group:{type:"text",width:"400px",name:"path",icon:{type:"glyphicon-folder-open",event:function(t){console.log(t)}},value:"/www/wwwroot",placeholder:"请选择文件目录"}},{label:"FTP",group:[{type:"select",name:"ftp",width:"120px",disabled:!bt.config["pure-ftpd"]||!bt.config["pure-ftpd"].setup,list:[{title:"不创建",value:!1},{title:"创建",value:!0}],change:function(t,e,s,i,a){"true"===t.ftp?e.ftp_username.parents(".line").removeClass("hide"):e.ftp_username.parents(".line").addClass("hide")}}]},{label:"FTP账号",hide:!0,group:[{type:"text",name:"ftp_username",placeholder:"创建FTP账号",width:"175px",style:{"margin-right":"15px"}},{label:"密码",type:"text",placeholder:"FTP密码",name:"ftp_password",width:"175px"}],help:{list:["创建站点的同时，为站点创建一个对应FTP帐户，并且FTP目录指向站点所在目录。"]}},{label:"数据库",group:[{type:"select",name:"sql",width:"120px",disabled:!bt.config.mysql||!bt.config.mysql.setup,list:[{title:"不创建",value:!1},{title:"MySQL",value:"MySQL"},{title:"SQLServer",value:"SQLServer",disabled:!0,tips:"Linux暂不支持SQLServer!"}],change:function(t,e,s,i,a){"MySQL"===t.sql?(e.datauser.parents(".line").removeClass("hide"),e.codeing.parents(".bt_select_updown").removeClass("hide")):(e.datauser.parents(".line").addClass("hide"),e.codeing.parents(".bt_select_updown").addClass("hide"))}},{type:"select",name:"codeing",hide:!0,width:"120px",list:[{title:"utf8",value:"utf8"},{title:"utf8mb4",value:"utf8mb4"},{title:"gbk",value:"gbk"},{title:"big5",value:"big5"}]}]},{label:"数据库账号",hide:!0,group:[{type:"text",name:"datauser",placeholder:"创建数据库账号",width:"175px",style:{"margin-right":"15px"}},{label:"密码",type:"text",placeholder:"数据库密码",name:"datapassword",width:"175px"}],help:{class:"",style:"",list:["创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。"]}},{label:"PHP版本",group:[{type:"select",name:"version",width:"120px",list:{url:"/site?action=GetPHPVersion",dataFilter:function(t){for(var e=[],s=t.length-1;s>=0;s--){var i=t[s];e.push({title:i.name,value:i.version})}return e}}}]},{label:"网站分类",group:[{type:"select",name:"type_id",width:"120px",list:{url:"/site?action=get_site_types",dataFilter:function(t){var e=[];return $.each(t,function(t,s){e.push({title:s.name,value:s.id})}),e}}}]}]}),s=bt_tools.form({class:"plr10",form:[{line_style:{position:"relative"},group:{type:"textarea",name:"bath_code",style:{width:"560px",height:"180px","line-height":"22px","font-size":"13px"},value:"域名|1|0|0|0\n域名|1|0|0|0\n域名|1|0|0|0"}},{group:{type:"help",style:{"margin-top":"0"},class:"none-list-style",list:["批量格式：域名|根目录|FTP|数据库|PHP版本",'<span style="padding-top:5px;display:inline-block;">域名参数：多个域名用&nbsp;,&nbsp;分割</span>',"根目录参数：填写&nbsp;1&nbsp;为自动创建，或输入具体目录","FTP参数：填写&nbsp;1&nbsp;为自动创建，填写&nbsp;0&nbsp;为不创建","数据库参数：填写&nbsp;1&nbsp;为自动创建，填写&nbsp;0&nbsp;为不创建","PHP版本参数：填写&nbsp;0&nbsp;为静态，或输入PHP具体版本号列如：56、71、74",'<span style="padding-bottom:5px;display:inline-block;">如需添加多个站点，请换行填写</span>',"案例：bt.cn,test.cn:8081|/www/wwwroot/bt.cn|1|1|56"]}}]}),i=bt_tools.tab({class:"pd20",type:0,theme:{nav:"mlr20"},active:1,list:[{title:"创建站点",name:"createSite",content:e.$reader_content(),success:function(){e.$event_bind()}},{title:"批量创建",name:"batchCreation",content:s.$reader_content(),success:function(){s.$event_bind()}}],success:function(){}});bt_tools.open({title:"添加站点-支持批量建站",skin:"custom_layer",btn:["提交","取消"],content:i.$reader_content(),success:function(){i.$init()},yes:function(a){var n=i.active?s.$get_form_value():e.$get_form_value();if(i.active){_=bt.load();if(""===n.bath_code)return bt_tools.msg("请输入需要批量创建的站点信息!",2),!1;for(y=n.bath_code.split("\n"),g=0;g<y.length;g++){var l=y[g],c=l.split("|");console.log(c);for(var r=0;r<c.length;r++){var o=g+1,d=c[r];switch(r){case 0:for(var p=d.split(","),u=0;u<p.length;u++){var m=p[u],b=m.split(":");if(console.log(b[0],"1111111"),!bt.check_domain(b[0]))return bt_tools.msg("第"+o+"行,域名格式错误【"+m+"】",2),!1;if(void 0!==b[1]&&!bt.check_port(b[1]))return bt_tools.msg("第"+o+"行,域名端口格式错误【"+b[1]+"】",2),!1}break;case 1:if("1"!==d&&d.indexOf("/")<-1)return bt_tools.msg("第"+o+"行,站点目录格式错误【"+d+"】",2),!1}}}bt.send("create_type","site/create_website_multiple",{create_type:"txt",websites_content:JSON.stringify(y)},function(t){if(_.close(),t.status){var e="";layer.close(a),$.each(t.error,function(t,s){e+="<tr><td>"+t+'</td><td>--</td><td>--</td><td style="text-align: right;"><span style="color:red">'+s+"</td></td></tr>"}),$.each(t.success,function(t,s){e+="<tr><td>"+t+"</td><td>"+(s.ftp_status?'<span style="color:#20a53a">成功</span>':"<span>未创建</span>")+"</td><td>"+(s.db_status?'<span style="color:#20a53a">成功</span>':"<span>未创建</span>")+'</td><td  style="text-align: right;"><span style="color:#20a53a">创建成功</span></td></tr>'}),bt.open({type:1,title:"站点批量添加",area:["500px","450px"],shadeClose:!1,closeBtn:2,content:'<div class="fiexd_thead divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 360px;"><table class="table table-hover"><thead><tr><th>站点名称</th><th>FTP</th><th>数据库</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+e+"</tbody></table></div>",success:function(){$(".fiexd_thead").scroll(function(){var t=this.scrollTop;this.querySelector("thead").style.transform="translateY("+t+"px)"})}})}else bt.msg(t)})}else{var _=bt.load();if(e.$get_form_element(!0),""===n.webname)return e.form_element.webname.focus(),void bt_tools.msg("域名不能为空！",2);for(var h=bt.replace_all(n.webname,"http[s]?:\\/\\/",""),f=h.split("\n"),v={webname:{domain:"",domainlist:[],count:0},type:"PHP",port:80},y=["ps",["path","网站目录"],"type_id","version","ftp","sql","ftp_username","ftp_password","datauser","datapassword","codeing"],g=0;g<f.length;g++){var x=f[g].split(":"),w=x[0],k=x[1];if(!bt.check_domain(w))return void bt_tools.msg(lan.site.domain_err_txt,2);if(void 0!==k&&!bt.check_port(k))return void bt_tools.msg("端口格式不正确！",2);0===g?(v.webname.domain=f[g],void 0!==k&&(v.port=k)):v.webname.domainlist.push(f[g])}v.webname.count=v.webname.domainlist.length,v.webname=JSON.stringify(v.webname),$.each(y,function(t,e){return""==n[e]&&Array.isArray(e)?(bt_tools.msg(e[1]+"不能为空?",2),!1):(Array.isArray(e)&&(e=e[0]),"false"===n.ftp&&("ftp_username"===e||"ftp_password"===e)||("false"===n.sql&&("datauser"===e||"datapassword"===e)||void(v[e]=n[e])))}),bt.send("AddSite","site/AddSite",v,function(e){if(_.close(),e.siteStatus){layer.close(a),t&&t(e);var s="",i="";if(e.ftpStatus){var n=[];n.push({title:lan.site.user,val:e.ftpUser}),n.push({title:lan.site.password,val:e.ftpPass});var l={};l.title=lan.site.ftp,l.list=n,s=bt.render_ps(l)}if(e.databaseStatus){n=[];n.push({title:lan.site.database_name,val:e.databaseUser}),n.push({title:lan.site.user,val:e.databaseUser}),n.push({title:lan.site.password,val:e.databasePass});l={};l.title=lan.site.database_txt,l.list=n,i=bt.render_ps(l)}""==s&&""==i?bt.msg({msg:lan.site.success_txt,icon:1}):(bt.open({type:1,area:"600px",title:lan.site.success_txt,closeBtn:2,shadeClose:!1,content:"<div class='success-msg'><div class='pic'><img src='/static/img/success-pic.png'></div><div class='suc-con'>"+s+i+"</div></div>"}),$(".success-msg").height()<150&&$(".success-msg").find("img").css({width:"150px","margin-top":"30px"}))}else bt.msg(e)})}}})},set_default_page:function(){bt.open({type:1,area:"460px",title:lan.site.change_defalut_page,closeBtn:2,shift:0,content:'<div class="change-default pd20"><button  class="btn btn-default btn-sm ">'+lan.site.default_doc+'</button><button  class="btn btn-default btn-sm">'+lan.site.err_404+'</button>\t<button  class="btn btn-default btn-sm ">'+lan.site.empty_page+'</button><button  class="btn btn-default btn-sm ">'+lan.site.default_page_stop+"</button></div>"}),setTimeout(function(){$(".change-default button").click(function(){bt.site.get_default_path($(this).index(),function(t){bt.pub.on_edit_file(0,t)})})},100)},set_default_site:function(){bt.site.get_default_site(function(t){var e=[];e.push({title:"未设置默认站点",value:"0"});for(var s=0;s<t.sites.length;s++)e.push({title:t.sites[s].name,value:t.sites[s].name});var i={title:lan.site.default_site_yes,area:"530px",list:[{title:lan.site.default_site,name:"defaultSite",width:"300px",value:t.defaultSite,type:"select",items:e}],btns:[bt.form.btn.close(),bt.form.btn.submit("提交",function(t,e){bt.site.set_default_site(t.defaultSite,function(t){e.close(),bt.msg(t)})})]};bt.render_form(i),$(".line").after($(bt.render_help([lan.site.default_site_help_1,lan.site.default_site_help_2])).addClass("plr20"))})},get_cli_version:function(){$.post("/config?action=get_cli_php_version",{},function(t){if(!1!==t.status){for(var e="",s=t.versions.length-1;s>=0;s--){var i="";t.select.version==t.versions[s].version&&(i="selected"),e+='<option value="'+t.versions[s].version+'" '+i+">"+t.versions[s].name+"</option>"}var a='<div class="bt-form bt-form pd20 pb70">                <div class="line">                    <span class="tname">PHP-CLI版本</span>                    <div class="info-r ">                        <select class="bt-input-text mr5" name="php_version" style="width:300px">'+e+'</select>                    </div>                </div >                <ul class="help-info-text c7 plr20">                    <li>此处可设置命令行运行php时使用的PHP版本</li>                    <li>安装新的PHP版本后此处需要重新设置</li>                </ul>                <div class="bt-form-submit-btn"><button type="button" class="btn btn-sm btn-danger" onclick="layer.closeAll()">关闭</button><button type="button" class="btn btn-sm btn-success" onclick="site.set_cli_version()">提交</button></div></div>';layer.open({type:1,title:"设置PHP-CLI(命令行)版本",area:"560px",closeBtn:2,shadeClose:!1,content:a})}else layer.msg(t.msg,{icon:2})})},set_cli_version:function(){var t=$("select[name='php_version']").val(),e=bt.load();$.post("/config?action=set_cli_php_version",{php_version:t},function(t){e.close(),t.status&&layer.closeAll(),layer.msg(t.msg,{icon:t.status?1:2})})},del_site:function(t,e,s){var i="<div class='options'><span class='item'><label><input type='checkbox' id='delftp' name='ftp'><span>FTP</span></label></span><span class='item'><label><input type='checkbox' id='deldata' name='data'><span>"+lan.site.database+"</span></label></span><span class='item'><label><input type='checkbox' id='delpath' name='path'><span>"+lan.site.root_dir+"</span></label></span></div>";bt.show_confirm(lan.site.site_del_title+"["+e+"]",lan.site.site_del_info,function(){var i="";i={id:t,webname:e};$("#delftp").is(":checked")&&(i.ftp=1),$("#deldata").is(":checked")&&(i.database=1),$("#delpath").is(":checked")&&(i.path=1),bt.site.del_site(i,function(t){t.status&&(s?s(t):site.get_list()),bt.msg(t)})},i)},batch_site:function(t,e,s){if(null!=e){var i=e.data[0];switch(t){case"del":if(e.data.length<1)return site.get_list(),void bt.msg({msg:lan.get("del_all_site_ok",[s.count]),icon:1,time:5e3});var a={id:i.id,webname:i.name,path:e.path};bt.site.del_site(a,function(a){a.status?s.count+=1:s.error_list.push({name:i.item,err_msg:a.msg}),e.data.splice(0,1),site.batch_site(t,e,s)})}}else{e={};var n=[];if(s={count:0,error_list:[]},$('input[type="checkbox"].check:checked').each(function(){var t=$(this).val();isNaN(t)||n.push($(this).parents("tr").data("item"))}),"site_type"==t)return void bt.site.get_type(function(t){for(var e=[],s=0;s<t.length;s++)e.push({title:t[s].name,value:t[s].id});var i={title:"设置站点分类",area:"530px",list:[{title:lan.site.default_site,name:"type_id",width:"300px",type:"select",items:e}],btns:[bt.form.btn.close(),bt.form.btn.submit("提交",function(t,e){for(var s=[],i=0;i<n.length;i++)s.push(n[i].id);bt.site.set_site_type({id:t.type_id,site_array:JSON.stringify(s)},function(t){t.status&&(e.close(),site.get_list()),bt.msg(t)})})]};bt.render_form(i)});var l="<div class='options'><label style=\"width:100%;\"><input type='checkbox' id='delpath' name='path'><span>"+lan.site.all_del_info+"</span></label></div>";bt.show_confirm(lan.site.all_del_site,"<a style='color:red;'>"+lan.get("del_all_site",[n.length])+"</a>",function(){$("#delpath").is(":checked")&&(e.path="1"),e.data=n,bt.closeAll(),site.batch_site(t,e,s)},l)}},set_class_type:function(){var t=bt.render_form_line({title:"",items:[{placeholder:"请填写分类名称",name:"type_name",width:"50%",type:"text"},{name:"btn_submit",text:"添加",type:"button",callback:function(t){bt.site.add_type(t.type_name,function(t){t.status&&($('[name="type_name"]').val(""),site.get_class_type()),bt.msg(t)})}}]});bt.open({type:1,area:"350px",title:"网站分类管理",closeBtn:2,shift:5,shadeClose:!0,content:"<div class='bt-form edit_site_type'><div class='divtable mtb15' style='overflow:auto'>"+t.html+"<table id='type_table' class='table table-hover' width='100%'></table></div></div>",success:function(){bt.render_clicks(t.clicks),site.get_class_type(function(t){$("#type_table").on("click",".del_type",function(){var t=$(this),e=t.parents("tr").data("item");0!=e.id?bt.confirm({msg:"是否确定删除分类？",title:"删除分类【"+e.name+"】"},function(){bt.site.del_type(e.id,function(t){t.status&&(site.get_class_type(),bt.set_cookie("site_type","-1")),bt.msg(t)})}):bt.msg({icon:2,msg:"默认分类不可删除/不可编辑!"})}),$("#type_table").on("click",".edit_type",function(){var t=$(this).parents("tr").data("item");0!=t.id?bt.render_form({title:"修改分类管理【"+t.name+"】",area:"350px",list:[{title:"分类名称",width:"150px",name:"name",value:t.name}],btns:[{title:"关闭",name:"close"},{title:"提交",name:"submit",css:"btn-success",callback:function(e,s,i){bt.site.edit_type({id:t.id,name:e.name},function(t){t.status&&(s.close(),site.get_class_type()),bt.msg(t)})}}]}):bt.msg({icon:2,msg:"默认分类不可删除/不可编辑!"})})})}})},get_class_type:function(t){site.get_types(function(e){bt.render({table:"#type_table",columns:[{field:"name",title:"名称"},{field:"opt",width:"80px",title:"操作",templet:function(t){return'<a class="btlink edit_type" href="javascript:;">编辑</a> | <a class="btlink del_type" href="javascript:;">删除</a>'}}],data:e}),$(".layui-layer-page").css({"margin-top":"-"+$(".layui-layer-page").height()/2+"px",top:"50%"}),t&&t(e)})},ssl:{my_ssl_msg:null,renew_ssl:function(t,e,s){acme.siteName=t,32===s.length&&-1===s.indexOf("/")?acme.renew(s,function(s){site.ssl.ssl_result(s,e,t)}):acme.get_cert_init(s,t,function(t){acme.domains=t.dns;for(var e='<option value="http">文件验证 - HTTP</option>',s=0;s<t.dnsapi.length;s++)e+='<option value="'+t.dnsapi[s].name+'">DNS验证 - '+t.dnsapi[s].title+"</option>";acme.select_loadT=layer.open({title:"续签Let's Encrypt证书",type:1,closeBtn:2,shade:.3,area:"500px",offset:"30%",content:'<div style="margin: 10px;">                                    <div class="line ">                                        <span class="tname" style="padding-right: 15px;margin-top: 8px;">请选择验证方式</span>                                        <div class="info-r label-input-group ptb10">                                            <select class="bt-input-text" name="auth_to">'+e+'</select>                                            <span class="dnsapi-btn"></span>                                            <span class="renew-onkey"><button class="btn btn-success btn-sm mr5" style="margin-left: 10px;" onclick="site.ssl.renew_ssl_other()">一键续签</button></span>                                        </div>                                    </div>                                    <ul class="help-info-text c7">                                        <li>通配符证书不能使用【文件验证】，请选择DNS验证</li>                                        <li>使用【文件验证】，请确保没有开[启强制HTTPS/301重定向/反向代理]等功能</li>                                        <li>使用【阿里云DNS】【DnsPod】等验证方式需要设置正确的密钥</li>                                        <li>续签成功后，证书将在下次到期前30天尝试自动续签</li>                                        <li>使用【DNS验证 - 手动解析】续签的证书无法实现下次到期前30天自动续签</li>                                    </ul>                                  </div>',success:function(e){$("select[name='auth_to']").change(function(){var e=$(this).val();$(".dnsapi-btn").html("");for(var s=0;s<t.dnsapi.length;s++)if(t.dnsapi[s].name===e&&(acme.dnsapi=t.dnsapi[s],t.dnsapi[s].data)){if($(".dnsapi-btn").html('<button class="btn btn-default btn-sm mr5 set_dns_config" onclick="site.ssl.show_dnsapi_setup()">设置</button>'),t.dnsapi[s].data[0].value||t.dnsapi[s].data[1].value)break;site.ssl.show_dnsapi_setup()}})}})})},renew_ssl_other:function(){var t=$("select[name='auth_to']").val(),e="http";if("http"===t){if(-1!==JSON.stringify(acme.domains).indexOf("*."))return void layer.msg("包含通配符的域名不能使用文件验证(HTTP)!",{icon:2});t=acme.id}else{if("dns"!==t){if("Dns_com"===t&&(acme.dnsapi.data=[{value:"None"},{value:"None"}]),!acme.dnsapi.data[0].value||!acme.dnsapi.data[1].value)return void layer.msg("请先设置【"+acme.dnsapi.title+"】接口信息!",{icon:2})
;t=t+"|"+acme.dnsapi.data[0].value+"|"+acme.dnsapi.data[1].value}e="dns"}layer.close(acme.select_loadT),acme.apply_cert(acme.domains,e,t,"0",function(t){site.ssl.ssl_result(t,e,acme.siteName)})},show_dnsapi_setup:function(){var t=acme.dnsapi;acme.dnsapi_loadT=layer.open({title:"设置【"+t.title+"】接口",type:1,closeBtn:0,shade:.3,area:"550px",offset:"30%",content:'<div class="bt-form bt-form pd20 pb70 ">                            <div class="line ">                                <span class="tname" style="width: 125px;">'+t.data[0].key+'</span>                                <div class="info-r" style="margin-left:120px">                                    <input name="'+t.data[0].name+'" class="bt-input-text mr5 dnsapi-key" type="text" style="width:330px" value="'+t.data[0].value+'">                                </div>                            </div>                            <div class="line ">                                <span class="tname" style="width: 125px;">'+t.data[1].key+'</span>                                <div class="info-r" style="margin-left:120px">                                    <input name="'+t.data[1].name+'" class="bt-input-text mr5 dnsapi-token" type="text" style="width:330px" value="'+t.data[1].value+'">                                </div>                            </div>                            <div class="bt-form-submit-btn">                                <button type="button" class="btn btn-sm btn-danger" onclick="layer.close(acme.dnsapi_loadT);">关闭</button>                                <button type="button" class="btn btn-sm btn-success dnsapi-save">保存</button>                            </div>                            <ul class="help-info-text c7">                                <li>'+t.help+"</li>                            </ul>                          </div>",success:function(t){$(".dnsapi-save").click(function(){var t=$(".dnsapi-key"),e=$(".dnsapi-token");pdata={},pdata[t.attr("name")]=t.val(),pdata[e.attr("name")]=e.val(),acme.dnsapi.data[0].value=t.val(),acme.dnsapi.data[1].value=e.val(),bt.site.set_dns_api({pdata:JSON.stringify(pdata)},function(t){t.status&&layer.close(acme.dnsapi_loadT),bt.msg(t)})})}})},set_cert:function(t,e){var s=bt.load(lan.site.saving_txt),i={type:1,siteName:t,key:e.private_key,csr:e.cert+e.root};bt.send("SetSSL","site/SetSSL",i,function(t){s.close(),site.reload(),layer.msg(e.msg,{icon:1})})},show_error:function(t,e){var s="500px",i="";if(void 0===t.msg[1].challenges)i+="<p><span>响应状态:</span>"+t.msg[1].status+"</p>",i+="<p><span>错误类型:</span>"+t.msg[1].type+"</p>",i+="<p><span>错误代码:</span>"+t.msg[1].detail+"</p>";else if(t.msg[1].challenges[1]||t.msg[1].challenges[0]&&(t.msg[1].challenges[1]=t.msg[1].challenges[0]),"invalid"===t.msg[1].status){s="600px";for(var a=$("#dns_txt_jx tbody tr"),n="",l=0;l<a.length;l++)if(-1!=a[l].outerText.indexOf(t.msg[1].identifier.value)){var c=a[l].outerText.split("\t");if(c.length>1){n=c[1];break}}if(i+="<p><span>验证域名:</span>"+t.msg[1].identifier.value+"</p>","dns"===e){var r="_acme-challenge."+t.msg[1].identifier.value;i+="<p><span>验证解析:</span>"+r+"</p>",i+="<p><span>验证内容:</span>"+n+"</p>",i+="<p><span>错误代码:</span>"+site.html_encode(t.msg[1].challenges[1].error.detail)+"</p>"}else{r="http://"+t.msg[1].identifier.value+"/.well-known/acme-challenge/"+t.msg[1].challenges[0].token;i+="<p><span>验证URL:</span><a class='btlink' href='"+r+"' target='_blank'>点击查看</a></p>",i+="<p><span>验证内容:</span>"+t.msg[1].challenges[0].token+"</p>",i+="<p><span>错误代码:</span>"+site.html_encode(t.msg[1].challenges[0].error.detail)+"</p>"}i+="<p><span>验证结果:</span> <a style='color:red;'>验证失败</a></p>"}layer.msg('<div class="ssl-file-error"><a style="color: red;font-weight: 900;">'+t.msg[0]+"</a>"+i+"</div>",{icon:2,time:0,shade:.3,shadeClose:!0,area:s})},ssl_result:function(t,e,s){if(layer.close(acme.loadT),!1!==t.status||"string"!=typeof t.msg)if(!0!==t.status&&"pending"!==t.status&&void 0===t.save_path)site.ssl.show_error(t,e);else{if("dns"==e&&"pending"===t.status){var i=bt.open({type:1,area:"700px",title:"手动解析TXT记录",closeBtn:2,shift:5,shadeClose:!1,content:"<div class='divtable pd15 div_txt_jx'>                                    <p class='mb15' >请按以下列表做TXT解析:</p>                                    <table id='dns_txt_jx' class='table table-hover'></table>                                    <div class='text-right mt10'>                                        <button class='btn btn-success btn-sm btn_check_txt' >验证</button>                                    </div>                                    </div>"});return $(".btn_check_txt").click(function(){acme.auth_domain(t.index,function(t){layer.close(acme.loadT),!0===t.status?(i.close(),site.ssl.set_cert(s,t)):site.ssl.show_error(t,e)})}),void setTimeout(function(){var e=[];acme_txt="_acme-challenge.";for(var s=0;s<t.auths.length;s++)e.push({name:acme_txt+t.auths[s].domain.replace("*.",""),type:"TXT",txt:t.auths[s].auth_value,force:"是"}),e.push({name:t.auths[s].domain.replace("*.",""),type:"CAA",txt:'0 issue "letsencrypt.org"',force:"否"});bt.render({table:"#dns_txt_jx",columns:[{field:"name",width:"220px",title:"解析域名"},{field:"txt",title:"记录值"},{field:"type",title:"类型"},{field:"force",title:"必需"}],data:e}),$(".div_txt_jx").append(bt.render_help(["解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮","可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt "+acme_txt+t.auths[0].domain.replace("*.",""),"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"]))})}site.ssl.set_cert(s,t)}else bt.msg(t)},get_renew_stat:function(){$.post("/ssl?action=Get_Renew_SSL",{},function(t){if(t.status){for(var e="",s=!1,i=0;i<t.data.length;i++)e+="<p>"+t.data[i].subject+" >> "+t.data[i].msg+"</p>",!0!==t.data[i].status&&!1!==t.data[i].status&&(s=!0);site.ssl.my_ssl_msg?$(".my-renew-ssl").html(e):site.ssl.my_ssl_msg=layer.msg('<div class="my-renew-ssl">'+e+"</div>",{time:0,icon:16,shade:.3}),s?setTimeout(function(){site.ssl.get_renew_stat()},1e3):setTimeout(function(){layer.close(site.ssl.my_ssl_msg),site.ssl.my_ssl_msg=null},3e3)}})},onekey_ssl:function(t,e){bt.site.get_ssl_info(t,e,function(t){bt.msg(t),t.status&&site.reload(7)})},set_ssl_status:function(t,e,s){bt.site.set_ssl_status(t,e,function(e){bt.msg(e),e.status&&(site.reload(7),null!=s&&setTimeout(function(){$("#ssl_tabs span:eq("+s+")").click()},1e3),"CloseSSLConf"==t&&layer.msg(lan.site.ssl_close_info,{icon:1,time:5e3}))})},verify_domain:function(t,e){bt.site.verify_domain(t,e,function(s){bt.msg(s),s.status&&("COMPLETED"==s.data.stateCode?site.ssl.onekey_ssl(t,e):layer.msg("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."))})},reload:function(t){null==t&&(t=0);var e=$("#ssl_tabs .on");0==e.length&&(e=$("#ssl_tabs span:eq(0)")),e.trigger("click")}},edit:{set_domains:function(t){var e=[{class:"mb0",items:[{name:"newdomain",width:"340px",type:"textarea",placeholder:"每行填写一个域名，默认为80端口<br>泛解析添加方法 *.domain.com<br>如另加端口格式为 www.domain.com:88"},{name:"btn_submit_domain",text:"添加",type:"button",callback:function(e){for(var s=e.newdomain.split("\n"),i="",a=0;a<s.length;a++)i+=s[a]+",";bt.site.add_domains(t.id,t.name,bt.rtrim(i,","),function(t){t.status&&site.reload(0)})}}]}],s=bt.render_form_line(e[0]),i=null,a=null;$("#webedit-con").html(s.html+"<div class='bt_table' id='domain_table' style='height:350px;overflow:auto'></div>"),bt.render_clicks(s.clicks),$(".btn_submit_domain").addClass("pull-right").css("margin","30px 35px 0 0"),a=$(".placeholder"),a.click(function(){$(this).hide(),$(".newdomain").focus()}).css({width:"340px",heigth:"100px",left:"0px",top:"0px","padding-top":"10px","padding-left":"15px"}),$(".newdomain").focus(function(){a.hide(),console.log(a),i=layer.tips(a.html(),$(this),{tips:[1,"#20a53a"],time:0,area:$(this).width()})}).blur(function(){0==$(this).val().length&&a.show(),layer.close(i)}),bt_tools.table({el:"#domain_table",url:"/data?action=getData",param:{table:"domain",list:"True",search:t.id},dataFilter:function(t){return{data:t}},column:[{type:"checkbox",width:20,keepNumber:1},{fid:"name",title:"域名",template:function(t){return'<a href="http://'+t.name+":"+t.port+'" target="_blank" class="btlink">'+t.name+"</a>"}},{fid:"port",title:"端口",width:50,type:"text"},{title:"操作",width:80,type:"group",align:"right",group:[{title:"删除",template:function(t,e){return 1===e.data.length?"<span>不可操作</span>":"删除"},event:function(e,s,i,a,n){if(1===n.data.length)return bt.msg({status:!1,msg:"最后一个域名不能删除!"}),!1;bt.confirm({title:"删除域名【"+e.name+"】",msg:lan.site.domain_del_confirm},function(){bt.site.del_domain(t.id,t.name,e.name,e.port,function(t){t.status&&n.$delete_table_row(s),bt.msg(t)})})}}]}],tootls:[{type:"batch_btn",positon:["left","bottom"],placeholder:"请选择批量操作",buttonValue:"批量操作",disabledSelectValue:"请选择需要批量操作的域名!",selectList:[{title:"删除域名",batch_btn_name:"批量删除",url:"/site?action=delete_domain_multiple",param:{id:t.id},paramId:"id",paramName:"domains_id",theadName:"域名",confirmVerify:!1}]}]})},set_dirbind:function(t){$("#webedit-con").html('<div id="sub_dir_table"></div>'),bt_tools.table({el:"#sub_dir_table",url:"/site?action=GetDirBinding",param:{id:t.id},dataFilter:function(e){if(2===$("#webedit-con").children().length)return{data:e.binding};for(var s=[],i=0;i<e.dirs.length;i++)s.push({title:e.dirs[i],value:e.dirs[i]});var a={title:"",class:"mb0",items:[{title:"域名",width:"140px",name:"domain"},{title:"子目录",name:"dirName",type:"select",items:s},{text:"添加",type:"button",name:"btn_add_subdir",callback:function(e){e.domain&&e.dirName?bt.site.add_dirbind(t.id,e.domain,e.dirName,function(t){layer.msg(t.msg,{icon:t.status?1:2}),t.status&&site.reload(1)}):layer.msg(lan.site.d_s_empty,{icon:2})}}]},n=bt.render_form_line(a);return $("#webedit-con").prepend(n.html),bt.render_clicks(n.clicks),{data:e.binding}},column:[{type:"checkbox",width:20,keepNumber:1},{fid:"domain",title:"域名",type:"text"},{fid:"port",title:"端口",width:70,type:"text"},{fid:"path",title:"子目录",width:70,type:"text"},{title:"操作",width:110,type:"group",align:"right",group:[{title:"伪静态",event:function(t,e,s,i,a){bt.site.get_dir_rewrite({id:t.id},function(e){function s(t){var e="/www/server/panel/rewrite/"+("openlitespeed"==bt.get_cookie("serverType")?"apache":bt.get_cookie("serverType"))+"/"+t+".conf";bt.files.get_file_body(e,function(t){$(".dir_config").text(t.data)})}function i(t){var e=bt.open({type:1,area:["510px","515px"],title:lan.site.config_url,closeBtn:2,shift:5,skin:"bt-w-con",shadeClose:!0,content:"<div class='bt-form webedit-dir-box dir-rewrite-man-con'></div>",success:function(){for(var i=$(".webedit-dir-box"),a=[],n=0;n<t.rlist.length;n++)a.push({title:t.rlist[n],value:t.rlist[n]});var l=[{name:"dir_rewrite",type:"select",width:"130px",items:a,callback:function(t){s(t.val())}},{items:[{name:"dir_config",type:"textarea",value:t.data,width:"470px",height:"260px"}]},{items:[{name:"btn_save",text:"保存",type:"button",callback:function(s){console.log(t),bt.files.set_file_body(t.filename,s.dir_config,"utf-8",function(t){t.status&&e.close(),bt.msg(t)})}}]}],c=[];for(n=0;n<l.length;n++){var r=bt.render_form_line(l[n]);i.append(r.html);var o="Linux"==bt.os&&0==n?'<span>规则转换工具：<a href="https://www.bt.cn/Tools" target="_blank" style="color:#20a53a">Apache转Nginx</a></span>':"";i.find(".info-r").append(o),c=c.concat(r.clicks)}i.append(bt.render_help(["请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default","您可以对伪静态规则进行修改，修改完后保存即可。"])),bt.render_clicks(c),s($(".dir_rewrite option:eq(0)").val())}})}if(e.status)i(e);else var a=layer.confirm(lan.site.url_rewrite_alter,{icon:3,closeBtn:2},function(){bt.site.get_dir_rewrite({id:t.id,add:1},function(t){layer.close(a),i(t)})})})}},{title:"删除",event:function(t,e,s,i,a){bt.confirm({title:"删除子目录绑定【"+t.path+"】",msg:lan.site.s_bin_del},function(){bt.site.del_dirbind(t.id,function(t){t.status&&a.$delete_table_row(e),bt.msg(t)})})}}]}],tootls:[{type:"batch_btn",positon:["left","bottom"],placeholder:"请选择批量操作",buttonValue:"批量操作",disabledSelectValue:"请选择需要批量操作的子目录!",selectList:[{title:"删除子目录绑定",batch_btn_name:"批量删除",url:"/site?action=delete_dir_bind_multiple",param:{id:t.id},paramId:"id",paramName:"bind_ids",theadName:"域名",confirmVerify:!1}]}]})},set_dirpath:function(t){var e=bt.load();bt.site.get_site_path(t.id,function(s){bt.site.get_dir_userini(t.id,s,function(i){e.close();for(var a=[],n=!1,l=0;l<i.runPath.dirs.length;l++)a.push({title:i.runPath.dirs[l],value:i.runPath.dirs[l]}),i.runPath.runPath===i.runPath.dirs[l]&&(n=!0);n||a.push({title:i.runPath.runPath,value:i.runPath.runPath});for(var c=[{title:"",items:[{name:"userini",type:"checkbox",text:"防跨站攻击(open_basedir)",value:i.userini,callback:function(t){bt.site.set_dir_userini(s,function(t){t.status&&site.reload(2),layer.msg(t.msg,{icon:t.status?1:2})})}},{name:"logs",type:"checkbox",text:"写访问日志",value:i.logs,callback:function(e){bt.site.set_logs_status(t.id,function(t){t.status&&site.reload(2),layer.msg(t.msg,{icon:t.status?1:2})})}}]},{title:"",items:[{name:"path",title:"网站目录",width:"240px",value:s,event:{css:"glyphicon-folder-open",callback:function(t){bt.select_path(t)}}},{name:"btn_site_path",class:"ml10",type:"button",text:"保存",callback:function(e){bt.site.set_site_path(t.id,e.path,function(t){t.status&&site.reload(2),layer.msg(t.msg,{icon:t.status?1:2})})}}]},{title:"",items:[{title:"运行目录",width:"240px",value:i.runPath.runPath,name:"dirName",type:"select",items:a},{name:"btn_run_path",type:"button",text:"保存",callback:function(e){bt.site.set_site_runpath(t.id,e.dirName,function(t){t.status&&site.reload(2),layer.msg(t.msg,{icon:t.status?1:2})})}}]}],r=$("<div class='webedit-box soft-man-con'></div>"),o=[],d=0;d<c.length;d++){var p=bt.render_form_line(c[d]);r.append($(p.html).addClass("line mtb10")),o=o.concat(p.clicks)}r.find('input[type="checkbox"]').parent().addClass("label-input-group ptb10"),r.find('button[name="btn_run_path"]').addClass("ml45"),r.find('button[name="btn_site_path"]').addClass("ml33"),r.append(bt.render_help(["部分程序需要指定二级目录作为运行目录，如ThinkPHP5，Laravel","选择您的运行目录，点保存即可"])),"Linux"==bt.os&&r.append('<div class="user_pw_tit" style="margin-top: 2px;padding-top: 11px;"><span class="tit">密码访问</span><span class="btswitch-p"><input class="btswitch btswitch-ios" id="pathSafe" type="checkbox"><label class="btswitch-btn phpmyadmin-btn" for="pathSafe" ></label></span></div><div class="user_pw" style="margin-top: 10px; display: block;"></div>'),$("#webedit-con").append(r),bt.render_clicks(o),$("#pathSafe").click(function(){var e=$(this).prop("checked"),s=$(".user_pw");if(e)for(var i=[{title:"授权账号",width:"200px",name:"username_get",placeholder:"不修改请留空"},{title:"访问密码",width:"200px",type:"password",name:"password_get_1",placeholder:"不修改请留空"},{title:"重复密码",width:"200px",type:"password",name:"password_get_2",placeholder:"不修改请留空"},{name:"btn_password_get",text:"保存",type:"button",callback:function(e){e.password_get_1==e.password_get_2?bt.site.set_site_pwd(t.id,e.username_get,e.password_get_1,function(t){layer.msg(t.msg,{icon:t.status?1:2}),t.status&&site.reload(2)}):layer.msg(lan.bt.pass_err_re,{icon:2})}}],a=0;a<i.length;a++){var n=bt.render_form_line(i[a]);s.append("<div class='line'>"+n.html+"</div>"),bt.render_clicks(n.clicks)}else bt.site.close_site_pwd(t.id,function(t){layer.msg(t.msg,{icon:t.status?1:2}),s.html("")})}),i.pass&&$("#pathSafe").trigger("click")})})},set_dirguard:function(t){$("#webedit-con").html('<div id="dir_guard"></div>'),bt_tools.table({el:"#dir_guard",url:"/site?action=get_dir_auth",param:{id:t.id},dataFilter:function(e){return{data:e[t.name]}},column:[{type:"checkbox",width:20},{fid:"name",title:"名称",type:"text"},{fid:"site_dir",title:"保护的目录",type:"text"},{title:"操作",width:110,type:"group",align:"right",group:[{title:"编辑",event:function(e,s,i,a,n){site.edit.template_Dir(t.id,!1,e)}},{title:"删除",event:function(e,s,i,a,n){bt.site.delete_dir_guard(t.id,e.name,function(t){t.status&&n.$delete_table_row(s),bt.msg(t)})}}]}],tootls:[{type:"btnGroup",positon:["left","top"],list:[{title:"添加目录保护",active:!0,event:function(e){site.edit.template_Dir(t.id,!0)}}]},{type:"batch_btn",positon:["left","bottom"],selectList:[{title:"删除目录保护",batch_btn_name:"批量删除",url:"/site?action=delete_dir_auth_multiple",param:{site_id:t.id},paramId:"name",paramName:"names",theadName:"目录保护名称",confirmVerify:!1}]}]})},ols_cache:function(t){bt.send("get_ols_static_cache","config/get_ols_static_cache",{id:t.id},function(e){var s=[],i=[],a=[],n=!1;Object.keys(e).forEach(function(t){i.push(t),a.push(e[t])});for(var l=[{title:i[0],name:i[0],width:"30%",value:a[0]},{title:i[1],name:i[1],width:"30%",value:a[1]},{title:i[2],name:i[2],width:"30%",value:a[2]},{title:i[3],name:i[3],width:"30%",value:a[3]},{name:"static_save",text:"保存",type:"button",callback:function(e){var s={},i=bt.load();Object.assign(s,e),delete s.static_save,delete s.maxage,delete s.exclude_file,delete s.private_save,bt.send("set_ols_static_cache","config/set_ols_static_cache",{values:JSON.stringify(s),id:t.id},function(t){i.close(),bt.msg(t)})}},{title:"test",name:"test",width:"30%",value:"11"},{title:"缓存时间",name:"maxage",width:"30%",value:"43200"},{title:"排除文件",name:"exclude_file",width:"35%",value:"fdas.php"},{name:"private_save",text:"保存",type:"button",callback:function(e){var s={},i=bt.load();n&&(s.id=t.id,s.max_age=parseInt($("input[name='maxage']").val()),s.exclude_file=$("textarea[name='exclude_file']").val(),bt.send("set_ols_private_cache","config/set_ols_private_cache",s,function(t){i.close(),bt.msg(t)}))}}],c=$('<div class="ols"></div>'),r=0;r<l.length;r++){var o=bt.render_form_line(l[r]);c.append(o.html),s=s.concat(o.clicks)}$("#webedit-con").append(c),$("input[name='exclude_file']").parent().removeAttr("class").html('<textarea name="exclude_file" class="bt-input-text mr5 exclude_file" style="width:35%;height: 130px;"></textarea>'),$("input[name='test']").parent().parent().html('<div style="padding-left: 29px;border-top: #ccc 1px dashed;margin-top: -7px;"><em style="float: left;color: #555;font-style: normal;line-height: 32px;padding-right: 2px;">私有缓存</em><div style="margin-left: 70px;padding-top: 5px;"><input class="btswitch btswitch-ios" id="ols" type="checkbox"><label class="btswitch-btn" for="ols"></label></div></div>');var d=$("input[name='maxage'],textarea[name='exclude_file'],button[name='private_save']").parent().parent();$("input.bt-input-text").parent().append("<span>秒</span>"),$("button[name='static_save']").parent().append(bt.render_help(["默认的静态文件缓存时间是604800秒","如果要关闭，请将其更改为0秒"])),$(".ols").append(bt.render_help(["私有缓存只支持PHP页面缓存，默认缓存时间为120秒","排除文件仅支持以PHP为后缀的文件"])),d.hide();var p=bt.load();bt.send("get_ols_private_cache_status","config/get_ols_private_cache_status",{id:t.id},function(e){p.close(),n=e,e&&bt.send("get_ols_private_cache","config/get_ols_private_cache",{id:t.id},function(t){$("input[name='maxage']").val(t.maxage);var e=t.exclude_file.join("&#13;");$("textarea[name='exclude_file']").html(e),$("#ols").attr("checked",!0),d.show()})}),$("#ols").on("click",function(){var e=bt.load();bt.send("switch_ols_private_cache","config/switch_ols_private_cache",{id:t.id},function(s){e.close(),d.toggle(),n=!d.is(":hidden"),bt.msg(s),n&&bt.send("get_ols_private_cache","config/get_ols_private_cache",{id:t.id},function(t){d.show(),$("input[name='maxage']").val(t.maxage),$("textarea[name='exclude_file']").html(t.exclude_file.join("&#13;"))})})}),bt.render_clicks(s),$("button[name='private_save']").parent().css("margin-bottom","-13px"),$(".ss-text").css("margin-left","66px"),$(".ols .btn-success").css("margin-left","100px")})},limit_network:function(t){bt.site.get_limitnet(t.id,function(e){for(var s=[{title:"论坛/博客",value:1,items:{perserver:300,perip:25,limit_rate:512}},{title:"图片站",value:2,items:{perserver:200,perip:10,limit_rate:1024}},{title:"下载站",value:3,items:{perserver:50,perip:3,limit_rate:2048}},{title:"商城",value:4,items:{perserver:500,perip:10,limit_rate:2048}},{title:"门户",value:5,items:{perserver:400,perip:15,limit_rate:1024}},{title:"企业",value:6,items:{perserver:60,perip:10,limit_rate:512}},{title:"视频",value:7,items:{perserver:150,perip:4,limit_rate:1024}}],i=[{items:[{name:"status",type:"checkbox",value:0!=e.perserver,text:"启用流量控制",callback:function(e){e.status?bt.site.set_limitnet(t.id,e.perserver,e.perip,e.limit_rate,function(t){layer.msg(t.msg,{icon:t.status?1:2}),t.status&&site.reload(3)}):bt.site.close_limitnet(t.id,function(t){layer.msg(t.msg,{icon:t.status?1:2}),t.status&&site.reload(3)})}}]},{items:[{title:"限制方案  ",width:"160px",name:"limit",type:"select",items:s,callback:function(t){var e=s.filter(function(e){return e.value===parseInt(t.val())})[0];for(var i in e.items)$('input[name="'+i+'"]').val(e.items[i])}}]},{items:[{title:"并发限制   ",type:"number",width:"200px",value:e.perserver,name:"perserver"}]},{items:[{title:"单IP限制   ",type:"number",width:"200px",value:e.perip,name:"perip"}]},{items:[{title:"流量限制   ",type:"number",width:"200px",value:e.limit_rate,name:"limit_rate"}]},{name:"btn_limit_get",text:"保存",type:"button",callback:function(e){bt.site.set_limitnet(t.id,e.perserver,e.perip,e.limit_rate,function(t){layer.msg(t.msg,{icon:t.status?1:2}),t.status&&site.reload(3)})}}],a=$("<div class='webedit-box soft-man-con'></div>"),n=[],l=0;l<i.length;l++){var c=bt.render_form_line(i[l]);a.append(c.html),n=n.concat(c.clicks)}a.find('input[type="checkbox"]').parent().addClass("label-input-group ptb10"),a.append(bt.render_help(["限制当前站点最大并发数","限制单个IP访问最大并发数","限制每个请求的流量上限（单位：KB）"])),$("#webedit-con").append(a),bt.render_clicks(n),0==e.perserver&&$("select[name='limit']").trigger("change")})},get_rewrite_list:function(t){var e="/www/server/panel/vhost/rewrite/"+t.name+".conf";bt.site.get_rewrite_list(t.name,function(t){var s=[],i=bt.get_cookie("serverType");"apache"==bt.get_cookie("serverType")&&(e=t.sitePath+"/.htaccess"),"apache"!=i&&"openlitespeed"!=i||(e=t.sitePath+"/.htaccess"),"openlitespeed"==i&&(i="apache");for(var a=0;a<t.rewrite.length;a++)s.push({title:t.rewrite[a],value:t.rewrite[a]});var n=[{name:"rewrite",type:"select",width:"130px",items:s,callback:function(t){if("Linux"==bt.os){var s=e;t.val()!=lan.site.rewritename&&(s="/www/server/panel/rewrite/"+("openlitespeed"==i?"apache":i)+"/"+t.val()+".conf"),bt.files.get_file_body(s,function(t){d.ACE.setValue(t.data),d.ACE.moveCursorTo(0,0),d.path=s})}}},{items:[{name:"config",type:"div",value:t.data,widht:"340px",height:"200px"}]},{items:[{name:"btn_save",text:"保存",type:"button",callback:function(t){d.path=e,bt.saveEditor(d)}},{name:"btn_save_to",text:"另存为模板",type:"button",callback:function(t){var e={title:lan.site.save_rewrite_temp,area:"330px",list:[{title:"模板名称",placeholder:"模板名称",width:"160px",name:"tempname"}],btns:[{title:"关闭",name:"close"},{title:"提交",name:"submit",css:"btn-success",callback:function(t,e,s){bt.site.set_rewrite_tel(t.tempname,d.ACE.getValue(),function(t){t.status&&(e.close(),site.reload(4)),bt.msg(t)})}}]};bt.render_form(e)}}]}],l=$("<div class='webedit-box soft-man-con'></div>"),c=[];for(a=0;a<n.length;a++){var r=bt.render_form_line(n[a]);l.append(r.html);var o="Linux"==bt.os&&0==a?'<span>规则转换工具：<a href="https://www.bt.cn/Tools" target="_blank" style="color:#20a53a">Apache转Nginx</a></span>':"";l.find(".info-r").append(o),c=c.concat(r.clicks)}l.append(bt.render_help(["请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default","您可以对伪静态规则进行修改，修改完后保存即可。"])),$("#webedit-con").append(l),bt.render_clicks(c),$("div.config").attr("id","config_rewrite").css({height:"360px",width:"540px"});var d=bt.aceEditor({el:"config_rewrite",content:t.data});$("select.rewrite").trigger("change")})},set_default_index:function(t){bt.site.get_index(t.id,function(e){e=e.replace(new RegExp(/(,)/g),"\n");var s={items:[{name:"Dindex",height:"230px",width:"50%",type:"textarea",value:e},{name:"btn_submit",text:"添加",type:"button",callback:function(e){var s=e.Dindex.replace(new RegExp(/(\n)/g),",");bt.site.set_index(t.id,s,function(t){t.status&&site.reload(5)})}}]},i=bt.render_form_line(s),a=$(i.html);a.append(bt.render_help([lan.site.default_doc_help])),$("#webedit-con").append(a),$(".btn_submit").addClass("pull-right").css("margin","90px 100px 0 0"),bt.render_clicks(i.clicks)})},set_config:function(t){var e='<p style="color: #666; margin-bottom: 7px">提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换</p><div class="bt-input-text ace_config_editor_scroll" style="height: 400px; line-height:18px;" id="siteConfigBody"></div>\t\t\t\t<button id="OnlineEditFileBtn" class="btn btn-success btn-sm" style="margin-top:10px;">保存</button>\t\t\t\t<ul class="c7 ptb15">\t\t\t\t\t<li>此处为站点主配置文件,若您不了解配置规则,请勿随意修改.</li>\t\t\t\t</ul>';$("#webedit-con").html(e);var s=bt.get_cookie("serverType"),i=bt.aceEditor({el:"siteConfigBody",path:"/www/server/panel/vhost/"+("openlitespeed"==s?s+"/detail":s)+"/"+t.name+".conf"});$("#OnlineEditFileBtn").click(function(t){bt.saveEditor(i)})},set_ssl:function(t){$("#webedit-con").html('<div id=\'ssl_tabs\'></div><div class="tab-con" style="padding:10px 0px;"></div>'),bt.site.get_site_ssl(t.name,function(e){var s=[{title:"宝塔SSL",on:!0,callback:function(s){bt.pub.get_user_info(function(i){if(i.status)bt.site.get_domains(t.id,function(e){for(var i=[],a=0;a<e.length;a++)-1==e[a].name.indexOf("*")&&i.push({title:e[a].name,value:e[a].name});var n=[{title:"域名",width:"200px",name:"domains",type:"select",items:i},{title:" ",name:"btsslApply",text:"申请",type:"button",callback:function(e){if(-1!=e.domains.indexOf("www.")){var s=e.domains.split(/www\./)[1];if(!$.inArray(i,s))return void layer.msg("您为域名["+e.domains+"]申请证书，但程序检测到您没有将其根域名["+s+"]绑定并解析到站点，这会导致证书签发失败!",{icon:2,time:5e3})}bt.site.get_dv_ssl(e.domains,t.path,function(e){-1!=e.msg.indexOf("<br>")?layer.msg(e.msg,{time:0,shade:.3,shadeClose:!0,area:"550px",icon:2}):bt.msg(e),e.status&&site.ssl.verify_domain(e.data.partnerOrderId,t.name)})}}];for(a=0;a<n.length;a++){var l=bt.render_form_line(n[a]);s.append(l.html),bt.render_clicks(l.clicks)}var c=bt.load();bt.site.get_order_list(t.name,function(e){if(c.close(),!1!==e.status){s.append("<div class=\"divtable mtb15 table-fixed-box\" style=\"max-height:200px;overflow-y: auto;\"><table id='bt_order_list' class='table table-hover'></table></div>"),bt.render({table:"#bt_order_list",columns:[{field:"commonName",title:"域名"},{field:"endtime",width:"70px",title:"到期时间",templet:function(t){return bt.format_data(t.endtime,"yyyy/MM/dd")}},{field:"stateName",width:"100px",title:"状态"},{field:"opt",align:"right",width:"100px",title:"操作",templet:function(e){var s='<a class="btlink" onclick="site.ssl.onekey_ssl(\''+e.partnerOrderId+"','"+t.name+'\')" href="javascript:;">部署</a>';return"WF_DOMAIN_APPROVAL"==e.stateCode?s='<a class="btlink" onclick="site.ssl.verify_domain(\''+e.partnerOrderId+"','"+t.name+'\')" href="javascript:;">验证域名</a>':e.setup&&(s="已部署 | <a class=\"btlink\" href=\"javascript:site.ssl.set_ssl_status('CloseSSLConf','"+t.name+"')\">关闭</a>"),s}}],data:e.data}),bt.fixed_table("bt_order_list");var i=["申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)","宝塔SSL申请的是免费版TrustAsia DV SSL CA - G5证书，仅支持单个域名申请","有效期1年，不支持续签，到期后需要重新申请","建议使用二级域名为www的域名申请证书,此时系统会默认赠送顶级域名为可选名称","在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点",'<a style="color:red;">如果重新申请证书时提示【订单已存在】请登录宝塔官网删除对应SSL订单</a>','<a style="color:red;">如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败</a>','<a style="color:red;">申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败</a>'];s.append(bt.render_help(i))}else layer.msg(e.msg,{icon:2})})});else{s.append('<div class="alert alert-warning" style="padding:10px">未绑定宝塔账号，请注册绑定，绑定宝塔账号(非论坛账号)可实现一键部署SSL</div>');for(var a=[{title:"宝塔账号",name:"bt_username",value:e.email,width:"260px",placeholder:"请输入手机号码"},{title:"密码",type:"password",name:"bt_password",value:e.email,width:"260px"},{title:" ",items:[{text:"登录",name:"btn_ssl_login",type:"button",callback:function(t){bt.pub.login_btname(t.bt_username,t.bt_password,function(t){t.status&&site.reload(7)})}},{text:"注册宝塔账号",name:"bt_register",type:"button",callback:function(t){window.open("https://www.bt.cn/register.html")}}]}],n=0;n<a.length;n++){var l=bt.render_form_line(a[n]);s.append(l.html),bt.render_clicks(l.clicks)}s.append(bt.render_help(["宝塔SSL证书为亚洲诚信证书，需要实名认证才能申请使用","已有宝塔账号请登录绑定","宝塔SSL申请的是TrustAsia DV SSL CA - G5 原价：1900元/1年，宝塔用户免费！","一年满期后免费颁发"]))}})}},{title:"Let's Encrypt",callback:function(s){if(acme.get_account_info(function(t){!1===t.status&&layer.msg(t.msg,{icon:2,time:1e4})}),acme.id=t.id,e.status&&1==e.type){var i="";e.cert_data.notBefore&&(i='<div style="margin-bottom: 10px;" class="alert alert-success">                                        <p style="margin-bottom: 9px;"><span style="width: 357px;display: inline-block;"><b>已部署成功：</b>将在距离到期时间1个月内尝试自动续签</span>                                        <span style="margin-left: 15px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;max-width: 140px;width: 140px;">                                        <b>证书品牌：</b>'+e.cert_data.issuer+'</span></p>                                        <span style="display:inline-block;max-width: 357px;overflow:hidden;text-overflow:ellipsis;vertical-align:-3px;white-space: nowrap;width: 357px;"><b>认证域名：</b> '+e.cert_data.dns.join("、")+'</span>                                        <span style="margin-left: 15px;"><b>到期时间：</b> '+e.cert_data.notAfter+"</span></div>"),s.append("<div>"+i+'<div><span>密钥(KEY)</span><span style="padding-left:194px">证书(PEM格式)</span></div></div>');for(var a=[{items:[{name:"key",width:"45%",height:"220px",type:"textarea",value:e.key},{name:"csr",width:"45%",height:"220px",type:"textarea",value:e.csr}]},{items:[{text:"关闭SSL",name:"btn_ssl_close",hide:!e.status,type:"button",callback:function(e){site.ssl.set_ssl_status("CloseSSLConf",t.name)}},{text:"续签",name:"btn_ssl_renew",hide:!e.status,type:"button",callback:function(s){site.ssl.renew_ssl(t.name,e.auth_type,e.index)}}]}],n=0;n<a.length;n++){var l=bt.render_form_line(a[n]);s.append(l.html),bt.render_clicks(l.clicks)}s.find("textarea").css("background-color","#f6f6f6").attr("readonly",!0);s.append(bt.render_help(["已为您自动生成Let's Encrypt免费证书；","如需使用其他SSL,请切换其他证书后粘贴您的KEY以及PEM内容，然后保存即可。","如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"]))}else bt.site.get_site_domains(t.id,function(e){for(var i=[["申请之前，请确保域名已解析，如未解析会导致审核失败","Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签","若您的站点使用了CDN或301重定向会导致续签失败","在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点","如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"],["在DNS验证中，我们提供了多种自动化DNS-API，并提供了手动模式","使用DNS接口申请证书可自动续期，手动模式下证书到期后需重新申请","使用【DnsPod/阿里云DNS】等接口前您需要先在弹出的窗口中设置对应接口的API","如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"]],a=[{title:"验证方式",items:[{name:"check_file",text:"文件验证",type:"radio",callback:function(t){$(".checks_line").remove(),$(t).siblings().removeAttr("checked"),$(".help-info-text").html($(bt.render_help(i[0]))),$('#ymlist li input[type="checkbox"]').each(function(){$(this).val().indexOf("*")>=0&&$(this).parents("li").hide()})}},{name:"check_dns",text:"DNS验证(支持通配符)",type:"radio",callback:function(t){$(".checks_line").remove(),$(t).siblings().removeAttr("checked"),$(".help-info-text").html($(bt.render_help(i[1]))),$("#ymlist li").show();var e=[],a={};bt.site.get_dns_api(function(i){site.dnsapi={};for(var n=0;n<i.length;n++)site.dnsapi[i[n].name]={},site.dnsapi[i[n].name].s_key="None",site.dnsapi[i[n].name].s_token="None",i[n].data&&(site.dnsapi[i[n].name].s_key=i[n].data[0].value,site.dnsapi[i[n].name].s_token=i[n].data[1].value),e.push({title:i[n].title,value:i[n].name}),a[i[n].name]=i[n];for(var l=[{title:"选择DNS接口",class:"checks_line",items:[{name:"dns_select",width:"120px",type:"select",items:e,callback:function(t){var e=t.val();$(".set_dns_config").remove();var i=a[e],n={title:"",area:"530px",list:[],btns:[{title:"关闭",name:"close"}]},l=[];if(!1!==i.data){n.title="设置【"+i.title+"】接口",l.push(i.help);for(var c=!0,r=0;r<i.data.length;r++)n.list.push({title:i.data[r].name,name:i.data[r].key,value:i.data[r].value}),i.data[r].value||(c=!1);if(n.btns.push({title:"保存",css:"btn-success",name:"btn_submit_save",callback:function(t,e){bt.site.set_dns_api({pdata:JSON.stringify(t)},function(t){t.status&&(e.close(),s.find('input[type="radio"]:eq(0)').trigger("click"),s.find('input[type="radio"]:eq(1)').trigger("click")),bt.msg(t)})}}),
c)t.after('<button class="btn btn-default btn-sm mr5 set_dns_config">设置</button>'),$(".set_dns_config").click(function(){var t=bt.render_form(n);$('div[data-id="form'+t+'"]').append(bt.render_help(l))});else{var o=bt.render_form(n);$('div[data-id="form'+o+'"]').append(bt.render_help(l))}}}}]},{title:" ",class:"checks_line label-input-group",items:[{css:"label-input-group ptb10",text:"自动组合泛域名",name:"app_root",type:"checkbox"}]}],c=0;c<l.length;c++){var r=bt.render_form_line(l[c]);$(t).parents(".line").append(r.html),bt.render_clicks(r.clicks)}})}}]}],n=0;n<a.length;n++){var l=bt.render_form_line(a[n]);s.append(l.html),bt.render_clicks(l.clicks)}var c=$('<ul id="ymlist" class="domain-ul-list"></ul>');for(n=0;n<e.domains.length;n++)!0!==e.domains[n].binding&&c.append('<li style="cursor: pointer;"><input class="checkbox-text" type="checkbox" value="'+e.domains[n].name+'">'+e.domains[n].name+"</li>");var r=$("<div class='line mtb10'></div>");r.append('<span class="tname text-center">域名</span>'),r.append(c),s.append(r),s.find('input[type="radio"]').parent().addClass("label-input-group ptb10"),$("#ymlist li input").click(function(t){t.stopPropagation()}),$("#ymlist li").click(function(){var t=$(this).find("input");t.prop("checked")?t.prop("checked",!1):t.prop("checked",!0)});var o=bt.render_form_line({title:" ",text:"申请",name:"letsApply",type:"button",callback:function(e){e.domains=[],$('#ymlist input[type="checkbox"]:checked').each(function(){e.domains.push($(this).val())});var s="http",i=t.id,a="0";if(e.check_dns&&(s="dns",i="dns",a=e.app_root?"1":"0",e.dns_select!==i)){if(!site.dnsapi[e.dns_select].s_key)return void layer.msg("指定dns接口没有设置密钥信息");i=e.dns_select+"|"+site.dnsapi[e.dns_select].s_key+"|"+site.dnsapi[e.dns_select].s_token}acme.apply_cert(e.domains,s,i,a,function(e){site.ssl.ssl_result(e,s,t.name)})}});s.append(o.html),bt.render_clicks(o.clicks),s.append(bt.render_help(i[0])),s.find('input[type="radio"]:eq(0)').trigger("click")})}},{title:"商用证书<i class='ssl_recom_icon'></i>",callback:function(s){function i(t,e,s){var i;switch(t.css("borderColor","#ccc"),e){case"domains":var n=s.split("\n");""==s&&(a(t,{msg:"域名不能为空！",color:"red"}),i=!1),Array.isArray(n)||(n=[n]),$.each(n,function(e,s){if(bt.check_domain(s))switch(p.code){case"comodo-positive-multi-domain":n.length>3?(a(t,{msg:"多域名证书默认支持3个域名,超出数量请重新申请！",color:"red"}),i=!1):1==n.length&&(a(t,{msg:"当前为多域名证书，需要2个域名或多个域名！",color:"red"}),i=!1);break;case"comodo-positivessl-wildcard":0!=s.indexOf("*")&&(a(t,{msg:"通配符域名格式错误,正确写法‘*.bt.cn’",color:"red"}),i=!1);break;case"comodo-positive-multi-domain-wildcard":n.length>2?(a(t,{msg:"多域名通配符证书默认支持2个域名,超出数量请重新申请！",color:"red"}),i=!1):1==n.length&&(a(t,{msg:"当前为多域名通配符，需要2个域名或多个域名！",color:"red"}),i=!1),0!=s.indexOf("*")&&(a(t,{msg:"通配符域名格式错误,正确写法‘*.bt.cn’",color:"red"}),i=!1)}else a(t,{msg:"【 "+s+" 】,域名格式错误",color:"red"}),i=!1}),s=n;break;case"state":""==s&&(a(t,{msg:"所在省份不能为空！",color:"red"}),i=!1);break;case"city":""==s&&(a(t,{msg:"所在市/县不能为空！",color:"red"}),i=!1);break;case"organation":""==s&&(a(t,{msg:"公司名称不能为空，如为个人申请请输入个人姓名！",color:"red"}),i=!1);break;case"name":""==s&&(a(t,{msg:"用户姓名不能为空！",color:"red"}),i=!1);break;case"email":""==s&&(a(t,{msg:"用户邮箱地址不能为空！",color:"red"}),i=!1),bt.check_email(s)||(a(t,{msg:"用户邮箱地址格式错误！",color:"red"}),i=!1);break;case"mobile":""!=s&&(bt.check_phone(s)||(a(t,{msg:"用户手机号码格式错误！",color:"red"}),i=!1));break;default:i=s}return("boolean"!=typeof i||!1!==i)&&(i=s,i)}function a(t,e){$("html").append($('<span id="width_test">'+e.msg+"</span>")),layer.tips(e.msg,t,{tips:[1,e.color],time:3e3,area:$("#width_test").width()+20+"px"}),t.css("borderColor",e.color),$("#width_test").remove()}function n(t,e){var s=bt.load("正在获取验证方式,请稍后...");bt.send("get_verify_result","ssl/get_verify_result",{oid:t},function(e){s.close();var i=e.data.dcvList[0].dcvMethod;_=bt.open({type:1,title:"验证域名-"+(i?"文件验证":"DNS验证"),area:"500px",btn:["更改","取消"],content:'<div class="bt-form pd15">\t\t                                        <div class="line"><span class="tname">验证方式</span>\t\t                                        <div class="info-r"><select class="bt-input-text mr5" name="file_rule" style="width:250px"></select>\t                                        \t</div>\t                                        </div>\t                                    <ul class="help-info-text c7"><li>文件验证（HTTP）：确保网站能够通过http正常访问</li><li>文件验证（HTTPS）：确保网站已开启https，并且网站能够通过https正常访问</li><li>DNS验证：需要手动解析DNS记录值</li></ul></div>',success:function(t,e){var s={"文件验证(HTTP)":"HTTP_CSR_HASH","文件验证(HTTPS)":"HTTPS_CSR_HASH","DNS验证(CNAME解析)":"CNAME_CSR_HASH"},a="";$.each(s,function(t,e){a+='<option value="'+e+'" '+(i==e?"selected":"")+">"+t+"</option>"}),$("select[name=file_rule]").html(a)},yes:function(e,s){var a=$("select[name=file_rule]").val();if(i==a)return layer.msg("重复的验证方式",{icon:2});var n=bt.load("正在修改验证方式,请稍后...");bt.send("again_verify","ssl/again_verify",{oid:t,dcvMethod:a},function(t){n.close(),t.status&&layer.close(e),layer.msg(t.msg,{icon:t.status?1:2})})}})})}function l(t,e){var s=bt.load("正在获取验证结果,请稍后...");bt.send("get_verify_result","ssl/get_verify_result",{oid:t},function(i){if(s.close(),"COMPLETE"==i.status)return $("#ssl_tabs span:eq(2)").click(),!1;_.close();var a=i.data,o=[],p="CNAME_CSR_HASH"!=a.dcvList[0].dcvMethod,u={};if($.each(a.dcvList,function(t,e){o.push(e.domainName)}),u=p?{fileName:a.DCVfileName,fileContent:a.DCVfileContent,filePath:"/.well-known/pki-validation/",paths:i.paths,kfqq:i.kfqq}:{dnsHost:a.DCVdnsHost,dnsType:a.DCVdnsType,dnsValue:a.DCVdnsValue,paths:i.paths,kfqq:i.kfqq},e)return e({type:p,domains:o,info:u}),!1;_=bt.open({type:1,title:"验证域名-"+(p?"文件验证":"DNS验证"),area:"600px",content:r({type:p,domains:o,info:u}),success:function(){$(".lib-price-button button").click(function(){switch($(this).index()){case 0:_.close(),l(d.oid);break;case 1:_.close()}});var e=new ClipboardJS(".parsing_info .parsing_icon");e.on("success",function(t){bt.msg({status:!0,msg:"复制成功"}),t.clearSelection()}),e.on("error",function(t){bt.msg({status:!0,msg:"复制失败，请手动ctrl+c复制！"}),console.error("Action:",t.action),console.error("Trigger:",t.trigger)}),$(".verify_ssl_domain").click(function(){l(t),_.close()}),$(".set_verify_type").click(function(){n(t),_.close()}),$(".return_ssl_list").click(function(){_.close(),$("#ssl_tabs span:eq(2)").click()}),$(".domains_table").on("click",".check_url_results",function(){var t=$(this).data("url"),e=$(this).data("content");c(t,e,this)})}})})}function c(t,e,s){var i=bt.load("正在获取验证结果,请稍后...");bt.send("check_url_txt","ssl/check_url_txt",{url:t,content:e},function(t){i.close();var e='<span style="color:red">失败['+t+']</span><a href="https://www.bt.cn/bbs/thread-56802-1-1.html" target="_blank" class="bt-ico-ask" style="cursor: pointer;">?</a>';"1"===t&&(e='<a class="btlink">通过</a>'),$(s).parents("tr").find("td:nth-child(2)").html(e)})}function r(t){var e="";if(t.type){for(var s='<div class="bt-table domains_table" style="margin-bottom:20px"><div class="divtable"><table class="table table-hover"><thead><tr><th>URL</th><th style="width:85px;">验证结果</th><th style="text-align:right;width:135px;">操作</th></thead>',i=t.info.paths,a=0;a<i.length;a++)s+='<tr><td><span title="'+i[a].url+'" class="lib-ssl-overflow-span-style" style="word-break: break-all;">'+i[a].url+"</span></td><td>"+(1==i[a].status?'<a class="btlink">通过</a>':'<span style="color:red">失败['+i[a].status+']</span><a href="https://www.bt.cn/bbs/thread-56802-1-1.html" target="_blank" class="bt-ico-ask" style="cursor: pointer;">?</a>')+'</td><td style="text-align:right;"><a href="javascript:bt.pub.copy_pass(\''+i[a].url+'\');" class="btlink">复制</a> | <a href="'+i[a].url+'" target="_blank" class="btlink">打开</a> | <a data-url="'+i[a].url+'" data-content="'+t.info.fileContent+'" class="btlink check_url_results">重新验证</a></td>';s+="</table></div></div>",e='<div class="lib-ssl-parsing">                                        <div class="parsing_tips">请给以下域名【 <span class="highlight">'+t.domains.join("、")+'</span> 】添加验证文件，验证信息如下：</div>                                        <div class="parsing_parem"><div class="parsing_title">文件所在位置：</div><div class="parsing_info"><input type="text" name="filePath"  class="parsing_input border" value="'+t.info.filePath+'" readonly="readonly" /></div></div>                                        <div class="parsing_parem"><div class="parsing_title">文件名：</div><div class="parsing_info"><input type="text" name="fileName" class="parsing_input" value="'+t.info.fileName+'" readonly="readonly" /><span class="parsing_icon" data-clipboard-text="'+t.info.fileName+'">复制</span></div></div>                                        <div class="parsing_parem"><div class="parsing_title" style="vertical-align: top;">文件内容：</div><div class="parsing_info"><textarea name="fileValue"  class="parsing_textarea" readonly="readonly">'+t.info.fileContent+'</textarea><span class="parsing_icon" style="display: block;width: 60px;border-radius: 3px;" data-clipboard-text="'+t.info.fileContent+'">复制</span></div></div>'+s+'<div class="parsing_tips" >· SSL添加文件验证方式 ->> <a href="https://www.bt.cn/bbs/thread-56802-1-1.html" target="_blank" class="btlink" >查看教程</a><span style="padding-left:60px">专属客服QQ：'+t.info.kfqq+'</span></div >                                        <div class="parsing_parem" style="padding: 0 55px;"><button type="submit" class="btn btn-success verify_ssl_domain">验证域名</button><button type="submit" class="btn btn-default return_ssl_list">返回列表</button><button type="submit" class="btn btn-success set_verify_type">修改验证方式</button></div>                                    </div>'}else e='<div class="lib-ssl-parsing">                                        <div class="parsing_tips">请给以下域名【 <span class="highlight">'+t.domains.join("、")+"</span> 】添加‘‘"+t.info.dnsType+'’’解析，解析参数如下：</div>                                        <div class="parsing_parem"><div class="parsing_title">主机记录：</div><div class="parsing_info"><input type="text" name="host" class="parsing_input" value="'+t.info.dnsHost+'" readonly="readonly" /><span class="parsing_icon" data-clipboard-text="'+t.info.dnsHost+'">复制</span></div></div>                                        <div class="parsing_parem"><div class="parsing_title">记录值：</div><div class="parsing_info"><input type="text" name="domains"  class="parsing_input" value="'+t.info.dnsValue+'" readonly="readonly" /><span class="parsing_icon" data-clipboard-text="'+t.info.dnsValue+'">复制</span></div></div>                                        <div class="parsing_tips">· 关于如何添加域名解析，请自行百度，和咨询服务器运营商。</div>                                        <div class="parsing_parem" style="padding: 0 55px;"><button type="submit" class="btn btn-success verify_ssl_domain">验证域名</button><button type="submit" class="btn btn-default return_ssl_list">返回列表</button><button type="submit" class="btn btn-success set_verify_type">修改验证方式</button></div>                                    </div>';return e}var o,d,p,u,m=e,b="",_=bt.load("正在获取商用证书订单列表，请稍后..."),h=!0;return bt.send("get_order_list","ssl/get_order_list",{},function(e){_.close(),o=e,$.each(e,function(e,s){var i,a,n;3==m.type&&m.oid===s.oid?b+='<tr data-index="'+e+'"><td><span>'+s.domainName.join("、")+"</span></td><td>"+s.title+"</td><td>"+(i=(new Date).getTime()/1e3,a="",n="",""!=s.endDate?(s.endDate=parseInt(s.endDate),n=parseInt((s.endDate-i)/86400),n<=15&&(a="orange"),n<=7&&(a="red"),n<0?'<span style="color:red">已过期</span>':'<span style="'+a+'">剩余'+n+"天</span>"):"--")+'</td><td>订单完成</td><td style="text-align:right">已部署 | <a class="btlink" href="javascript:site.ssl.set_ssl_status(\'CloseSSLConf\',\''+t.name+"',2)\">关闭</a></td></td>":3!=m.type&&(b+='<tr data-index="'+e+'"><td><span>'+s.domainName.join("、")+"</span></td><td>"+s.title+"</td><td>"+function(){var t=(new Date).getTime()/1e3,e="",i="";return""!=s.endDate?(s.endDate=parseInt(s.endDate),i=parseInt((s.endDate-t)/86400),i<=15&&(e="orange"),i<=7&&(e="red"),i<0?'<span style="color:red">已过期</span>':'<span style="'+e+'">剩余'+i+"天</span>"):"--"}()+"</td><td>"+function(){if(1===s.status)switch(s.orderStatus){case"COMPLETE":return'<span style="color:#20a53a;">订单完成</span>';case"PENDING":return'<span style="color: orange;">申请中</span>';case"CANCELLED":return'<span style="color: #888;">已取消</span>';case"FAILED":return'<span style="color:red;">申请失败</span>';default:return'<span style="color: orange;">待验证</span>'}else switch(s.status){case 0:return'<span style="color: orange;">未支付</span>';case-1:return'<span style="color: #888;">已取消</span>'}}()+'</td><td style="text-align:right;">'+function(){if(1===s.status)switch(s.orderStatus){case"COMPLETE":return'<a href="javascript:;" data-type="deploy_ssl" class="btlink options_ssl">部署</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="/ssl?action=download_cert&oid='+s.oid+'" data-type="download_ssl" class="btlink options_ssl">下载</a>';case"PENDING":return'<a href="javascript:;" data-type="verify_order" class="btlink options_ssl">验证</a>';case"CANCELLED":return"无操作";case"FAILED":return'<a href="javascript:;" data-type="info_order" class="btlink options_ssl">详情</a>';default:return'<a href="javascript:;" data-type="verify_order" class="btlink options_ssl">验证</a>'}}()+"</td></tr>")}),$(".ssl_order_list tbody").html(b)}),s.append('<div style="margin-bottom: 10px;" class="alert alert-success">此品牌证书适合生产项目使用，宝塔官网BT.CN也是用这款证书，性价比高，推荐使用</div>                            <div class= "mtb10" >                            <button class="btn btn-success btn-sm btn-title ssl_business_application" type="button">申请证书</button>                            <div class="divtable mtb10 ssl_order_list"  style="height: 340px;overflow-y: auto;">                                <table class="table table-hover" id="ssl_order_list">                                    <thead><tr><th width="120px">域名</th><th  width="220px">证书类型</th><th>到期时间</th><th>状态</th><th style="text-align:right;">操作</th></tr></thead>                                    <tbody></tbody>                                </table>                            </div>                        </div><ul class="help-info-text c7">                            <li>申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)</li>                            <li>有效期1年，不支持续签，到期后需要重新申请</li>                            <li>在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点</li>                            <li><a style="color:red;">如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败</a></li>                            <li><a style="color:red;">申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败</a></li>                            <li><a style="color:red;">商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。<a class="btlink" target="_blank" href="https://www.racent.com/sectigo-ssl">点击查看</a></a></li>                        </ul>'),bt.fixed_table("ssl_order_list"),$(".ssl_order_list").on("click",".options_ssl",function(){var e=$(this).data("type"),s=$(this).parents("tr");switch(d=o[s.data("index")],e){case"deploy_ssl":bt.confirm({title:"部署证书",msg:"是否部署该证书,是否继续？<br>证书类型："+d.title+" <br>证书支持域名："+d.domainName.join("、")+"<br>部署站点名:"+t.name},function(){var e=bt.load("正在部署证书，请稍后...");bt.send("set_cert","ssl/set_cert",{oid:d.oid,siteName:t.name},function(s){e.close(),$("#webedit-con").empty(),site.edit.set_ssl(t),site.ssl.reload(),bt.msg(s)})});break;case"verify_order":l(d.oid);break;case"clear_order":bt.confirm({title:"取消订单",msg:"是否取消该订单，订单域名【"+d.domainName.join("、")+"】，是否继续？"},function(){var t=bt.load("正在取消订单，请稍后...");bt.send("cancel_cert_order","ssl/cancel_cert_order",{oid:d.oid},function(e){t.close(),e.status&&($("#ssl_tabs span:eq(2)").click(),setTimeout(function(){bt.msg(e)},2e3)),bt.msg(e)})})}}),$(".ssl_business_application").click(function(){var t=bt.load("正在获取商用证书产品列表，请稍后...");bt.send("get_product_list","ssl/get_product_list",{},function(s){t.close();var a="",n=s.administrator,c=null;$.each(s.data,function(t,e){e.state&&(a+='<tr data-index="'+t+'"><td><input type="radio" name="ssl_radio" /><span>'+e.title+'</span></td><td style="text-align: right;">'+(e.discount<1?'<span style="color: #bbbbbb;text-decoration: line-through;margin-right: 15px;" class="mr5">原价:'+e.src_price.toFixed(2)+"元/年</span>":"")+'<span style="color: #FF6232;">'+e.price.toFixed(2)+"元/1年</span></td></tr>")}),""==a&&(a='<div class="ssl_info_item">无证书信息</div>');var o=[["个人使用",!0,!0],["企业使用",!1,!0],["多域名/泛域名/IP证书",!1,!0],["赔付保障",!1,!0],["技术支持",!1,!0]],d="";$.each(o,function(t,e){d+='<tr><td class="one_title">'+e[0]+'</td><td class="'+(e[1]?"yes":"no")+'"></td><td class="'+(e[2]?"yes":"no")+'"></td></tr>'});var m='<div class="bt-form business_ssl_application">                                        <div class="guide_body">                                            <div class="guide_path">                                                <span class="active"><i>1</i><i>选择产品</i></span>                                                <span><i>2</i><i>完善资料</i></span>                                                <span><i>3</i><i>支付订单</i></span>                                                <span><i>4</i><i>完成订单</i></span>                                            </div>                                            <div class="guide_path_progress" data-progress="1" style="margin: 0px 80px;"><span style="width: 0px;"></span><span style="width: 430px;"></span></div>                                        </div>                                        <div class="guide_content" data-guide="1">                                            <div class="line">                                                <span class="tname">证书品牌</span>                                                <div class="info-r" >                                                    <a href="javascript:;" class="ssl-brand-info">Sectigo (原Comodo CA)是全球SSL证书市场占有率最高的CA公司，目前将近40%的SSL证书用户选择了Sectigo。由于其产品安全，价格低，受到大量站长的信任和欢迎。</a>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">证书对比</span>                                                <div class="info-r" style="min-height: 32px;line-height: 32px;">                                                    <table class="compared_ssl_list">                                                        <thead><tr><th>证书类型</th><th>免费证书</th><th>商用证书</th></tr></thead>                                                        <tbody>'+d+'</tbody>                                                    </table>                                                </div>                                            </div>                                            <div class="alert alert-success" style="margin-left: 90px;margin-bottom:10px;">宝塔官网BT.CN也是用此品牌证书，性价比高，推荐使用</div>                                            <div class="line">                                                <span class="tname">证书类型</span>                                                <div class="info-r">                                                    <div class="divtable ssl_class_table" >                                                        <table class="table table-hover">                                                            <tbody>'+a+'</tbody>                                                        </table>                                                    </div>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">总计费用</span>                                                <div class="info-r">                                                    <div class="guide_price"></div>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname"></span>                                                <div class="info-r">                                                    <button class="btn btn-success btn-sm next-plan" data-guide="1">下一步</button>                                                </div>                                            </div>                                        </div>                                        <div class="guide_content ssl_application_info" style="display:none" data-guide="2">                                            <div class="line">                                                <span class="tname">证书信息</span>                                                <div class="info-r ssl-info-line"></div>                                            </div>                                            <div class="line">                                                <span class="tname">域名</span>                                                <div class="info-r domain_list_info" style="margin-bottom:-5px;">                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">验证方式</span>                                                <div class="info-r ssl_verification">                                                    <label class="mr20"><input type="radio" name="dcvMethod" checked="checked" value="HTTP_CSR_HASH"><span>文件验证(HTTP)</span></label>                                                    <label class="mr20"><input type="radio" name="dcvMethod" value="HTTPS_CSR_HASH"><span>文件验证(HTTPS)</span></label>                                                    <label class="mr20"><input type="radio" name="dcvMethod" value="CNAME_CSR_HASH"><span>DNS验证(CNAME解析)</span></label>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">所在地区</span>                                                <div class="info-r ">                                                    <input type="text" class="bt-input-text mr5" name="state" value="'+(n.state||"")+'"  placeholder="请输入所在省份，必填项" style="width:120px;"/>                                                    <input type="text" class="bt-input-text mr5" name="city"  value="'+(n.city||"")+'" placeholder="请输入所在市/县，必填项" style="width:120px;margin-left:15px" />                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">公司名称</span>                                                <div class="info-r ">                                                    <input type="text" class="bt-input-text mr5" name="organation" value="'+(n.organation||"")+'"  placeholder="请输入公司名称，如为个人申请请输入个人姓名，必填项"/>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">姓名</span>                                                <div class="info-r ">                                                    <input type="text" class="bt-input-text mr5" name="name"  value="'+(n.lastName+n.firstName||"")+'" placeholder="请输入姓名，必填项"/>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">邮箱</span>                                                <div class="info-r ">                                                    <input type="text" class="bt-input-text mr5" name="email" value="'+(n.email||"")+'" placeholder="请输入邮箱地址，必填项"/>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">手机</span>                                                <div class="info-r ">                                                    <input type="text" class="bt-input-text mr5" name="mobile" value="'+(n.mobile||"")+'" placeholder="请输入手机号码，若为空，则使用当前绑定手机号"/>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname">总计费用</span>                                                <div class="info-r">                                                    <div class="guide_price"></div>                                                </div>                                            </div>                                            <div class="line">                                                <span class="tname"></span>                                                <div class="info-r">                                                    <button class="btn btn-default btn-sm prev-plan mr10" data-guide="2">上一步</button>                                                    <button class="btn btn-success btn-sm play-plan" data-guide="2">支付订单</button>                                                </div>                                            </div>                                        </div>                                        <div class="guide_content ssl_applay_info" style="display:none" data-guide="3">                                            <div class="payTitle">微信支付</div>                                            <div class="paymethod">                                                <div class="pay-wx" id="PayQcode"></div>                                            </div>                                            <div class="lib-price-box text-center">                                                <span class="lib-price-name f14"><b>总计</b></span>                                                <span class="price-txt"><b class="sale-price">148.00</b>元</span>                                            </div>                                            <div class="lib-price-detailed">                                                <div class="info"><span class="text-left">商品名称</span><span class="text-right"></span></div>                                                <div class="info"><span class="text-left">下单时间</span><span class="text-right"></span></div>                                            </div>                                            <div class="lib-prompt"><span>微信扫一扫支付</span></div>                                        </div>                                        <div class="guide_content ssl_order_check" style="display:none" data-guide="4">                                            <div class="lib-price-icon"><div class="order_paly_success">支付成功</div></div>                                            <div class="lib-price-detailed" style="margin-bottom:15px;">                                                <div class="info"><span class="text-left">证书类型</span><span class="text-right"></span></div>                                            </div>                                        </div>                                    </div>';u=bt.open({type:1,title:"申请商用证书",area:"640px",content:m,success:function(t,a){$(t).css("top",($(window).height()-$(t).height())/2-42),$(".ssl_class_table tbody tr").click(function(){var t=$(this).data("index");p=s.data[t],$(this).addClass("active").siblings().removeClass("active"),$(this).find("input").prop("checked","checked"),$(".guide_price").html("<span>"+p.price.toFixed(2)+'</span><span>元/1年</span><span style="color: #bbbbbb;text-decoration: line-through;margin-left: 15px;" class="mr5">原价:'+p.src_price.toFixed(2)+"元/年</span>")}).eq(0).click(),$(".next-plan").click(function(){var e=parseInt($(this).data("guide")),s=p.code,i="";$(t).css("top",($(window).height()-$(t).height())/2-42),$("[data-guide="+(e+1)+"].guide_content").show().siblings(".guide_content").hide(),$(".guide_path span:eq("+e+")").addClass("active"),$(".guide_path_progress span:eq(0)").width(135),1==e&&$(".ssl-info-line").html("<span>"+p.title+"</span>"),s.indexOf("multi")>-1?(i=s.indexOf("wildcard")>-1?"多域名通配符证书，每行一个域名，最高支持2个域名，必填项,例如：\r*.bt.cn\r*.bttest.cn":"多域名证书，每行一个域名，最高支持3个域名，必填项,例如：\rwww.bt.cn\rwww.bttest.cn",$(".domain_list_info").html('<textarea class="bt-input-text mr20 key" name="domains" placeholder="'+i+'" style="line-height:20px;width:400px;height:80px;padding:8px;"></textarea>')):(i=s.indexOf("wildcard")>-1?"请输入需要申请证书的域名（单域名通配符证书），必填项，例如：*.bt.cn":"请输入需要申请证书的域名（单域名证书），必填项，例如：www.bt.cn",$(".domain_list_info").html('<input type="text" disabled="true" readonly="readonly" id="apply_site_name" class="bt-input-text mr5" name="domains" placeholder="'+i+'"/><button class="btn btn-success btn-xs" onclick="site.select_site_list(\'apply_site_name\',\''+s+'\')" style="">选择已有域名</button><button class="btn btn-success btn-xs" onclick="site.select_site_txt(\'apply_site_name\')" style="margin: 5px;">自定义域名</button>'))}),$(".prev-plan").click(function(){$(t).css("top",($(window).height()-$(t).height())/2-42);var e=parseInt($(this).data("guide"));$("[data-guide="+(e-1)+"].guide_content").show().siblings(".guide_content").hide(),$(".guide_path span:eq("+(e-1)+")").removeClass("active"),$(".guide_path_progress span:eq(0)").width(0)}),$(".ssl_application_info").on("focus","input[type=text],textarea",function(){var t=$(this).attr("placeholder");$("html").append($('<span id="width_test">'+t+"</span>")),$(this).attr("data-placeholder",t),layer.tips(t,$(this),{tips:[1,"#20a53a"],time:0,area:$("#width_test").width()+20+"px"}),$(this).attr("placeholder",""),$("#width_test").remove()}).on("blur","input[type=text],textarea",function(){var t=$(this).attr("name"),e=$(this).val();layer.closeAll("tips"),$(this).attr("placeholder",$(this).attr("data-placeholder")),i($(this),t,e)}),$(".play-plan").click(function(){function e(t,s){if(!h)return!1;bt.send("get_pay_status","ssl/get_pay_status",{oid:t},function(s){if(0===s)setTimeout(function(){e(t,p)},1500);else{var i=bt.load("正在申请证书，请稍后...");bt.send("apply_order","ssl/apply_order",{oid:t},function(e){i.close(),$(".guide_path_progress span:eq(0)").width(290),$(".ssl_order_check").show().siblings(".guide_content").hide(),$(".guide_path span:eq(3)").addClass("active"),$(".ssl_order_check .lib-price-detailed .text-right:eq(0)").text(p.title),e.status&&l(t,function(e){$(".ssl_order_check").append(r(e)),$(".verify_ssl_domain").click(function(){u.close(),l(t)}),$(".return_ssl_list").click(function(){u.close(),$("#ssl_tabs span:eq(2)").click()})})})}var a=new ClipboardJS(".parsing_info .parsing_icon");a.on("success",function(t){bt.msg({status:!0,msg:"复制成功"}),t.clearSelection()}),a.on("error",function(t){bt.msg({status:!0,msg:"复制失败，请手动ctrl+c复制！"}),console.error("Action:",t.action),console.error("Trigger:",t.trigger)})})}$(t).css("top",($(window).height()-$(t).height())/2-42);var s={},a={};if(h=!0,c=!0,$(".ssl_application_info").find("input,textarea").each(function(){var t=$(this).attr("name"),e=$(this).val();e=i($(this),t,e);if("boolean"==typeof e)return s=!1,!1;s[t]=e}),"boolean"==typeof s)return!1;a={pid:p.pid,years:1,dcvMethod:$('[name="dcvMethod"]:checked').val(),domains:s.domains,Administrator:{job:n.job||"总务",state:s.state,city:s.city,address:s.state+s.city,email:s.email,mobile:s.mobile,country:n.country||"CN",lastName:s.name,organation:s.organation,postCode:n.postCode||"523000"}};var o=bt.load("正在创建支付订单，请稍后...");bt.send("apply_order_pay","ssl/apply_order_pay",{pdata:JSON.stringify(a)},function(t){if(o.close(),!1===t.status)return bt.msg(t),!1;$(".guide_path_progress span:eq(0)").width(290),
$(".ssl_applay_info").show().siblings(".guide_content").hide(),$(".sale-price").text(p.price.toFixed(2)),$(".lib-price-detailed .info:eq(0) span:eq(1)").text(p.title),$(".lib-price-detailed .info:eq(1) span:eq(1)").text(bt.format_data((new Date).getTime())),$(".guide_path span:eq(2)").addClass("active"),$("#PayQcode").qrcode({render:"canvas",width:320,height:320,text:t.msg.wxcode}),e(t.msg.oid,p)})}),$(".business_ssl_application ").on("click",".lib-price-button button",function(){switch($(this).index()){case 0:u.close(),l(e.msg.oid);break;case 1:u.close()}})},cancel:function(t,e){if(c)return bt.confirm({msg:"当前处于支付状态，支付时请勿强制关闭弹窗，是否关闭弹窗?",title:"提示"},function(e){layer.close(e),layer.close(t)}),!1},end:function(){c=!1,h=!1}})})}),!1}},{title:"其他证书",callback:function(s){var i="";e.cert_data.notBefore&&(i='<div style="margin-bottom: 10px;" class="alert alert-success">                                        <p style="margin-bottom: 9px;"><span style="width: 357px;display: inline-block;">'+(e.status?"<b>已部署成功：</b>请在证书到期之前更换新的证书":'<b style="color:red;">当前未部署：</b>请点击【保存】按钮完成此证书的部署')+'</span>                                        <span style="margin-left: 20px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;max-width: 138px;width: 140px;">                                        <b>证书品牌：</b>'+e.cert_data.issuer+'</span></p>                                        <span style="display:inline-block;max-width: 357px;overflow:hidden;text-overflow:ellipsis;vertical-align:-3px;white-space: nowrap;width: 357px;"><b>认证域名：</b> '+e.cert_data.dns.join("、")+'</span>                                        <span style="margin-left: 20px;"><b>到期时间：</b> '+e.cert_data.notAfter+"</span></div>"),s.append("<div>"+i+'<div><span style="width: 45%;display: inline-block;margin-right: 20px;">密钥(KEY)</span><span  style="width: 45%;display: inline-block;margin-right: 20px;">证书(PEM格式)</span></div></div>');for(var a=[{items:[{name:"key",width:"45%",height:"260px",type:"textarea",value:e.key},{name:"csr",width:"45%",height:"260px",type:"textarea",value:e.csr}]},{items:[{text:"保存",name:"btn_ssl_save",type:"button",callback:function(e){bt.site.set_ssl(t.name,e,function(t){t.status&&site.reload(7),bt.msg(t)})}},{text:"关闭SSL",name:"btn_ssl_close",hide:!e.status,type:"button",callback:function(e){site.ssl.set_ssl_status("CloseSSLConf",t.name)}}]}],n=0;n<a.length;n++){var l=bt.render_form_line(a[n]);s.append(l.html),bt.render_clicks(l.clicks)}var c=['粘贴您的*.key以及*.pem内容，然后保存即可<a href="http://www.bt.cn/bbs/thread-704-1-1.html" class="btlink" target="_blank">[帮助]</a>。',"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书","PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt","在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点","如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"];s.append(bt.render_help(c))}},{title:"关闭",callback:function(s){if(-1!=e.type){var i="";switch(e.type){case 1:i="Let's Encrypt";break;case 0:i="其他证书";break;case 2:i=lan.site.bt_ssl;break;case 3:i="Comodo Positive"}$(".tab-con").html("<div class='line mtb15'>"+lan.get("ssl_enable",[i])+"</div><div class='line mtb15'><button class='btn btn-success btn-sm' onclick=\"site.ssl.set_ssl_status('CloseSSLConf','"+t.name+"')\">"+lan.site.ssl_close+"</button></div>")}else s.html("<div class='mtb15' style='line-height:30px'>"+lan.site.ssl_help_1+"</div>")}},{title:"证书夹",callback:function(e){e.html("<div class='divtable' style='height:510px;'><table id='cer_list_table' class='table table-hover'></table></div>"),bt.site.get_cer_list(function(e){bt.render({table:"#cer_list_table",columns:[{field:"subject",title:"域名",templet:function(t){return t.dns.join("<br>")}},{field:"notAfter",width:"83px",title:"到期时间"},{field:"issuer",width:"150px",title:"品牌"},{field:"opt",width:"75px",align:"right",title:"操作",templet:function(e){var s='<a class="btlink" onclick="bt.site.set_cert_ssl(\''+e.subject+"','"+t.name+'\',function(rdata){if(rdata.status){site.ssl.reload(2);}})" href="javascript:;">部署</a> | ';return s+='<a class="btlink" onclick="bt.site.remove_cert_ssl(\''+e.subject+'\',function(rdata){if(rdata.status){site.ssl.reload(4);}})" href="javascript:;">删除</a>',s}}],data:e})})}}];switch(bt.render_tab("ssl_tabs",s),$("#ssl_tabs").append('<div class="ss-text pull-right mr30" style="position: relative;top:-4px"><em>强制HTTPS</em><div class="ssh-item"><input class="btswitch btswitch-ios" id="toHttps" type="checkbox"><label class="btswitch-btn" for="toHttps"></label></div></div>'),$("#toHttps").attr("checked",e.httpTohttps),$("#toHttps").click(function(e){var s=$("#toHttps").attr("checked");s?layer.confirm("关闭强制HTTPS后需要清空浏览器缓存才能看到效果,继续吗?",{icon:3,title:"关闭强制HTTPS"},function(){bt.site.close_http_to_https(t.name,function(t){t.status&&setTimeout(function(){site.reload(7)},3e3)})}):bt.site.set_http_to_https(t.name,function(t){t.status||setTimeout(function(){site.reload(7)},3e3)})}),e.type){case 0:$("#ssl_tabs span:eq(3)").trigger("click");break;case 1:$("#ssl_tabs span:eq(1)").trigger("click");break;case 3:$("#ssl_tabs span:eq(2)").trigger("click");break;default:$("#ssl_tabs span:eq(0)").trigger("click")}})},set_php_version:function(t){bt.site.get_site_phpversion(t.name,function(e){!1!==e.status?bt.site.get_all_phpversion(function(s){function i(){var e=bt.load("正在获取session状态请稍后");bt.send("get_php_session_path","config/get_php_session_path",{id:t.id},function(t){e.close(),$("#session_switch").prop("checked",t)})}for(var a=[],n=s.length-1;n>=0;n--){var l=s[n];l.value=l.version,l.title=l.name,a.push(l)}var c={items:[{title:"PHP版本",name:"versions",value:e.phpversion,type:"select",items:a},{text:"切换",name:"btn_change_phpversion",type:"button",callback:function(e){bt.site.set_phpversion(t.name,e.versions,function(t){t.status&&site.reload(8),setTimeout(function(){bt.msg(t)},2e3)})}}]},r=bt.render_form_line(c),o=$(r.html);o.append(bt.render_help(["请根据您的程序需求选择版本","若非必要,请尽量不要使用PHP5.2,这会降低您的服务器安全性；","PHP7不支持mysql扩展，默认安装mysqli以及mysql-pdo。"])),$("#webedit-con").append(o),bt.render_clicks(r.clicks),$("#webedit-con").append('<div class="user_pw_tit" style="margin-top: 2px;padding-top: 11px;border-top: #ccc 1px dashed;"><span class="tit">session隔离</span><span class="btswitch-p"style="display: inline-flex;"><input class="btswitch btswitch-ios" id="session_switch" type="checkbox"><label class="btswitch-btn session-btn" for="session_switch" ></label></span></div><div class="user_pw" style="margin-top: 10px; display: block;"></div>'+bt.render_help(["开启后将会把session文件存放到独立文件夹独立文件夹，不与其他站点公用存储位置","若您在PHP配置中将session保存到memcache/redis等缓存器时，请不要开启此选项"])),i(),$("#session_switch").click(function(){var e=$(this).prop("checked");bt.send("set_php_session_path","config/set_php_session_path",{id:t.id,act:e?1:0},function(t){bt.msg(t)}),setTimeout(function(){i()},500)})}):bt.msg(e)})},templet_301:function(t,e,s,i){s&&(i={redirectname:(new Date).valueOf(),tourl:"http://",redirectdomain:[],redirectpath:"",redirecttype:"",type:1,domainorpath:"domain",holdpath:1});var a=["重定向类型：表示访问选择的“域名”或输入的“路径”时将会重定向到指定URL","目标URL：可以填写你需要重定向到的站点，目标URL必须为可正常访问的URL，否则将返回错误","重定向方式：使用301表示永久重定向，使用302表示临时重定向","保留URI参数：表示重定向后访问的URL是否带有子路径或参数如设置访问http://b.com 重定向到http://a.com","保留URI参数：  http://b.com/1.html ---> http://a.com/1.html","不保留URI参数：http://b.com/1.html ---> http://a.com"];bt.site.get_domains(e,function(e){for(var n="",l=0;l<e.length;l++)n+='<option value="'+e[l].name+'">'+e[l].name+"</option>";var c=bt.open({type:1,skin:"demo-class",area:"650px",title:s?"创建重定向":"修改重定向["+i.redirectname+"]",closeBtn:2,shift:5,shadeClose:!1,content:"<form id='form_redirect' class='divtable pd20' style='padding-bottom: 60px'><div class='line' style='overflow:hidden;height: 40px;'><span class='tname' style='position: relative;top: -5px;'>开启重定向</span><div class='info-r  ml0 mt5' ><input class='btswitch btswitch-ios' id='type' type='checkbox' name='type' "+(1==i.type?'checked="checked"':"")+" /><label class='btswitch-btn phpmyadmin-btn' for='type' style='float:left'></label><div style='display: inline-block;'><span class='tname' style='margin-left:10px;position: relative;top: -5px;'>保留URI参数</span><input class='btswitch btswitch-ios' id='holdpath' type='checkbox' name='holdpath' "+(1==i.holdpath?'checked="checked"':"")+" /><label class='btswitch-btn phpmyadmin-btn' for='holdpath' style='float:left'></label></div></div></div><div class='line' style='clear:both;display:none;'><span class='tname'>重定向名称</span><div class='info-r  ml0'><input name='redirectname' class='bt-input-text mr5' "+(s?"":'disabled="disabled"')+" type='text' style='width:300px' value='"+i.redirectname+"'></div></div><div class='line' style='clear:both;'><span class='tname'>重定向类型</span><div class='info-r  ml0'><select class='bt-input-text mr5' name='domainorpath' style='width:100px'><option value='domain' "+("domain"==i.domainorpath?'selected ="selected"':"")+">域名</option><option value='path'  "+("path"==i.domainorpath?'selected ="selected"':"")+">路径</option></select><span class='mlr15'>重定向方式</span><select class='bt-input-text ml10' name='redirecttype' style='width:100px'><option value='301' "+("301"==i.redirecttype?'selected ="selected"':"")+" >301</option><option value='302' "+("302"==i.redirecttype?'selected ="selected"':"")+">302</option></select></div></div><div class='line redirectdomain' style='display:"+("domain"==i.domainorpath?"block":"none")+"'><span class='tname'>重定向域名</span><div class='info-r  ml0'><select id='usertype' name='redirectdomain' data-actions-box='true' class='selectpicker show-tick form-control' multiple data-live-search='false'>"+n+"</select><span class='tname' style='width:90px'>目标URL</span><input  name='tourl' class='bt-input-text mr5' type='text' style='width:200px' value='"+i.tourl+"'></div></div><div class='line redirectpath' style='display:"+("path"==i.domainorpath?"block":"none")+"'><span class='tname'>重定向路径</span><div class='info-r  ml0'><input  name='redirectpath' class='bt-input-text mr5' type='text' style='width:200px;float: left;margin-right:0px' value='"+i.redirectpath+"'><span class='tname' style='width:90px'>目标URL</span><input  name='tourl1' class='bt-input-text mr5' type='text' style='width:200px' value='"+i.tourl+"'></div></div><ul class='help-info-text c7'>"+bt.render_help(a)+"</ul><div class='bt-form-submit-btn'><button type='button' class='btn btn-sm btn-danger btn-colse-prosy'>关闭</button><button type='button' class='btn btn-sm btn-success btn-submit-redirect'>"+(s?" 提交":"保存")+"</button></div></form>"});setTimeout(function(){$(".selectpicker").selectpicker({noneSelectedText:"请选择域名...",selectAllText:"全选",deselectAllText:"取消全选"}),$(".selectpicker").selectpicker("val",i.redirectdomain),$("#form_redirect").parent().css("overflow","inherit"),$('[name="domainorpath"]').change(function(){"path"==$(this).val()?($(".redirectpath").show(),$(".redirectdomain").hide(),$(".selectpicker").selectpicker("val",[])):($(".redirectpath").hide(),$(".redirectdomain").show(),$('[name="redirectpath"]').val(""))}),$(".btn-colse-prosy").click(function(){c.close()}),$(".btn-submit-redirect").click(function(){var e=$('[name="type"]').prop("checked")?1:0,i=$('[name="holdpath"]').prop("checked")?1:0,a=$('[name="redirectname"]').val(),n=$('[name="redirecttype"]').val(),l=$('[name="domainorpath"]').val(),r=$('[name="redirectpath"]').val(),o=JSON.stringify($(".selectpicker").val()||[]),d=$("path"==l?'[name="tourl1"]':'[name="tourl"]').val();s?bt.site.create_redirect({type:e,sitename:t,holdpath:i,redirectname:a,redirecttype:n,domainorpath:l,redirectpath:r,redirectdomain:o,tourl:d},function(t){t.status&&(c.close(),site.reload(11)),bt.msg(t)}):bt.site.modify_redirect({type:e,sitename:t,holdpath:i,redirectname:a,redirecttype:n,domainorpath:l,redirectpath:r,redirectdomain:o,tourl:d},function(t){t.status&&(c.close(),site.reload(11)),bt.msg(t)})})},100)})},template_Dir:function(t,e,s){s=e?{name:"",sitedir:"",username:"",password:""}:{name:s.name,sitedir:s.site_dir,username:"",password:""};var i=bt.open({type:1,skin:"demo-class",area:"550px",title:e?"添加目录保护":"修改目录目录",closeBtn:2,shift:5,shadeClose:!1,content:"<form id='form_dir' class='divtable pd15' style='padding: 40px 0 90px 60px'><div class='line'><span class='tname'>名称</span><div class='info-r ml0'><input name='dir_name' class='bt-input-text mr10' type='text' style='width:270px' value='"+s.name+"'></div></div><div class='line'><span class='tname'>保护的目录</span><div class='info-r ml0'><input name='dir_sitedir' placeholder='输入需要保护的目录，如：/text/' class='bt-input-text mr10' type='text' style='width:270px' value='"+s.sitedir+"'></div></div><div class='line'><span class='tname'>用户名</span><div class='info-r ml0'><input name='dir_username' AUTOCOMPLETE='off' class='bt-input-text mr10' type='text' style='width:270px' value='"+s.username+"'></div></div><div class='line'><span class='tname'>密码</span><div class='info-r ml0'><input name='dir_password' AUTOCOMPLETE='off' class='bt-input-text mr10' type='password' style='width:270px' value='"+s.password+"'></div></div><ul class='help-info-text c7 plr20'><li>目录设置保护后，访问时需要输入账号密码才能访问</li><li>例如我设置了保护目录 /test/ ,那我访问 http://aaa.com/test/ 是就要输入账号密码才能访问</li></ul><div class='bt-form-submit-btn'><button type='button' class='btn btn-sm btn-danger btn-colse-guard'>关闭</button><button type='button' class='btn btn-sm btn-success btn-submit-guard'>"+(e?"提交":"保存")+"</button></div></form>"});$(".btn-colse-guard").click(function(){i.close()}),$(".btn-submit-guard").click(function(){var s={};s.id=t,s.name=$('input[name="dir_name"]').val(),s.site_dir=$('input[name="dir_sitedir"]').val(),s.username=$('input[name="dir_username"]').val(),s.password=$('input[name="dir_password"]').val(),e?bt.site.create_dir_guard(s,function(t){t.status&&(i.close(),site.reload()),bt.msg(t)}):bt.site.edit_dir_account(s,function(t){t.status&&(i.close(),site.reload()),bt.msg(t)})}),setTimeout(function(){e||($('input[name="dir_name"]').attr("disabled","disabled"),$('input[name="dir_sitedir"]').attr("disabled","disabled"))},500)},set_301_old:function(t){bt.site.get_domains(t.id,function(e){for(var s=[{title:"整站",value:"all"}],i=0;i<e.length;i++)s.push({title:e[i].name,value:e[i].name});bt.site.get_site_301(t.name,function(e){for(var i=""==e.src?"all":e.src,a=[{title:"访问域名",width:"360px",name:"domains",value:i,disabled:e.status,type:"select",items:s},{title:"目标URL",width:"360px",name:"toUrl",value:e.url},{title:" ",text:"启用301",value:e.status,name:"status",class:"label-input-group",type:"checkbox",callback:function(e){bt.site.set_site_301(t.name,e.domains,e.toUrl,e.status?"1":"0",function(t){t.status&&site.reload(10),bt.msg(t)})}}],n=$("#webedit-con"),l=0;l<a.length;l++){var c=bt.render_form_line(a[l]);n.append(c.html),bt.render_clicks(c.clicks)}n.append(bt.render_help(["选择[整站]时请不要将目标URL设为同一站点下的域名.","取消301重定向后，需清空浏览器缓存才能看到生效结果."]))})})},set_301:function(t){$("#webedit-con").html('<div id="redirect_list"></div>'),bt_tools.table({el:"#redirect_list",url:"/site?action=GetRedirectList",param:{sitename:t.name},dataFilter:function(t){return{data:t}},column:[{type:"checkbox",width:20},{fid:"sitename",title:"重定向类型",type:"text",template:function(t){return"path"==t.domainorpath?conter=t.redirectpath:conter=t.redirectdomain?t.redirectdomain.join("、"):"空",'<span style="width:100px;" title="'+conter+'">'+conter+"</span>"}},{fid:"redirecttype",title:"重定向方式",type:"text"},{fid:"holdpath",title:"保留URL参数",config:{icon:!1,list:[[1,"开启","bt_success"],[0,"关闭","bt_danger"]]},type:"status",event:function(t,e,s,i,a){t.holdpath=t.holdpath?0:1,t.redirectdomain=JSON.stringify(t.redirectdomain),bt.site.modify_redirect(t,function(e){t.redirectdomain=JSON.parse(t.redirectdomain),a.$modify_row_data({holdpath:t.holdpath}),bt.msg(e)})}},{fid:"type",title:"状态",config:{icon:!0,list:[[1,"运行中","bt_success","glyphicon-play"],[0,"已停止","bt_danger","glyphicon-pause"]]},type:"status",event:function(t,e,s,i,a){t.type=t.type?0:1,t.redirectdomain=JSON.stringify(t.redirectdomain),bt.site.modify_redirect(t,function(e){t.redirectdomain=JSON.parse(t.redirectdomain),a.$modify_row_data({holdpath:t.type}),bt.msg(e)})}},{title:"操作",width:150,type:"group",align:"right",group:[{title:"配置文件",event:function(e,s,i,a,n){bt.site.get_redirect_config({sitename:t.name,redirectname:e.redirectname,webserver:bt.get_cookie("serverType")},function(t){"object"==typeof t&&t.constructor==Array?t[0].status||bt.msg(t):t.status||bt.msg(t);var s=[{items:[{name:"redirect_configs",type:"textarea",value:t[0].data,widht:"340px",height:"200px"}]},{name:"btn_config_submit",text:"保存",type:"button",callback:function(e){bt.site.save_redirect_config({path:t[1],data:l.getValue(),encoding:t[0].encoding},function(t){t.status&&(site.reload(11),redirect_config.close()),bt.msg(t)})}}];redirect_config=bt.open({type:1,area:["550px","550px"],title:"编辑配置文件["+e.redirectname+"]",closeBtn:2,shift:0,content:"<div class='bt-form'><div id='redirect_config_con' class='pd15'></div></div>"});for(var i=$("#redirect_config_con"),a=0;a<s.length;a++){var n=bt.render_form_line(s[a]);i.append(n.html),bt.render_clicks(n.clicks)}i.append(bt.render_help(["此处为该负载均衡的配置文件，若您不了解配置规则,请勿随意修改。"])),$("textarea.redirect_configs").attr("id","configBody");var l=CodeMirror.fromTextArea(document.getElementById("configBody"),{extraKeys:{"Ctrl-Space":"autocomplete"},lineNumbers:!0,matchBrackets:!0});$(".CodeMirror-scroll").css({height:"350px",margin:0,padding:0}),setTimeout(function(){l.refresh()},250)})}},{title:"编辑",event:function(e,s,i,a,n){site.edit.templet_301(t.name,t.id,!1,e)}},{title:"删除",event:function(e,s,i,a,n){bt.site.remove_redirect(t.name,e.redirectname,function(t){t.status&&n.$delete_table_row(s)})}}]}],tootls:[{type:"btnGroup",positon:["left","top"],list:[{title:"添加重定向",active:!0,event:function(e){site.edit.templet_301(t.name,t.id,!0)}}]},{type:"batch_btn",positon:["left","bottom"],selectList:[{title:"删除重定向",batch_btn_name:"批量删除",url:"/site?action=del_redirect_multiple",param:{site_id:t.id},paramId:"redirectname",paramName:"redirectnames",theadName:"重定向名称",confirmVerify:!1}]}]})},templet_proxy:function(t,e,s){e&&(s={type:1,cache:0,proxyname:"",proxydir:"/",proxysite:"http://",cachetime:1,todomain:"$host",subfilter:[{sub1:"",sub2:""}]});for(var i="",a=0;a<s.subfilter.length;a++)0!=a&&""==s.subfilter[a].sub1||(i+="<div class='sub-groud'><input name='rep"+(2*(a+1)-1)+"' class='bt-input-text mr10' placeholder='被替换的文本,可留空' type='text' style='width:200px' value='"+s.subfilter[a].sub1+"'><input name='rep"+2*(a+1)+"' class='bt-input-text ml10' placeholder='替换为,可留空' type='text' style='width:200px' value='"+s.subfilter[a].sub2+"'><a href='javascript:;' class='proxy_del_sub' style='color:red;'>删除</a></div>"),2==a&&$(".add-replace-prosy").attr("disabled","disabled");var n=["代理目录：访问这个目录时将会把目标URL的内容返回并显示(需要开启高级功能)","目标URL：可以填写你需要代理的站点，目标URL必须为可正常访问的URL，否则将返回错误","发送域名：将域名添加到请求头传递到代理服务器，默认为目标URL域名，若设置不当可能导致代理无法正常运行","内容替换：只能在使用nginx时提供，最多可以添加3条替换内容,如果不需要替换请留空"],l=bt.open({type:1,skin:"demo-class",area:"650px",title:e?"创建反向代理":"修改反向代理["+s.proxyname+"]",closeBtn:2,shift:5,shadeClose:!1,content:"<form id='form_proxy' class='divtable pd15' style='padding-bottom: 60px'><div class='line' style='overflow:hidden'><span class='tname' style='position: relative;top: -5px;'>开启代理</span><div class='info-r  ml0 mt5' ><input class='btswitch btswitch-ios' id='openVpn' type='checkbox' name='type' "+(1==s.type?'checked="checked"':"")+"><label class='btswitch-btn phpmyadmin-btn' for='openVpn' style='float:left'></label><div style='display:"+("nginx"==bt.get_cookie("serverType")?" inline-block":"none")+"'><span class='tname' style='margin-left:15px;position: relative;top: -5px;'>开启缓存</span><input class='btswitch btswitch-ios' id='openNginx' type='checkbox' name='cache' "+(1==s.cache?'checked="checked"':"")+"'><label class='btswitch-btn phpmyadmin-btn' for='openNginx'></label></div><div style='display: inline-block;'><span class='tname' style='margin-left:10px;position: relative;top: -5px;'>高级功能</span><input class='btswitch btswitch-ios' id='openAdvanced' type='checkbox' name='advanced' "+(1==s.advanced?'checked="checked"':"")+"'><label class='btswitch-btn phpmyadmin-btn' for='openAdvanced'></label></div></div></div><div class='line' style='clear:both;'><span class='tname'>代理名称</span><div class='info-r  ml0'><input name='proxyname'"+(e?"":"readonly='readonly'")+" class='bt-input-text mr5 "+(e?"":" disabled")+"' type='text' style='width:200px' value='"+s.proxyname+"'></div></div><div class='line cachetime' style='display:"+(1==s.cache?"block":"none")+"'><span class='tname'>缓存时间</span><div class='info-r  ml0'><input name='cachetime'class='bt-input-text mr5' type='text' style='width:200px' value='"+s.cachetime+"'>分钟</div></div><div class='line advanced'  style='display:"+(1==s.advanced?"block":"none")+"'><span class='tname'>代理目录</span><div class='info-r  ml0'><input id='proxydir' name='proxydir' class='bt-input-text mr5' type='text' style='width:200px' value='"+s.proxydir+"'></div></div><div class='line'><span class='tname'>目标URL</span><div class='info-r  ml0'><input name='proxysite' class='bt-input-text mr10' type='text' style='width:200px' value='"+s.proxysite+"'><span class='mlr15'>发送域名</span><input name='todomain' class='bt-input-text ml10' type='text' style='width:200px' value='"+s.todomain+"'></div></div><div class='line replace_conter' style='display:"+("nginx"==bt.get_cookie("serverType")?"block":"none")+"'><span class='tname'>内容替换</span><div class='info-r  ml0 '>"+i+"</div></div><div class='line' style='display:"+("nginx"==bt.get_cookie("serverType")?"block":"none")+"'><div class='info-r  ml0'><button class='btn btn-success btn-sm btn-title add-replace-prosy' type='button'><span class='glyphicon cursor glyphicon-plus  mr5' ></span>添加内容替换</button></div></div><ul class='help-info-text c7'>"+bt.render_help(n)+"<div class='bt-form-submit-btn'><button type='button' class='btn btn-sm btn-danger btn-colse-prosy'>关闭</button><button type='button' class='btn btn-sm btn-success btn-submit-prosy'>"+(e?" 提交":"保存")+"</button></div></form>"});bt.set_cookie("form_proxy",l),$(".add-replace-prosy").click(function(){var t=$(".replace_conter .sub-groud").length;2==t&&$(this).attr("disabled","disabled");var e="<div class='sub-groud'><input name='rep"+(2*t+1)+"' class='bt-input-text mr10' placeholder='被替换的文本,可留空' type='text' style='width:200px' value=''><input name='rep"+(2*t+2)+"' class='bt-input-text ml10' placeholder='替换为,可留空' type='text' style='width:200px' value=''><a href='javascript:;' class='proxy_del_sub' style='color:red;'>删除</a></div>";$(".replace_conter .info-r").append(e)}),$('[name="proxysite"]').keyup(function(){var t=$(this).val(),e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.replace(/^http[s]?:\/\//,""),t=t.replace(/:([0-9]*)$/,""),e.test(t)?$("[name='todomain']").val("$host"):$("[name='todomain']").val(t)}),$("#openAdvanced").click(function(){$(this).prop("checked")?$(".advanced").show():$(".advanced").hide()}),$("#openNginx").click(function(){$(this).prop("checked")?$(".cachetime").show():$(".cachetime").hide()}),$(".btn-colse-prosy").click(function(){l.close()}),$(".replace_conter").on("click",".proxy_del_sub",function(){$(this).parent().remove(),$(".add-replace-prosy").removeAttr("disabled")}),$(".btn-submit-prosy").click(function(){var s={};for(var i in $.each($("#form_proxy").serializeArray(),function(){s[this.name]?(s[this.name].push||(s[this.name]=[s[this.name]]),s[this.name].push(this.value||"")):s[this.name]=this.value||""}),s.type=null==s.type?0:1,s.cache=null==s.cache?0:1,s.advanced=null==s.advanced?0:1,s.sitename=t,s.subfilter=JSON.stringify([{sub1:s.rep1||"",sub2:s.rep2||""},{sub1:s.rep3||"",sub2:s.rep4||""},{sub1:s.rep5||"",sub2:s.rep6||""}]),s)-1!=i.indexOf("rep")&&delete s[i];e?bt.site.create_proxy(s,function(t){t.status&&(l.close(),site.reload(12)),bt.msg(t)}):bt.site.modify_proxy(s,function(t){t.status&&(l.close(),site.reload(12)),bt.msg(t)})})},set_proxy:function(t){$("#webedit-con").html('<div id="proxy_list"></div>'),String.prototype.myReplace=function(t,e){var s=new RegExp(t,"g");return this.replace(s,e)},bt_tools.table({el:"#proxy_list",url:"/site?action=GetProxyList",param:{sitename:t.name},dataFilter:function(t){return{data:t}},column:[{type:"checkbox",width:20},{fid:"proxyname",title:"名称",type:"text"},{fid:"proxydir",title:"代理目录",type:"text"},{fid:"proxysite",title:"目标url",type:"link",href:!0},"nginx"==bt.get_cookie("serverType")?{fid:"cache",title:"缓存",config:{icon:!1,list:[[1,"已开启","bt_success"],[0,"已关闭","bt_danger"]]},type:"status",event:function(t,e,s,i,a){t.cache=t.cache?0:1,t.subfilter=JSON.stringify(t.subfilter),bt.site.modify_proxy(t,function(e){t.subfilter=JSON.parse(t.subfilter),e.status&&a.$modify_row_data({cache:t.cache}),bt.msg(e)})}}:"",{fid:"type",title:"状态",config:{icon:!0,list:[[1,"运行中","bt_success","glyphicon-play"],[0,"已暂停","bt_danger","glyphicon-pause"]]},type:"status",event:function(t,e,s,i,a){t.type=t.type?0:1,t.subfilter=JSON.stringify(t.subfilter),bt.site.modify_proxy(t,function(e){t.subfilter=JSON.parse(t.subfilter),e.status&&a.$modify_row_data({type:t.type}),bt.msg(e)})}},{title:"操作",width:150,type:"group",align:"right",group:[{title:"配置文件",event:function(e,s,i,a,n){bt.site.get_proxy_config({sitename:t.name,proxyname:e.proxyname,webserver:bt.get_cookie("serverType")},function(t){"object"==typeof t&&t.constructor==Array?t[0].status||bt.msg(t):t.status||bt.msg(t);var s=[{items:[{name:"proxy_configs",type:"textarea",value:t[0].data,widht:"340px",height:"200px"}]},{name:"btn_config_submit",text:"保存",type:"button",callback:function(e){bt.site.save_proxy_config({path:t[1],data:l.getValue(),encoding:t[0].encoding},function(t){t.status&&(site.reload(12),proxy_config.close()),bt.msg(t)})}}];proxy_config=bt.open({type:1,area:["550px","550px"],title:"编辑配置文件["+e.proxyname+"]",closeBtn:2,shift:0,content:"<div class='bt-form'><div id='proxy_config_con' class='pd15'></div></div>"});for(var i=$("#proxy_config_con"),a=0;a<s.length;a++){var n=bt.render_form_line(s[a]);i.append(n.html),bt.render_clicks(n.clicks)}i.append(bt.render_help(["此处为该负载均衡的配置文件，若您不了解配置规则,请勿随意修改。"])),$("textarea.proxy_configs").attr("id","configBody");var l=CodeMirror.fromTextArea(document.getElementById("configBody"),{extraKeys:{"Ctrl-Space":"autocomplete"},lineNumbers:!0,matchBrackets:!0});$(".CodeMirror-scroll").css({height:"350px",margin:0,padding:0}),setTimeout(function(){l.refresh()},250)})}},{title:"编辑",event:function(e,s,i,a,n){site.edit.templet_proxy(t.name,!1,e)}},{title:"删除",event:function(e,s,i,a,n){bt.site.remove_proxy(t.name,e.proxyname,function(t){t.status&&n.$delete_table_row(s)})}}]}],tootls:[{type:"btnGroup",positon:["left","top"],list:[{title:"添加反向代理",active:!0,event:function(e){site.edit.templet_proxy(t.name,!0)}}]},{type:"batch_btn",positon:["left","bottom"],selectList:[{title:"删除反向代理",batch_btn_name:"批量删除",url:"/site?action=del_proxy_multiple",param:{site_id:t.id},paramId:"proxyname",paramName:"proxynames",theadName:"反向代理名称",confirmVerify:!1}]}]})},set_security:function(t){bt.site.get_site_security(t.id,t.name,function(e){for(var s=$("#webedit-con"),i=[{title:"URL后缀",name:"sec_fix",value:e.fix,disabled:e.status,width:"300px"},{title:"许可域名",type:"textarea",name:"sec_domains",value:e.domains.replace(/,/g,"\n"),disabled:e.status,width:"300px",height:"210px"},{title:"响应资源",name:"return_rule",value:e.return_rule,disabled:e.status,width:"300px"},{title:" ",class:"label-input-group",items:[{text:"启用防盗链",name:"status",value:e.status,type:"checkbox",callback:function(e){bt.site.set_site_security(t.id,t.name,e.sec_fix,e.sec_domains.split("\n").join(","),e.status,e.return_rule,function(t){t.status&&site.reload(13),bt.msg(t)})}},{text:"允许空HTTP_REFERER请求",name:"none",value:e.none,type:"checkbox",callback:function(e){bt.site.set_site_security(t.id,t.name,e.sec_fix,e.sec_domains.split("\n").join(","),"1",e.return_rule,function(t){t.status&&site.reload(13),bt.msg(t)})}}]}],a=0;a<i.length;a++){var n=bt.render_form_line(i[a]);s.append(n.html),bt.render_clicks(n.clicks)}var l=["【URL后缀】一般填写文件后缀，每行一个后缀,如: png","【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn","【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png","【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"];s.append(bt.render_help(l))})},set_tomact:function(t){bt.site.get_site_phpversion(t.name,function(e){var s=$("#webedit-con");if(!e.tomcatversion)return s.html("<font>"+lan.site.tomcat_err_msg1+"</font>"),void layer.msg(lan.site.tomcat_err_msg,{icon:2});var i={class:"label-input-group",items:[{text:lan.site.enable_tomcat,name:"tomcat",value:-1!=e.tomcat,type:"checkbox",callback:function(e){bt.site.set_tomcat(t.name,function(t){t.status&&site.reload(9),bt.msg(t)})}}]},a=bt.render_form_line(i);s.append(a.html),bt.render_clicks(a.clicks);var n=[lan.site.tomcat_help1+" "+e.tomcatversion+","+lan.site.tomcat_help2,lan.site.tomcat_help3,lan.site.tomcat_help4,lan.site.tomcat_help5];s.append(bt.render_help(n))})},get_site_logs:function(t){bt.site.get_site_logs(t.name,function(t){var e=$("#webedit-con"),s={class:"bt-logs",items:[{name:"site_logs",height:"600px",value:t.msg,width:"100%",type:"textarea"}]},i=bt.render_form_line(s);e.append(i.html),bt.render_clicks(i.clicks),$('textarea[name="site_logs"]').attr("readonly",!0),$('textarea[name="site_logs"]').scrollTop(1e11)})}},create_let:function(t,e){bt.site.create_let(t,function(t){if(t.status){if(!e)return site.ssl.reload(1),void bt.msg(t);e(t)}else{if(t.msg&&"string"==typeof t.msg&&(t.msg=[t.msg,""]),!t.out)return e?void e(t):void bt.msg(t);var s="<p>"+t.msg+"</p><hr />";t.err[0].length>10&&(s+='<p style="color:red;">'+t.err[0].replace(/\n/g,"<br>")+"</p>"),t.err[1].length>10&&(s+='<p style="color:red;">'+t.err[1].replace(/\n/g,"<br>")+"</p>"),layer.msg(s,{icon:2,area:"500px",time:0,shade:.3,shadeClose:!0})}})},reload:function(t){null==t&&(t=0);var e=$(".site-menu p.bgw");0==e.length&&(e=$(".site-menu p:eq(0)")),e.trigger("click")},plugin_firewall:function(){var t=bt.get_cookie("serverType"),e="btwaf_httpd";"nginx"==t&&(e="btwaf"),bt.plugin.get_plugin_byhtml(e,function(t){if(!1!==t.status){var e=t.split('<script type="javascript/text">');e.length>1?rcode=t.split('<script type="javascript/text">')[1].replace("</script>",""):(e=t.split('<script type="text/javascript">'),rcode=t.split('<script type="text/javascript">')[1].replace("</script>","")),rcss=t.split("<style>")[1].split("</style>")[0],rcode=rcode.replace("    wafview()",""),$("body").append('<div style="display:none"><style>'+rcss+'</style><script type="javascript/text">'+rcode+"</script></div>"),setTimeout(function(){window.attachEvent&&!window.opera?execScript(rcode):window.eval(rcode)},200)}})},select_site_txt:function(t){layer.open({type:1,closeBtn:2,title:"自定义域名",area:"600px",btn:["确认","取消"],content:'<div class="pd20"><div class="line "><span class="tname">自定义域名</span><div class="info-r "><input  name="site_name" placeholder="请输入需要申请证书的域名（单域名证书），必填项，例如：www.bt.cn" class="bt-input-text mr5 ssl_site_name_rc" type="text" style="width:400px" value=""></div></div>            <ul class="help-info-text c7">                    <li> 申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)</li>                    <li>申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败</li>                    <li>SSL证书可选名称赠送规则：</li>                    <li>    1、申请根域名(如：bt.cn),赠送下一级为www的域名(如：www.bt.cn)</li>                    <li>    2、申请当前host为www的域名（如：www.bt.cn）,赠送上一级域名，(如: bt.cn)</li>                    <li>    3、申请其它二级域名，(如：app.bt.cn)，赠送下一级为www的域名 (如：www.app.bt.cn)</li>                </ul >            </div>',success:function(){},yes:function(e,s){layer.close(e),$("#"+t).val($(".ssl_site_name_rc").val())}})},select_site_list:function(t,e){var s=[],i=[];$.post("/data?action=getData",{tojs:"site.get_list",table:"domain",limit:1e4,search:"",p:1,order:"id desc",type:-1},function(a){var n="";a.data.length>0?($.each(a.data,function(t,s){_body='<tr><td><div class="box-group" style="height:16px"><div class="bt_checkbox_groups"></div></div></td><td><span class="overflow_style" style="width:210px">'+s.name+"</span></td></tr>",
e.indexOf("wildcard")>-1?s.name.indexOf("*.")>-1&&(i.push(s.name),n+=_body):(i.push(s.name),n+=_body)}),0==i.length&&(n='<tr><td colspan="2">暂无数据</td></tr>')):n='<tr><td colspan="2">暂无数据</td></tr>',layer.open({type:1,closeBtn:2,title:"选择站点",area:"600px",btn:["确认","取消"],content:'<div class="pd20 dynamic_head_box"><div class="line"><input type="text" name="serach_site" class="bt-input-text" style="width: 560px;" placeholder="支持字段模糊搜索"></div>                <div class="bt-table dynamic_list_table">                    <div class="divtable" style="height:281px">                        <table class="table table-hover">                            <thead>                                <th width="30">                                    <div class="box-group" style="height:16px">                                        <div class="bt_checkbox_groups" data-key="0"></div>                                    </div>                                </th>                                <th>域名</th>                            </thead>                            <tbody class="dynamic_list">'+n+'</tbody>                        </table>                    </div>                </div>                <ul class="help-info-text c7">                    <li> 申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)</li>                    <li>申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败</li>                    <li>SSL证书可选名称赠送规则：</li>                    <li>    1、申请根域名(如：bt.cn),赠送下一级为www的域名(如：www.bt.cn)</li>                    <li>    2、申请当前host为www的域名（如：www.bt.cn）,赠送上一级域名，(如: bt.cn)</li>                    <li>    3、申请其它二级域名，(如：app.bt.cn)，赠送下一级为www的域名 (如：www.app.bt.cn)</li>                </ul >                </div> ',success:function(){jQuery.prototype.fixedThead?$(".dynamic_list_table .divtable").fixedThead({resize:!1}):$(".dynamic_list_table .divtable").css({overflow:"auto"}),$("input[name=serach_site]").on("input",function(){var t=$(this).val();""!=t.trim()?$(".dynamic_list tr").each(function(){var e=$(this).find("td").eq(1).html();-1==e.indexOf(t)?$(this).hide():$(this).show()}):$(".dynamic_list tr").show()}),$(".dynamic_list").on("click",".bt_checkbox_groups",function(t){var e=$(this).parents("tr");$(this).hasClass("active")?$(this).removeClass("active"):($(".dynamic_list .bt_checkbox_groups").removeClass("active"),$(this).addClass("active"),s=[e.find("td").eq(1).text()]),t.preventDefault(),t.stopPropagation()}),$(".dynamic_list").on("click","tr",function(t){$(this).find(".bt_checkbox_groups").click(),t.preventDefault(),t.stopPropagation()})},yes:function(e,i){var a=[];s.length>0&&$.each(s,function(t,e){-1==$.inArray(e,a)&&a.push(e)}),layer.close(e),$("#"+t).val(a.join("\n")),$("textarea[name=lb_site]").focus()}})})},web_edit:function(t){var e=t;bt.open({type:1,area:["780px","722px"],title:lan.site.website_change+"["+e.name+"]  --  "+lan.site.addtime+"["+e.addtime+"]",closeBtn:2,shift:0,content:"<div class='bt-form'><div class='bt-w-menu site-menu pull-left' style='height: 100%;'></div><div id='webedit-con' class='bt-w-con webedit-con pd15'></div></div>"}),setTimeout(function(){var t="openlitespeed"==bt.get_cookie("serverType")?{title:"LS-Cache",callback:site.edit.ols_cache}:"",s=[{title:"域名管理",callback:site.edit.set_domains},{title:"子目录绑定",callback:site.edit.set_dirbind},{title:"网站目录",callback:site.edit.set_dirpath},{title:"目录保护",callback:site.edit.set_dirguard},{title:"流量限制",callback:site.edit.limit_network},{title:"伪静态",callback:site.edit.get_rewrite_list},{title:"默认文档",callback:site.edit.set_default_index},{title:"配置文件",callback:site.edit.set_config},{title:"SSL",callback:site.edit.set_ssl},{title:"PHP版本",callback:site.edit.set_php_version},{title:"Tomcat",callback:site.edit.set_tomact},{title:"重定向",callback:site.edit.set_301},{title:"反向代理",callback:site.edit.set_proxy},{title:"防盗链",callback:site.edit.set_security},{title:"响应日志",callback:site.edit.get_site_logs}];""!==t&&s.splice(3,0,t);for(var i=0;i<s.length;i++){var a=s[i],n=$("<p>"+a.title+"</p>");n.data("callback",a.callback),$(".site-menu").append(n)}$(".site-menu p").click(function(){$("#webedit-con").html(""),$(this).addClass("bgw").siblings().removeClass("bgw");var t=$(this).data("callback");t&&t(e)}),site.reload(0)},100)}};site.get_types();