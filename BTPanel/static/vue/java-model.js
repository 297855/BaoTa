"use strict";function asyncGeneratorStep(t,e,r,n,a,o,c){try{var s=t[o](c),i=s.value}catch(t){return void r(t)}s.done?e(i):Promise.resolve(i).then(n,a)}function _asyncToGenerator(s){return function(){var t=this,c=arguments;return new Promise(function(e,r){var n=s.apply(t,c);function a(t){asyncGeneratorStep(n,e,r,a,o,"next",t)}function o(t){asyncGeneratorStep(n,e,r,a,o,"throw",t)}a(void 0)})}}var javaModle=null;dynamic.delay("java-model",function(){javaModle=new Vue({el:"#bt_java_table",delimiters:["${","}"],data:{serachValue:"",pageInfo:{page:1,tools:0,limit:10},projectList:[],tomcatInfo:{},tomcatList:[],jdkInfo:[],jdkList:[],projectFormInfo:{project_type:3,project_name:"",domain:"",domains:"",project_path:"/www/wwwroot",project_jdk:"",project_jar:"/www/wwwroot",project_cmd:"",run_user:"springboot",tomcat_version:"",project_ps:"",port:"",auth:!1,debug:!1},projectFormBackup:!1,addJavaView:!1,jdkManageView:!1,jdkPathValue:"",tomcatManageView:!1,modifyTomcatPort:!1,modifyTomcatJdk:!1,tomcatPort:"",tomcatJdk:"",tomcatStartShell:"",tomcatVersion:"",projectSettings:!1,projectInfo:{project_config:{java_type:""}},project_settings_model:"projectInformation",tomcatAceConfig:null,defalutTabView:!1,updateView:!0,initialization:!1},methods:{get_system_info:function(r){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$http({get_system_info:"获取JAVA环境信息"});case 3:e=t.sent,e=e.msg,r&&r({jdk:n.get_local_jdk_version(e.jdk_info),tomcat:n.get_tomcat_version(e.tomcat_info)}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),n.$msg(t.t0);case 11:case"end":return t.stop()}},t,null,[[0,8]])}))()},get_local_jdk_version:function(t){var n=this;if(t){this.jdkList=[],this.jdkInfo=t;for(var e=0;e<t.length;e++){var r=t[e];this.$set(this.jdkList,e,{title:r[0]+" ["+r[1]+"]",value:r[1]})}return 1<t.length}return new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$http({get_local_jdk_version:"获取本地JDK信息"});case 3:r=t.sent,n.get_local_jdk_version(r),e(r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),n.$msg(t.t0);case 11:case"end":return t.stop()}},t,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}())},get_tomcat_version:function(t){var n=this;if(t){var e,r=!(this.tomcatList=[]);for(e in this.tomcatInfo=t){var a=t[e];a.version=parseInt(e.match(/([0-9])+$/)[0]),a.status&&(this.tomcatList.push({title:e,value:a.version}),a.status&&(r=!0))}return r}return new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$http({get_tomcat_version:"获取tomcat信息"});case 2:r=t.sent,n.get_tomcat_version(r),e(r);case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())},get_cpu_info:function(t){if("object"!==this.$isType(t.load_info))return"--";var e,r=0;for(e in t.load_info)r+=t.load_info[e].cpu_percent;return r.toFixed(2)+"%"},get_project_type:function(t){switch(t.project_config.java_type){case"neizhi":return"内置项目 [Tomcat"+t.project_config.tomcat_version+"]";case"duli":return"独立项目 [Tomcat"+t.project_config.tomcat_version+"]";case"springboot":return"SpringBoot"}},get_ssl_info:function(t){for(var e=t.ssl,r="",n=[["issuer","证书品牌"],["notAfter","到期日期"],["notBefore","申请日期"],["dns","可用域名"]],a=0;a<n.length;a++){var o=e[n[a][0]];r+=n[a][1]+":"+o+(n.length-1!==a?"\n":"")}return r},get_memory_info:function(t){if("object"!==this.$isType(t.load_info))return"--";var e,r=0;for(e in t.load_info)r+=t.load_info[e].memory_used;return bt.format_size(r)},get_listen_info:function(t){return t.listen.length?t.listen.join(","):"--"},open_file_path:function(t){openPath(t)},editor_project_ps:function(t,e){var r=this,e=this.$refs.table_editor_ps[e].value;if(t.ps===e)return!1;bt.pub.set_data_ps({id:t.id,table:"sites",ps:e},function(t){r.$msg(t)})},switch_operation_state:function(o,t){var c=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="".concat(o.run?"停用":"启动","项目"),r=o.run?"停用["+o.name+"] 项目，停用后将无法访问该项目，您真的要停用这个项目吗？":"即将启动["+o.name+"]项目，是否继续操作？",(n={})[o.run?"stop_project":"start_project"]=e,t.next=4,c.$confirm({title:e,msg:r});case 4:return t.next=6,c.$http(n,{project_name:o.name});case 6:return a=t.sent,t.next=9,c.get_project_list();case 9:c.$msg(a);case 10:case"end":return t.stop()}},t)}))()},delete_project_find:function(r){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$confirm({title:"删除项目",msg:"您正在删除Java项目-[ ".concat(r.name," ]，继续吗？")});case 3:return t.next=5,n.$http({remove_project:"删除Java项目"},{project_name:r.name});case 5:return e=t.sent,t.next=8,n.get_project_list();case 8:n.$msg(e),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),n.$msg(t.t0);case 14:case"end":return t.stop()}},t,null,[[0,11]])}))()},repair_project_find:function(n){var a=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!1,a.tomcatList.forEach(function(t,e){t.value===parseInt(n.project_config.tomcat_version)&&(r=!0)}),r){t.next=7;break}return t.next=5,a.tomcat_manage_view();case 5:return a.$warning("当前Tomcat版本未安装，请安装后重试"),t.abrupt("return",!1);case 7:return t.next=9,a.$confirm({title:"修复项目",msg:"您正在修复Java项目-[ ".concat(n.name," ]，继续吗？")});case 9:return t.prev=9,t.next=12,a.$http({fix_project:"修复Java项目"},{project_name:n.name});case 12:return e=t.sent,t.next=15,a.get_project_list();case 15:a.$msg(e),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(9),a.$msg(t.t0);case 21:case"end":return t.stop()}},t,null,[[9,18]])}))()},add_java_project:function(){0<this.jdkList.length&&(this.projectFormInfo.project_jdk=this.jdkList[0].value),this.addJavaView=!0},close_add_java_project:function(){this.projectFormInfo=Object.assign({},this.projectFormBackup)},search_project_info:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.$load("获取项目列表，请稍后..."),t.next=3,r.get_project_list({search:r.serachValue});case 3:e.close();case 4:case"end":return t.stop()}},t)}))()},get_project_list:function(o){var c=this,s=null;return"number"===this.$isType(o)&&(this.pageInfo.p=o,s=this.$load("获取项目列表，请稍后...")),new Promise(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r){var n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.$http({get_project_list:!1},Object.assign({p:c.pageInfo.p||1,limit:c.pageInfo.limit||10},o));case 3:n=t.sent,s&&s.close(),c.projectList=n.data,a=c.get_table_page_info(n.page),c.pageInfo=Object.assign(c.pageInfo,a),e(n),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),c.$msg(t.t0);case 14:case"end":return t.stop()}},t,null,[[0,11]])}));return function(t,e){return r.apply(this,arguments)}}())},get_table_page_info:function(t){t=t.match(/.+class='Pcurrent'>([0-9]+)<\/span>.+共([0-9]+)条.+/);return{page:parseInt(t[1]),tools:parseInt(t[2])}},select_path:function(r,t){var n=this;try{bt.select_path("select_path",t||"dir",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r,t.next="add_load_jdk"===t.t0?3:"tomcat_jsk_path"===t.t0?5:7;break;case 3:return n.jdkPathValue=e,t.abrupt("break",7);case 5:return n.tomcatJdk=e,t.abrupt("break",7);case 7:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())}catch(t){this.$error(t)}},create_java_project:function(n){var a=this;return new Promise(function(r,t){a.$tryCatch(_asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.$http({create_project:"创建JAVA项目"},n);case 3:e=t.sent,a.$msg(e),r(e),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a.$msg(t.t0);case 11:case"end":return t.stop()}},t,null,[[0,8]])})))})},submit_form_info:function(){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.projectFormInfo,"domain"in(r=3===(r=(r=1<(r={project_type:e.project_type,project_ps:e.project_ps}).project_type?Object.assign(r,{port:e.port,auth:e.auth?1:0}):r).project_type<3?Object.assign(r,{domain:e.domain,tomcat_version:e.tomcat_version,project_path:e.project_path}):r).project_type?Object.assign(r,{project_type:e.project_type,project_name:e.project_name,domains:e.domains,project_jdk:e.project_jdk,project_jar:e.project_jar,project_cmd:e.project_cmd,run_user:e.run_user}):r)&&""===r.domain)return o.$error("项目域名不能为空"),t.abrupt("return",!1);t.next=9;break;case 9:if("project_name"in r&&""===r.project_name)return o.$error("项目名称不能为空"),t.abrupt("return",!1);t.next=14;break;case 14:if("project_path"in r&&""===r.project_path)return o.$error("项目路径不能为空"),t.abrupt("return",!1);t.next=19;break;case 19:if("port"in r&&""===r.port)return o.$error("项目端口不能为空"),t.abrupt("return",!1);t.next=24;break;case 24:if("project_jar"in r&&""===r.project_jar)return o.$error("请选择项目jdr文件路径"),t.abrupt("return",!1);t.next=29;break;case 29:if("port"in r&&""===r.port)return o.$error("项目端口不能为空"),t.abrupt("return",!1);t.next=34;break;case 34:if("project_cmd"in r&&""===r.project_cmd)return o.$error("项目执行命令不能为空"),t.abrupt("return",!1);t.next=39;break;case 39:if(!("project_cmd"in r&&""!==r.domains)){t.next=44;break}if(n=bt.check_domain_list(r.domains)){t.next=43;break}return t.abrupt("return",!1);case 43:r.domains=n;case 44:return t.prev=44,t.next=48,o.create_java_project(r);case 48:return a=t.sent,o.addJavaView=!1,t.next=52,o.get_project_list();case 52:o.$msg(a),t.next=58;break;case 55:t.prev=55,t.t0=t.catch(44),o.$msg(t.t0);case 58:case"end":return t.stop()}},t,null,[[44,55]])}))()},get_project_info:function(e){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.$http({get_project_info:"获取项目数据"},{project_name:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))()},jdk_manage_view:function(){this.jdkManageView=!0,this.addJavaView=!1,this.get_local_jdk_version()},add_jdk_info:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.$http({add_local_jdk:"添加JDK信息"},{jdk:r.jdkPathValue});case 3:return e=t.sent,r.jdkPathValue="",t.next=7,r.get_local_jdk_version();case 7:r.$msg(e),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),r.$msg(t.t0);case 13:case"end":return t.stop()}},t,null,[[0,10]])}))()},delete_jdk_info:function(r){var n=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$confirm({title:"删除JDK信息",msg:"是否删除[ "+r[1]+" ]自定义JDK地址，继续操作吗？"});case 2:return t.prev=2,t.next=5,n.$http({del_local_jdk:"删除JDK信息"},{jdk:r[1]});case 5:return e=t.sent,t.next=8,n.get_local_jdk_version();case 8:n.$msg(e),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),n.$msg(t.t0);case 14:case"end":return t.stop()}},t,null,[[2,11]])}))()},tomcat_manage_view:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.tomcatManageView=!0,e.addJavaView=!1,t.next=4,e.get_tomcat_version();case 4:case"end":return t.stop()}},t)}))()},install_tomcat_version:function(a,o){var c=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=("install"===(o=o||"install")?"安装Tomcat":"卸载Tomcat")+a,"uninstall"===o)return t.prev=3,t.next=6,c.$http({get_tomcat_domain:"检查Tomcat下绑定的站点"},{version:a});t.next=13;break;case 6:r=t.sent,e="卸载Tomcat，当前Tomcat下包含多个站点【"+r.join("、")+"】，删除后将导致项目无法正常运行",t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),c.$msg(t.t0);case 13:return t.next=15,c.$confirm({title:e,msg:"是否"+e+"，继续操作吗？"});case 15:return"uninstall"!==o&&c.$shell({title:"正在"+e+"，请稍后...",shell:"tail -f /tmp/panelShell2.pl",area:["500px","300px"],success:function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.get_tomcat_version();case 2:c.$success("安装成功");case 3:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()}),t.prev=16,t.next=19,c.$http({install_tomcat:"uninstall"===o&&"卸载Tomcat"+a},{version:a,type:o});case 19:return n=t.sent,t.next=22,c.get_tomcat_version();case 22:c.$msg(n),t.next=28;break;case 25:t.prev=25,t.t1=t.catch(16),c.$msg(t.t1);case 28:case"end":return t.stop()}},t,null,[[3,10],[16,25]])}))()},set_tomcat_service:function(r,n){var a=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=n||"start",t.next=4,a.$http({start_tomcat:("start"===n?"启动Tomcat":"stop"===n?"停止Tomcat":"重载Tomcat")+r+"服务"},{version:r,type:n});case 4:return e=t.sent,t.next=7,a.get_tomcat_version();case 7:a.$msg(e),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),a.$msg(t.t0);case 13:case"end":return t.stop()}},t,null,[[0,10]])}))()},open_tomcat_port_view:function(t,e){this.tomcatPort=e,this.tomcatVersion=t,this.modifyTomcatPort=!0},open_tomcat_jdk_view:function(t,e){this.tomcatStartShell=t,this.tomcatJdk=e,this.modifyTomcatJdk=!0},modify_tomcat_port:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""===r.tomcatPort)return r.$error("tomcat 端口号不能为空"),t.abrupt("return",!1);t.next=3;break;case 3:return t.prev=3,t.next=6,r.$http({replce_tomcat_port:"修改端口"},{port:r.tomcatPort,version:r.tomcatVersion});case 6:return e=t.sent,t.next=9,r.get_tomcat_version();case 9:r.$msg(e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),r.$msg(t.t0);case 15:case"end":return t.stop()}},t,null,[[3,12]])}))()},modify_tomcat_jdk:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""===r.tomcatJdk)return r.$error("tomcat JDK地址不能为空"),t.abrupt("return",!1);t.next=3;break;case 3:return t.prev=3,t.next=6,r.$http({replce_tomcat_port:"修改JDK"},{tomcat_start:r.tomcatStartShell,jdk_path:r.tomcatJdk});case 6:return e=t.sent,t.next=9,r.get_tomcat_version();case 9:r.$msg(e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),r.$msg(t.t0);case 15:case"end":return t.stop()}},t,null,[[3,12]])}))()},project_settings_view:function(t){this.projectSettings=!0,this.projectInfo=t},close_project_settings:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.project_settings_model="projectInformation",e.close_add_java_project(),e.defalutTabView=!1,t.next=5,e.get_project_list();case 5:case"end":return t.stop()}},t)}))()},cut_project_settings_model:function(n,a){var o=this;this.defalutTabView=!1,this.$nextTick(_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(e=$("#webedit-con")).empty(),t.t0=n.name,t.next="pseudoStatic"===t.t0?5:"configurationFile"===t.t0?10:"ssl"===t.t0?15:"tomcatConfig"===t.t0?21:"loadState"===t.t0?23:"siteLog"===t.t0?38:43;break;case 5:if(a.project_config.bind_extranet){t.next=8;break}return o.defalutTabView=!0,t.abrupt("return",!1);case 8:return site.edit.get_rewrite_list({name:"java_"+a.name},function(){$(".webedit-box .line:first").remove(),$("[name=btn_save_to]").remove(),$(".webedit-box .help-info-text li:first").remove()}),t.abrupt("break",44);case 10:if(a.project_config.bind_extranet){t.next=13;break}return o.defalutTabView=!0,t.abrupt("return",!1);case 13:return site.edit.set_config({name:"java_"+a.name}),t.abrupt("break",44);case 15:if(a.project_config.bind_extranet){t.next=18;break}return o.defalutTabView=!0,t.abrupt("return",!1);case 18:return site.set_ssl({name:a.name,ele:e,id:a.id}),site.ssl.reload(),t.abrupt("break",44);case 21:return o.tomcatAceConfig=bt.aceEditor({el:"tomcatConfig",path:a.project_config.server_xml,mode:"xml"}),t.abrupt("break",44);case 23:if(a.run){t.next=26;break}return o.defalutTabView=!0,t.abrupt("return",!1);case 26:return t.prev=26,t.next=29,o.get_project_info(a.name);case 29:r=t.sent,o.projectInfo=r,site.node.reander_node_service_condition(e,r),t.next=37;break;case 34:t.prev=34,t.t1=t.catch(26),o.$msg(t.t1);case 37:return t.abrupt("break",44);case 38:if(a.project_config.bind_extranet){t.next=41;break}return o.defalutTabView=!0,t.abrupt("return",!1);case 41:return site.edit.get_site_logs({name:a.name}),t.abrupt("break",44);case 43:return t.abrupt("break",44);case 44:case"end":return t.stop()}},t,null,[[26,34]])})))},cut_project_tabs:function(t,e){var r=this;this.project_settings_model=t,"undefined"!==this.$isType(e)&&(this.projectInfo=e,this.project_settings_view(e)),this.$nextTick(function(){r.cut_project_settings_model({name:t},r.projectInfo)})},save_tomcat_config:function(){bt.saveEditor(this.tomcatAceConfig)}},mounted:function(){var r=this;this.pageInfo.limit=parseInt(10),this.projectFormBackup=Object.assign({},this.projectFormInfo),this.get_system_info(function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.jdk||e.tomcat)return t.next=4,r.get_project_list();t.next=6;break;case 4:t.next=7;break;case 6:r.initialization=!0;case 7:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}())}})});